<!DOCTYPE html>

<html>
<head>
  <title>ux-datagrid-sortModel.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="ux-datagrid-disableHoverWhileScrolling.html">
                ux-datagrid-disableHoverWhileScrolling.js
              </a>
            
              
              <a class="source" href="ux-datagrid-focusManager.html">
                ux-datagrid-focusManager.js
              </a>
            
              
              <a class="source" href="ux-datagrid-iosScroll.html">
                ux-datagrid-iosScroll.js
              </a>
            
              
              <a class="source" href="ux-datagrid-expandRows.html">
                ux-datagrid-expandRows.js
              </a>
            
              
              <a class="source" href="ux-datagrid-findInList.html">
                ux-datagrid-findInList.js
              </a>
            
              
              <a class="source" href="ux-datagrid-gridLogger.html">
                ux-datagrid-gridLogger.js
              </a>
            
              
              <a class="source" href="ux-datagrid-infiniteScroll.html">
                ux-datagrid-infiniteScroll.js
              </a>
            
              
              <a class="source" href="ux-datagrid-scrollHistory.html">
                ux-datagrid-scrollHistory.js
              </a>
            
              
              <a class="source" href="ux-datagrid-sortModel.html">
                ux-datagrid-sortModel.js
              </a>
            
              
              <a class="source" href="ux-datagrid-statsModel.html">
                ux-datagrid-statsModel.js
              </a>
            
              
              <a class="source" href="ux-datagrid-windowScroll.html">
                ux-datagrid-windowScroll.js
              </a>
            
              
              <a class="source" href="angular-ux-datagrid.html">
                angular-ux-datagrid.js
              </a>
            
              
              <a class="source" href="ux-doubleScroll.html">
                ux-doubleScroll.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>ux-datagrid-sortModel.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*
* uxDatagrid v.0.2.1
* (c) 2014, WebUX
* https://github.com/webux/ux-angularjs-datagrid
* License: MIT.
*/</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(exports, global)</span>{</span>
exports.datagrid.events.ON_BEFORE_SORT = <span class="hljs-string">"datagrid:onBeforeSort"</span>;

exports.datagrid.events.ON_AFTER_SORT = <span class="hljs-string">"datagrid:onAfterSort"</span>;

angular.module(<span class="hljs-string">"ux"</span>).service(<span class="hljs-string">"sortStatesModel"</span>, [ <span class="hljs-string">"$location"</span>, <span class="hljs-string">"$rootScope"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($location, $rootScope)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>this is a singleton.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    exports.datagrid.sortStatesModel = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-comment">/**************************************************************************************
         * ColumnStates for sorting.
         * Keeps track of weather a column is sorted or not.
         * It persists based on the path.
         * @type {Object}
         **************************************************************************************/</span>
        <span class="hljs-keyword">var</span> result = exports.logWrapper(<span class="hljs-string">"columnSortStatesModel"</span>, {}, <span class="hljs-string">"blue"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            $rootScope.$emit.apply($rootScope, <span class="hljs-built_in">arguments</span>);
        }), sortOptions = {
            ASC: <span class="hljs-string">"asc"</span>,
            DESC: <span class="hljs-string">"desc"</span>,
            NONE: <span class="hljs-string">"none"</span>
        }, lastPath = <span class="hljs-string">""</span>, states = {}, multipleStates = {}, ignoreParamsInPath = {}, <span class="hljs-comment">/**
             * The default of weather multiple states are allowed or not.
             * @type {Boolean}
             */</span>
        defaultAllowMultipleStates = <span class="hljs-literal">false</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPrivate</span><span class="hljs-params">(prop)</span> {</span>
            <span class="hljs-keyword">return</span> prop.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">"$"</span>;
        }
        <span class="hljs-comment">/**
         * Get the whole url as a key to store the scroll value against.
         * @returns {*}
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentPath</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> $location.path();
        }
        <span class="hljs-comment">/**
         * Return just the url without any GET/Search params.
         * @returns {*}
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentPathWithoutParams</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> getCurrentPath().split(<span class="hljs-string">"?"</span>).shift();
        }
        <span class="hljs-comment">/**
         * @return {string}
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPath</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> path;
            <span class="hljs-keyword">if</span> (getIgnoreParamsInPath()) {
                path = getCurrentPathWithoutParams();
            } <span class="hljs-keyword">else</span> {
                path = getCurrentPath();
            }
            <span class="hljs-keyword">if</span> (path !== lastPath) {
                result.log(<span class="hljs-string">"getPath changed from %s to %s"</span>, lastPath, path);
                lastPath = path;
            }
            <span class="hljs-keyword">return</span> path;
        }
        <span class="hljs-comment">/**
         * Check for allowing of multipleStates on a per path basis or
         * fall back on the defaultAllowMultipleStates
         * @return {Boolean}
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllowMultipleStates</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> result = multipleStates[getPath()];
            <span class="hljs-keyword">if</span> (result === <span class="hljs-literal">true</span> || result === <span class="hljs-literal">false</span>) {
                <span class="hljs-keyword">return</span> result;
            }
            <span class="hljs-keyword">return</span> defaultAllowMultipleStates;
        }
        <span class="hljs-comment">/**
         * Set the allow multiple states on a per path basis.
         * @param {Boolean} value
         * @param {String=} path
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setAllowMultipleStates</span><span class="hljs-params">(value, path)</span> {</span>
            path = path || getPath();
            <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
                result.log(<span class="hljs-string">"setAllowMultipleStates %s"</span>, value);
                multipleStates[path] = value === <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> !!multipleStates[path];
        }
        <span class="hljs-comment">/**
         * Return weather params are ignored in storing path values.
         * @return {Boolean}
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIgnoreParamsInPath</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> ignoreParamsInPath[getCurrentPathWithoutParams()] === <span class="hljs-literal">true</span>;
        }
        <span class="hljs-comment">/**
         * Change if path is stored with or without params.
         * @param value
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setIgnoreParamsInPath</span><span class="hljs-params">(value)</span> {</span>
            result.log(<span class="hljs-string">"setIgnoreParamsInPath %s"</span>, value);
            ignoreParamsInPath[getCurrentPathWithoutParams()] = value;
        }
        <span class="hljs-comment">/**
         * @param path
         * @return {*}
         * @private
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPathState</span><span class="hljs-params">(path)</span> {</span>
            path = path || getPath();
            <span class="hljs-keyword">if</span> (!states[path]) {
                states[path] = {
                    $dirty: <span class="hljs-literal">false</span>,
                    $path: path,
                    $order: []
                };
            }
            <span class="hljs-keyword">return</span> states[path];
        }
        <span class="hljs-comment">/**
         * Override all of the path states.
         * Any columnNames not passed are set to none if not allow multiples.
         * @param pathState
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPathState</span><span class="hljs-params">(pathState)</span> {</span>
            <span class="hljs-keyword">var</span> columnName, currentPathState = getPathState();
            result.log(<span class="hljs-string">"setPathState %s to %s"</span>, currentPathState, pathState);
            setIgnoreParamsInPath(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">for</span> (columnName <span class="hljs-keyword">in</span> pathState) {
                <span class="hljs-keyword">if</span> (pathState.hasOwnProperty(columnName) &amp;&amp; pathState[columnName] !== currentPathState[columnName]) {
                    setState(columnName, pathState[columnName], currentPathState);
                }
            }
        }
        <span class="hljs-comment">/**
         * Returns the current state at the currentPath of the columnName.
         * 'none', 'asc', 'desc'
         * @param columnName
         * @return {String}
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getState</span><span class="hljs-params">(columnName)</span> {</span>
            <span class="hljs-keyword">var</span> pathState = getPathState(getPath());
            <span class="hljs-keyword">if</span> (pathState[columnName] === <span class="hljs-literal">undefined</span>) {
                pathState[columnName] = sortOptions.NONE;
            }
            <span class="hljs-keyword">return</span> pathState[columnName];
        }
        <span class="hljs-comment">/**
         * Set the state at the currentPath for that columnName.
         * @param columnName
         * @param state
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setState</span><span class="hljs-params">(columnName, state, pathState)</span> {</span>
            <span class="hljs-keyword">var</span> index, prevState;
            pathState = pathState || getPathState(getPath());
            <span class="hljs-keyword">if</span> (!isPrivate(columnName) &amp;&amp; pathState[columnName] !== state) {
                prevState = pathState[columnName];
                <span class="hljs-keyword">if</span> (getAllowMultipleStates(pathState.$path)) {
                    index = pathState.$order.indexOf(columnName);
                    <span class="hljs-keyword">if</span> (index !== -<span class="hljs-number">1</span>) {
                        pathState.$order.splice(index, <span class="hljs-number">1</span>);
                    }
                }
                <span class="hljs-keyword">if</span> (state !== sortOptions.NONE) {
                    <span class="hljs-keyword">if</span> (!getAllowMultipleStates()) {
                        clear(pathState);
                    }
                    pathState.$order.push(columnName);
                }
                pathState[columnName] = state;
                <span class="hljs-keyword">if</span> (!prevState &amp;&amp; state === sortOptions.NONE) {
                    <span class="hljs-keyword">return</span>;
                }
                dirtyState(pathState);
            }
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createKeyFromStates</span><span class="hljs-params">(pathState)</span> {</span>
            pathState = pathState || getPathState(getPath());
            <span class="hljs-keyword">var</span> combo = {
                text: <span class="hljs-string">""</span>,
                pathState: pathState
            };
            exports.each(pathState.$order, createKeyFromState, combo);
            <span class="hljs-keyword">return</span> combo.text;
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createKeyFromState</span><span class="hljs-params">(columnName, index, list, combo)</span> {</span>
            <span class="hljs-keyword">if</span> (!isPrivate(columnName)) {
                combo.text += (combo.text.length ? <span class="hljs-string">"|"</span> : <span class="hljs-string">""</span>) + columnName + <span class="hljs-string">":"</span> + combo.pathState[columnName];
            }
        }
        <span class="hljs-comment">/**
         * Increment the columnName's state to the next in the list.
         * @param columnName
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggle</span><span class="hljs-params">(columnName)</span> {</span>
            <span class="hljs-keyword">var</span> state = getState(columnName), nextState = getNextState(state);
            result.info(<span class="hljs-string">"toggle %s from %s to %s"</span>, columnName, state, nextState);
            setState(columnName, nextState);
            dirtyState();
        }
        <span class="hljs-comment">/**
         * @param {Object=} pathState
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dirtyState</span><span class="hljs-params">(pathState)</span> {</span>
            pathState = pathState || getPathState(getPath());
            result.log(<span class="hljs-string">"dirtyState %s"</span>, pathState);
            pathState.$dirty = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-comment">/**
         * @param {Object=} pathState
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearDirty</span><span class="hljs-params">(pathState)</span> {</span>
            pathState = pathState || getPathState(getPath());
            result.log(<span class="hljs-string">"clearDirty %s"</span>, pathState);
            pathState.$dirty = <span class="hljs-literal">false</span>;
        }
        <span class="hljs-comment">/**
         * calculate the next state would be given a currentState.
         * @param state
         * @return {String}
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNextState</span><span class="hljs-params">(state)</span> {</span>
            <span class="hljs-keyword">var</span> result = sortOptions.ASC;
            <span class="hljs-keyword">switch</span> (state) {
              <span class="hljs-keyword">case</span> sortOptions.NONE:
                result = sortOptions.ASC;
                <span class="hljs-keyword">break</span>;

              <span class="hljs-keyword">case</span> sortOptions.ASC:
                result = sortOptions.DESC;
                <span class="hljs-keyword">break</span>;

              <span class="hljs-keyword">case</span> sortOptions.DESC:
                result = sortOptions.NONE;
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">return</span> result;
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasDirtySortState</span><span class="hljs-params">(pathState)</span> {</span>
            pathState = pathState || getPathState(getPath());
            <span class="hljs-keyword">return</span> pathState.$dirty;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>sorts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortNone</span><span class="hljs-params">(a, b)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createAscSort</span><span class="hljs-params">(property)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asc</span><span class="hljs-params">(a, b)</span> {</span>
                <span class="hljs-keyword">var</span> av = a[property], bv = b[property];
                <span class="hljs-keyword">return</span> av &gt; bv ? <span class="hljs-number">1</span> : bv &gt; av ? -<span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
            };
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createDescSort</span><span class="hljs-params">(property)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">desc</span><span class="hljs-params">(a, b)</span> {</span>
                <span class="hljs-keyword">var</span> av = a[property], bv = b[property];
                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span> * (av &gt; bv ? <span class="hljs-number">1</span> : bv &gt; av ? -<span class="hljs-number">1</span> : <span class="hljs-number">0</span>);
            };
        }
        <span class="hljs-comment">/**
         * Clear the states for the currentPath.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clear</span><span class="hljs-params">(pathState)</span> {</span>
            <span class="hljs-keyword">var</span> i;
            pathState = pathState || getPathState(getPath());
            pathState.$order.length = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> pathState) {
                <span class="hljs-keyword">if</span> (pathState.hasOwnProperty(i) &amp;&amp; !isPrivate(i) &amp;&amp; pathState[i] !== sortOptions.NONE) {
                    pathState[i] = sortOptions.NONE;
                }
            }
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearAll</span><span class="hljs-params">()</span> {</span>
            states = {};
            multipleStates = {};
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> {</span>
            states = <span class="hljs-literal">null</span>;
            multipleStates = <span class="hljs-literal">null</span>;
            ignoreParamsInPath = <span class="hljs-literal">null</span>;
            defaultAllowMultipleStates = <span class="hljs-literal">null</span>;
            sortOptions = <span class="hljs-literal">null</span>;
            result = <span class="hljs-literal">null</span>;
        }
        result.getPath = getPath;
        result.getAllowMultipleStates = getAllowMultipleStates;
        result.setAllowMultipleStates = setAllowMultipleStates;
        result.getIgnoreParamsInPath = getIgnoreParamsInPath;
        result.setIgnoreParamsInPath = setIgnoreParamsInPath;
        result.getPathState = getPathState;
        result.setPathState = setPathState;
        result.getState = getState;
        result.setState = setState;
        result.toggle = toggle;
        result.dirtyState = dirtyState;
        result.clearDirty = clearDirty;
        result.sortNone = sortNone;
        result.createAscSort = createAscSort;
        result.createDescSort = createDescSort;
        result.hasDirtySortState = hasDirtySortState;
        result.createKeyFromStates = createKeyFromStates;
        result.isPrivate = isPrivate;
        result.clear = clear;
        result.clearAll = clearAll;
        result.destroy = destroy;
        <span class="hljs-keyword">return</span> result;
    }();
    <span class="hljs-keyword">return</span> exports.datagrid.sortStatesModel;
} ]);

angular.module(<span class="hljs-string">"ux"</span>).factory(<span class="hljs-string">"sortModel"</span>, [ <span class="hljs-string">"sortStatesModel"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sortStatesModel)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortModel</span><span class="hljs-params">(exp)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>cache is the stored sort values. It needs to be cleared if the data changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> result = exports.logWrapper(<span class="hljs-string">"sortModel"</span>, {}, <span class="hljs-string">"blue"</span>, exp.dispatch), sorts = {}, original, cache = {}, lastSortResult;
        result.addSortColumn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSortColumn</span><span class="hljs-params">(name, methods)</span> {</span>
            sorts[name] = methods;
        };
        result.getCache = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCache</span><span class="hljs-params">(key)</span> {</span>
            <span class="hljs-keyword">return</span> cache[key];
        };
        result.setCache = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setCache</span><span class="hljs-params">(key, value)</span> {</span>
            cache[key] = value;
        };
        result.applySorts = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applySorts</span><span class="hljs-params">(ary, sortOptions)</span> {</span>
            <span class="hljs-keyword">var</span> pathStateRef = sortStatesModel.getPathState(), currentPathState = angular.copy(pathStateRef);
            <span class="hljs-keyword">if</span> (sortOptions) {
                result.log(<span class="hljs-string">"apply sortOptions"</span>);
                sortStatesModel.setPathState(sortOptions);
            }
            <span class="hljs-keyword">if</span> (original !== ary || sortStatesModel.hasDirtySortState(pathStateRef)) {
                original = ary;
                result.setCache(<span class="hljs-string">""</span>, original);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>the original is always without any sort options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> key = sortStatesModel.createKeyFromStates(pathStateRef), event, pathState = angular.copy(pathStateRef);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>clone so they cannot mess with the data directly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                result.info(<span class="hljs-string">"applySorts %s"</span>, key);
                event = exp.dispatch(exports.datagrid.events.ON_BEFORE_SORT, key, currentPathState, pathState);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>prevent default on event to prevent sort.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (!event.defaultPrevented) {
                    <span class="hljs-keyword">if</span> (!result.getCache(key)) {
                        result.log(<span class="hljs-string">"	store sort %s"</span>, key);
                        result.setCache(key, original.slice(<span class="hljs-number">0</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>clone it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        ux.each(pathState.$order, applyListSort, {
                            grouped: exp.grouped,
                            pathState: pathState,
                            ary: result.getCache(key)
                        });
                    }
                    lastSortResult = result.getCache(key);
                    sortStatesModel.clearDirty(pathStateRef);
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>TODO: need to unit test this to make sure it works with async sort.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    lastSortResult = original;
                }
                exp.dispatch(exports.datagrid.events.ON_AFTER_SORT, key, pathState, currentPathState);
            }
            <span class="hljs-keyword">return</span> lastSortResult;
        };
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortArray</span><span class="hljs-params">(ary, columnName, pathState)</span> {</span>
            ux.util.array.sort(ary, sorts[columnName][pathState[columnName]]);
            <span class="hljs-keyword">return</span> ary;
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyListSort</span><span class="hljs-params">(columnName, index, list, data)</span> {</span>
            <span class="hljs-keyword">var</span> i, len;
            <span class="hljs-keyword">if</span> (data.grouped &amp;&amp; data.ary[<span class="hljs-number">0</span>].hasOwnProperty(data.grouped)) {
                len = data.ary.length;
                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">1</span>) {
                    data.ary[i] = angular.extend({}, data.ary[i]);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>shallow copy</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    data.ary[i][data.grouped] = sortArray(data.ary[i][data.grouped].slice(<span class="hljs-number">0</span>), columnName, data.pathState);
                }
            } <span class="hljs-keyword">else</span> {
                sortArray(data.ary, columnName, data.pathState);
            }
        }
        result.isApplied = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isApplied</span><span class="hljs-params">(name, methodName)</span> {</span>
            <span class="hljs-keyword">return</span> sortStatesModel.getPathState()[name] === methodName;
        };
        result.getSortStateOf = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSortStateOf</span><span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> sortStatesModel.getPathState()[name];
        };
        result.multipleSort = sortStatesModel.setAllowMultipleStates;
        result.getSortKey = sortStatesModel.createKeyFromStates;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSortsFromOptions</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> i, methods, pathState = sortStatesModel.getPathState();
            <span class="hljs-keyword">if</span> (exp.options.sorts) {
                <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> exp.options.sorts) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exp.options.sorts[i] === <span class="hljs-string">"object"</span>) {
                        sortStatesModel.setState(i, exp.options.sorts[i].value, pathState);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>value is the default sort state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        methods = exp.options.sorts[i];
                    } <span class="hljs-keyword">else</span> {
                        sortStatesModel.setState(i, exp.options.sorts[i], pathState);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>set the default sort state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        methods = {
                            asc: sortStatesModel.createAscSort(i),
                            desc: sortStatesModel.createDescSort(i),
                            none: sortStatesModel.sortNone
                        };
                    }
                    result.addSortColumn(i, methods);
                }
            }
        }
        result.toggleSort = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggleSort</span><span class="hljs-params">(name)</span> {</span>
            result.log(<span class="hljs-string">"toggleSort %s"</span>, name);
            sortStatesModel.toggle(name);
            result.applySorts(original);
        };
        result.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> {</span>
            cache = {};
        };
        result.destroy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> {</span>
            result = <span class="hljs-literal">null</span>;
            lastSortResult = <span class="hljs-literal">null</span>;
            sorts = <span class="hljs-literal">null</span>;
            cache = <span class="hljs-literal">null</span>;
            original = <span class="hljs-literal">null</span>;
            exp = <span class="hljs-literal">null</span>;
        };
        exp.sortModel = result;
        addSortsFromOptions();
        <span class="hljs-keyword">return</span> exp;
    };
} ]);
}(<span class="hljs-keyword">this</span>.ux = <span class="hljs-keyword">this</span>.ux || {}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;}()));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
