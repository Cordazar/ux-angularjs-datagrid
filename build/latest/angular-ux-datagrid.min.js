/*
* uxDatagrid v.0.5.3
* (c) 2014, WebUX
* https://github.com/webux/ux-angularjs-datagrid
* License: MIT.
*/
function charPack(a,b){for(var c="";c.length<b;)c+=a;return c}function each(a,b){var c,d,e,f=0;if(arguments.length>2&&(e=exports.util.array.toArray(arguments),e.splice(0,2)),a&&a.length)for(c=a.length;c>f;){if(d=b.apply(null,[a[f],f,a].concat(e)),void 0!==d)return d;f+=1}else if(!(a instanceof Array))for(f in a)if(a.hasOwnProperty(f)&&(d=b.apply(null,[a[f],f,a].concat(e)),void 0!==d))return d;return a}function filter(a,b){var c,d,e,f=0,g=[];if(arguments.length>2&&(d=exports.util.array.toArray(arguments),d.splice(0,2)),a&&a.length)for(c=a.length;c>f;)e=b.apply(null,[a[f],f,a].concat(d)),e&&g.push(a[f]),f+=1;else for(f in a)a.hasOwnProperty(f)&&(e=b.apply(null,[a[f],f,a].concat(d)),e&&g.push(a[f]));return g}function dispatcher(a,b,c){function d(a,b){var c,d;d=h[a],d&&(b?(c=d.indexOf(b),-1!==c&&d.splice(c,1)):d.length=0)}function e(a,b){return h[a]=h[a]||[],h[a].push(b),function(){d(a,b)}}function f(b,c){return b&&b.apply(a,c)}function g(a){if(h[a])for(var b=0,c=h[a],d=c.length;d>b;)f(c[b],arguments),b+=1}var h={};b&&c?(a.on=b[c.on]&&b[c.on].bind(b),a.off=b[c.off]&&b[c.off].bind(b),a.dispatch=b[c.dispatch].bind(b)):(a.on=e,a.off=d,a.dispatch=g)}function toArray(a){var b=[],c=0,d=a.length;if(void 0!==a.length)for(;d>c;)b.push(a[c]),c+=1;else for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}function sort(a,b){var c,d,e,f,g;for(b||(b=function(a,b){return a>b?1:b>a?-1:0}),d=a.length,f=d-1,c=0;d>c;c+=1)for(e=0;f>e;e+=1)b(a[e],a[e+1])>0&&(g=a[e+1],a[e+1]=a[e],a[e]=g);return a}function Flow(a,b){function c(a){return a.toString().split(/\b/)[2]}function d(a,b,d){return{label:c(a),method:a,args:b||[],delay:d}}function e(a){var b=c(a);D[b]=a}function f(b){for(var c=0,d=A.length;d>c;)A[c].label===b.label&&A[c]!==z&&(a.log("clear duplicate item %c%s",F,b.label),A.splice(c,1),c-=1,d-=1),c+=1}function g(a,b,c){var e=d(a,b,c);D[e.label]&&f(e),A.push(e),y&&p()}function h(a,b,c){A.splice(1,0,d(a,b,c))}function i(a){f({label:c(a)})}function j(b,c){var e,f=d(b,[],c),g=Date.now(),h=function(){a.log("exec timeout method %c%s %sms",F,f.label,Date.now()-g),b()};return a.log("wait for timeout method %c%s",F,f.label),e=setTimeout(h,c),E[e]=function(){clearTimeout(e),delete E[e]},e}function k(a){E[a]&&E[a]()}function l(a){var b=a.toString(),c=b.match(/\(.*\)/);return c[0].match(/([\$\w])+/gm)}function m(a){var b=l(a);return!(!b||-1===b.indexOf("done"))}function n(){return x=Date.now(),a.log("finish %c%s took %dms",F,z.label,x-w),z=null,o(A.shift()),A.length&&p(),x-w}function o(a){for(B.unshift(a);B.length>C;)B.pop()}function p(){!z&&A.length&&(z=A[0],a.async&&void 0!==z.delay?(a.log("	delay for %c%s %sms",F,z.label,z.delay),clearTimeout(v),v=setTimeout(q,z.delay)):q())}function q(){a.log("start method %c%s",F,z.label);var b=m(z.method);b&&z.args.push(n),w=Date.now(),z.method.apply(null,z.args),b||n()}function r(){y=!0,p()}function s(){var b,c=z?1:0;for(a.log("clear");A.length>c;)b=A.splice(c,1)[0],a.log("	remove %s from flow",b.label)}function t(){return A.length}function u(){clearTimeout(v),A.length=0,a=null}var v,w,x,y=!1,z=null,A=[],B=[],C=10,D={},E={},F="color:#666666;";return a=exports.logWrapper("Flow",a||{},"grey",b),a.async=a.hasOwnProperty("async")?a.async:!0,a.debug=a.hasOwnProperty("debug")?a.debug:0,a.insert=h,a.add=g,a.unique=e,a.remove=i,a.timeout=j,a.stopTimeout=k,a.run=r,a.clear=s,a.length=t,a.destroy=u,a}function Datagrid(a,b,c,d){function e(){rb.unique(jb),rb.unique(bb),rb.unique(V)}function f(){Ib.name=a.$eval(c.gridName)||"datagrid",Ib.scope=a,Ib.element=b,Ib.attr=c,Ib.rowsLength=0,Ib.scopes=yb,Ib.data=Ib.data||[],Ib.unwatchers=xb,Ib.values=Gb,Ib.start=k,Ib.update=cb,Ib.reset=jb,Ib.isReady=q,Ib.forceRenderScope=kb,Ib.dispatch=ob,Ib.render=function(){rb.add(bb)},Ib.updateHeights=mb,Ib.getOffsetIndex=S,Ib.isActive=R,Ib.isCompiled=x,Ib.swapItem=t,Ib.getScope=u,Ib.getRowItem=v,Ib.getRowElm=w,Ib.getRowIndex=Ib.getIndexOf=y,Ib.getRowOffset=A,Ib.getRowHeight=B,Ib.getViewportHeight=C,Ib.getContentHeight=D,Ib.getContent=j,Ib.safeDigest=J,Ib.getRowIndexFromElement=z,Ib.updateViewportHeight=p,Ib.calculateViewportHeight=r,Ib.options=ub=exports.extend({},exports.datagrid.options,a.$eval(c.options)||{}),Ib.flow=rb=new Flow({async:ub.hasOwnProperty("async")?!!ub.async:!0,debug:ub.hasOwnProperty("debug")?ub.debug:0},Ib.dispatch),Ib.grouped=a.$eval(c.grouped),rb.add(e),rb.run()}function g(){var a,c=b[0].getElementsByClassName(ub.contentClass),d=ub.contentClass;return c=exports.filter(c,i),a=c[0],a&&(d=a.className||ub.contentClass),a||(d=h()||d,a=angular.element('<div class="'+d+'"></div>'),Ib.options.chunks.detachDom&&a.css({position:"relative"}),b.prepend(a)),a[0]||(a=angular.element(a)),a}function h(){var a,b;return tb?(a=exports.util.array.toArray(tb[0].classList),b=a.indexOf("old-"+ub.contentClass),-1!==b&&a.splice(b,1),a.join(" ")):void 0}function i(a){return angular.element(a).hasClass("old-"+ub.contentClass)?!1:!0}function j(){return sb}function k(){Ib.dispatch(exports.datagrid.events.ON_INIT),sb=g(),l(0)}function l(a){if(!Ib.element[0].offsetHeight){if(1>a)return rb.add(l,[a+1],0),void 0;rb.warn("Datagrid: Dom Element does not have a height.")}rb.add(Ib.templateModel.createTemplates,null,0),rb.add(function(){ub.dynamicRowHeights=Ib.templateModel.dynamicHeights()}),rb.add(m)}function m(){var b=a.$on(exports.datagrid.events.ON_BEFORE_RENDER_AFTER_DATA_CHANGE,function(){b(),rb.add(ob,[exports.datagrid.events.ON_STARTUP_COMPLETE])});window.addEventListener("resize",s),xb.push(a.$on(exports.datagrid.events.UPDATE,cb)),xb.push(a.$on(exports.datagrid.events.ON_ROW_TEMPLATE_CHANGE,lb)),xb.push(a.$on("$destroy",qb)),rb.add(n,[],0),Ib.dispatch(exports.datagrid.events.ON_LISTENERS_READY)}function n(){wb||(Ib.log("setupChangeWatcher"),wb=!0,xb.push(a.$watchCollection(c.uxDatagrid,o)),rb.add(bb))}function o(a,b){rb.add(hb,[a,b])}function p(){Cb=Ib.calculateViewportHeight()}function q(){return Fb===Db.READY}function r(){return b[0].offsetHeight}function s(){setTimeout(function(){mb()},100)}function t(a,b){var c,d,e=y(a);Ib.data.hasOwnProperty(e)&&(c=Ib.templateModel.getTemplate(a),d=Ib.templateModel.getTemplate(b),Ib.data[e]=b,c!==d?Ib.templateModel.setTemplate(e,d):(yb[e][d.item]=b,J(yb[e])))}function u(a){return yb[a]}function v(a){return this.getData()[a]}function w(a){return angular.element(Ib.chunkModel.getRow(a))}function x(a){return!!yb[a]}function y(a){return Ib.getNormalizedIndex(a,0)}function z(a){if(b[0].contains(a[0]||a)){for(var c=a.scope?a.scope():angular.element(a).scope();c&&c.$parent&&c.$parent!==Ib.scope;)c=c.$parent;return c.$index}return-1}function A(a){return void 0===Bb[a]&&(ub.dynamicRowHeights?U():Bb[a]=a*ub.rowHeight),Bb[a]}function B(a){return Ib.templateModel.getTemplateHeight(Ib.data[a])}function C(){return Cb}function D(){var a=Ib.chunkModel.getChunkList();return a&&a.height||0}function E(a){Ib.log("OVERWRITE DOM!!!");var b=a.length;rb.insert(Ib.chunkModel.chunkDom,[a,ub.chunks.size,'<div class="'+ub.chunks.chunkClass+'">',"</div>",sb]),Ib.rowsLength=b,Ib.log("created %s dom elements",b)}function F(b){var c,e,f,g=yb[b];return g||(g=a.$new(),c=u(b-1),e=Ib.templateModel.getTemplate(Ib.data[b]),c&&(c.$$nextSibling=g,g.$$prevSibling=c),g.$status=ub.compiledClass,g[e.item]=Ib.data[b],g.$index=b,yb[b]=g,f=w(b),f.removeClass(ub.uncompiledClass),d(f)(g),P(g)),g}function G(a){Ib.log("	buildRows %s",a.length),Fb=Db.BUILDING,rb.insert(E,[a])}function H(){Ib.log("	ready"),Fb=Db.READY,rb.add(bb),rb.add(I),rb.add(J,[a])}function I(){a.$emit(exports.datagrid.events.ON_READY)}function J(a){a.$$phase||a.$digest()}function K(a,b,c){for(;a;){for(var d in b)b.hasOwnProperty(d)&&c(a,b,d);a=a.$parent}}function L(a,b){K(a,b,M)}function M(a,b,c){a.$$listenerCount[c]+=b[c]}function N(a,b){K(a,b,O)}function O(a,b,c){a.$$listenerCount[c]-=b[c]}function P(a,b){var c;if(b=b||0,a&&!R(a)){if(b||a.$emit(exports.datagrid.events.ON_BEFORE_ROW_DEACTIVATE),a.$$$watchers=a.$$watchers,a.$$watchers=[],b||(a.$$$listenerCount=a.$$listenerCount,a.$$listenerCount=angular.copy(a.$$$listenerCount),N(a,a.$$$listenerCount)),a.$$childHead)for(c=a.$$childHead;c;)P(c,b+1),c=c.$$nextSibling;return!0}return!1}function Q(a,b){var c;if(b=b||0,a&&a.$$$watchers){if(a.$$watchers=a.$$$watchers,a.$$$watchers=null,b||(L(a,a.$$$listenerCount),a.$$$listenerCount=null),a.$$childHead)for(c=a.$$childHead;c;)Q(c,b+1),c=c.$$nextSibling;return b||a.$emit(exports.datagrid.events.ON_AFTER_ROW_ACTIVATE),!0}return!(!a||a.$$$watchers)}function R(a){var b=yb[a];return!(!b||b.$$$watchers)}function S(a){var b=Math.floor(a/Ib.templateModel.averageTemplateHeight()),c=0,d=Ib.rowsLength;if(!a||Ib.rowsLength<2)return c;for(Bb[b]&&Bb[b]<=a&&(c=b);d>c;){if(Bb[c]<=a&&Bb[c+1]>a)return c;c+=1}return c}function T(){var a=Cb,b=Gb.scroll||0,c={startIndex:0,i:0,inc:1,end:Ib.rowsLength,visibleScrollStart:b+ub.cushion,visibleScrollEnd:b+a-ub.cushion};return c.startIndex=c.i=S(b),c}function U(){for(var a=0,b=0;b<Ib.rowsLength;)Bb[b]=a,a+=Ib.templateModel.getTemplateHeight(Ib.data[b]),b+=1;ub.rowHeight=Ib.rowsLength?Ib.templateModel.getTemplateHeight("default"):0,Ib.getContent().css({height:D()})}function V(){var b,c,d,e=T(),f=40*e.i,g=[].concat(zb);if(!(e.i<0)){for(Ib.dispatch(Eb.ON_BEFORE_UPDATE_WATCHERS,e),Y(),zb.length=0,Ib.log("	visibleScrollStart %s visibleScrollEnd %s",e.visibleScrollStart,e.visibleScrollEnd);e.i<Ib.rowsLength&&(d=a.$$childHead?yb[e.i-1]:null,f=A(e.i),f>=e.visibleScrollStart&&f<=e.visibleScrollEnd&&(c=F(e.i),void 0===e.started&&(e.started=e.i),Z(e.i),Q(c)&&(b=g.indexOf(e.i),-1!==b&&g.splice(b,1),zb.push(e.i),J(c),c.$digested=!0)),e.i+=e.inc,!(e.inc>0&&f>e.visibleScrollEnd||e.inc<0&&f<e.visibleScrollStart)););e.ended=e.i-1,Ib.log("	startIndex %s endIndex %s",e.startIndex,e.i),W(g),Ab=e.visibleScrollStart,Ib.log("	activated %s",zb.join(", ")),X(),Ib.dispatch(Eb.ON_AFTER_UPDATE_WATCHERS,e)}}function W(a){for(var b,c=[];a.length;)b=a.pop(),c.push(b),P(yb[b]);Ib.log("	deactivated %s",c.join(", "))}function X(){if(zb.length){var b,c=zb[zb.length-1],d=0,e=zb.length;for(a.$$childHead=yb[zb[0]],a.$$childTail=yb[c];e>d;)b=yb[zb[d]],b.$$prevSibling=yb[zb[d-1]],b.$$nextSibling=yb[zb[d+1]],b.$parent=a,d+=1}}function Y(){Gb.activeRange.min=Gb.activeRange.max=-1}function Z(a){Gb.activeRange.min=Gb.activeRange.min<a&&Gb.activeRange.min>=0?Gb.activeRange.min:a,Gb.activeRange.max=Gb.activeRange.max>a&&Gb.activeRange.max>=0?Gb.activeRange.max:a}function $(){Gb.dirty&&ob(exports.datagrid.events.ON_BEFORE_RENDER_AFTER_DATA_CHANGE)}function _(){var a;Gb.dirty&&Gb.activeRange.max>=0&&(Gb.dirty=!1,a=w(Gb.activeRange.min)[0].offsetHeight,Ib.getData().length&&a!==Ib.templateModel.getTemplateHeight(Ib.getData()[Gb.activeRange.min])&&Ib.templateModel.updateTemplateHeights(),ob(exports.datagrid.events.ON_RENDER_AFTER_DATA_CHANGE))}function ab(){return Cb?(vb&&Ib.info("datagrid has height of %s.",Cb),!0):(vb+=1,2>vb?(Ib.info("datagrid is waiting for element to have a height."),rb.add(Ib.updateViewportHeight,null,0),rb.add(bb)):rb.warn("Datagrid: Unable to determine a height for the datagrid. Cannot render. Exiting."),!1)}function bb(){if(Ib.log("render"),ab())if(vb=0,Ib.log("	render %s",Fb),Fb===Db.BUILDING)rb.length()?(rb.insert(H),rb.insert(U,null,0),rb.insert(G,[Ib.data])):(rb.add(G,[Ib.data],0),rb.add(U),rb.add(H));else{if(Fb!==Db.READY)throw new Error(exports.errors.E1001);Ib.dispatch(exports.datagrid.events.ON_BEFORE_RENDER),rb.add($),rb.add(V),rb.add(_,null,0),rb.add(Ib.dispatch,[exports.datagrid.events.ON_AFTER_RENDER])}else Ib.log("	not ready to render.")}function cb(){Ib.warn("force update"),hb(a.$eval(c.uxDatagrid),Ib.data)}function db(a,b){if(a&&b&&a.length===b.length){for(var c=0,d=a.length;d>c;){if(eb(a[c],b[c]))return!0;c+=1}return Ib.data.length!==Ib.normalize(a,Ib.grouped).length?(Ib.log("	dirtyCheckData length is different"),!0):!1}return!0}function eb(a,b){return Ib.templateModel.getTemplate(a)!==Ib.templateModel.getTemplate(b)?(Ib.log("	dirtyCheckData row template changed"),!0):!1}function fb(a){Ib.log("	mapData()"),Ib.data=Ib.setData(a,Ib.grouped)||[],exports.each(Ib.getData(),gb)}function gb(a,b){var c;yb[b]&&(c=Ib.templateModel.getTemplate(a),yb[b][c.item]=a)}function hb(b,d){if(Ib.log("onDataChanged"),Ib.grouped=a.$eval(c.grouped),d!==Ib.getOriginalData()&&(d=Ib.getOriginalData()),Ib.options.smartUpdate&&Ib.data.length&&!db(b,d))Gb.dirty=!0,fb(b),bb();else{var e=ob(exports.datagrid.events.ON_BEFORE_DATA_CHANGE,b,d);e.defaultPrevented&&e.newValue&&(b=e.newValue),Gb.dirty=!0,rb.add(ib,[b,d])}}function ib(a,b){Ib.log("	changeData"),ob(exports.datagrid.events.ON_BEFORE_RESET),Ib.data=Ib.setData(a,Ib.grouped)||[],ob(exports.datagrid.events.ON_AFTER_DATA_CHANGE,Ib.data,b),jb()}function jb(){Ib.info("reset start"),rb.clear(),pb(),Bb={},zb.length=0,yb.length=0,sb.children().unbind(),sb.children().remove(),Ib.chunkModel.reset(Ib.data,sb,yb),Ib.rowsLength=Ib.data.length,U(),p(),bb(),rb.add(Ib.info,["reset complete"]),rb.add(ob,[exports.datagrid.events.ON_AFTER_RESET],0),rb.add(ob,[exports.datagrid.events.ON_AFTER_HEIGHTS_UPDATED_RENDER])}function kb(b){var c=yb[b];!c&&b>=0&&b<Ib.rowsLength&&(c=F(b)),c&&!a.$$phase&&(Q(c),c.$digest(),P(c),c.$digested=!0)}function lb(b,c){var d=Ib.getNormalizedIndex(c),e=w(d),f=e.hasClass(ub.uncompiledClass)?F(d):e.scope();f!==a&&(f.$destroy(),yb[d]=null,e.replaceWith(Ib.templateModel.getTemplate(c).template),yb[d]=F(d),mb(d))}function mb(a){rb.add(p),rb.add(Ib.chunkModel.updateAllChunkHeights,[a]),rb.add(U),rb.add(bb),rb.add(Ib.dispatch,[exports.datagrid.events.ON_AFTER_HEIGHTS_UPDATED_RENDER])}function nb(a){return-1!==Hb.indexOf(a)}function ob(b){return!nb(b)&&ub.debug&&1===ub.debug.all&&Ib.log("$emit %s",b),a.$emit.apply(a,arguments)}function pb(){var b,c,d=0;each(yb,function(a,e){if(a){for(a.$$prevSibling=b||void 0,d=e;!c&&d<Ib.rowsLength;)d+=1,c=yb[d]||void 0;Q(a),b=a,a.$destroy()}}),a.$$childHead=void 0,a.$$childTail=void 0,yb.length=0}function qb(){for(a.datagrid=null,Ib.log("destroying grid"),window.removeEventListener("resize",s),clearTimeout(Gb.scrollingStopIntv),rb.destroy(),Ib.flow=void 0,rb=null;xb.length;)xb.pop()();Ib.destroyLogger();for(var e in Ib)Ib[e]&&Ib[e].hasOwnProperty("destroy")&&(Ib[e].destroy(),Ib[e]=null);pb(),b.remove(),delete a.$parent[Ib.name],Bb=null,Ib=null,a=null,b=null,c=null,xb=null,sb=null,zb.length=0,zb=null,yb.length=0,yb=null,Gb=null,Db=null,Eb=null,ub=null,Gb=null,Hb=null,d=null}var rb,sb,tb,ub,vb=0,wb=!1,xb=[],yb=[],zb=[],Ab=0,Bb={},Cb=0,Db=exports.datagrid.states,Eb=exports.datagrid.events,Fb=Db.BUILDING,Gb={dirty:!1,scroll:0,speed:0,absSpeed:0,scrollPercent:0,touchDown:!1,scrollingStopIntv:null,activeRange:{min:0,max:0}},Hb=[exports.datagrid.events.LOG,exports.datagrid.events.INFO,exports.datagrid.events.WARN,exports.datagrid.events.ERROR],Ib={};return exports.logWrapper("datagrid event",Ib,"grey",ob),exports.logWrapper("datagrid",Ib,"green",ob),a.datagrid=Ib,f(),Ib}function ChunkArray(a){this.uid=ChunkArray.uid++,this.enabled=!0,this.min=0,this.max=0,this.templateStart="",this.templateEnd="",this.parent=null,this.mode=a?ChunkArray.DETACHED:ChunkArray.ATTACHED,this.detachDom=a,this.index=0}exports.errors={E1001:"",E1101:"",E1102:""},exports.each(exports.errors,function(a,b){exports.errors[b]=b});var module;try{module=angular.module("ux",["ng"])}catch(e){module=angular.module("ux")}exports.datagrid={isIOS:!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),states:{BUILDING:"datagrid:building",READY:"datagrid:ready"},events:{ON_INIT:"datagrid:onInit",ON_LISTENERS_READY:"datagrid:onListenersReady",ON_READY:"datagrid:onReady",ON_STARTUP_COMPLETE:"datagrid:onStartupComplete",ON_BEFORE_RENDER:"datagrid:onBeforeRender",ON_AFTER_RENDER:"datagrid:onAfterRender",ON_BEFORE_UPDATE_WATCHERS:"datagrid:onBeforeUpdateWatchers",ON_AFTER_UPDATE_WATCHERS:"datagrid:onAfterUpdateWatchers",ON_BEFORE_DATA_CHANGE:"datagrid:onBeforeDataChange",ON_AFTER_DATA_CHANGE:"datagrid:onAfterDataChange",ON_BEFORE_RENDER_AFTER_DATA_CHANGE:"datagrid:onBeforeRenderAfterDataChange",ON_RENDER_AFTER_DATA_CHANGE:"datagrid:onRenderAfterDataChange",ON_ROW_TEMPLATE_CHANGE:"datagrid:onRowTemplateChange",ON_SCROLL:"datagrid:onScroll",ON_BEFORE_RESET:"datagrid:onBeforeReset",ON_AFTER_RESET:"datagrid:onAfterReset",ON_AFTER_HEIGHTS_UPDATED_RENDER:"datagrid:onAfterHeightsUpdatedRender",ON_BEFORE_ROW_DEACTIVATE:"datagrid:onBeforeRowDeactivate",ON_AFTER_ROW_ACTIVATE:"datagrid:onAFterRowActivate",RESIZE:"datagrid:resize",UPDATE:"datagrid:update",SCROLL_TO_INDEX:"datagrid:scrollToIndex",SCROLL_TO_ITEM:"datagrid:scrollToItem",SCROLL_INTO_VIEW:"datagrid:scrollIntoView",LOG:"datagrid:log",INFO:"datagrid:info",WARN:"datagrid:warn",ERROR:"datagrid:error"},options:{async:!0,updateDelay:100,creepRender:{enable:!0},creepStartDelay:1e3,cushion:-100,chunks:{detachDom:null,size:50,chunkClass:"datagrid-chunk",chunkDisabledClass:"datagrid-chunk-disabled",chunkReadyClass:"datagrid-chunk-ready"},chunkSize:50,compiledClass:"compiled",uncompiledClass:"uncompiled",contentClass:"datagrid-content",rowClass:"datagrid-row",renderThreshold:1,renderThresholdWait:50,renderWhileScrolling:!1,creepLimit:500,smartUpdate:!0},coreAddons:[]},module.factory("gridAddons",["$injector",function(a){function b(b,c){for(var d,e,f=0,g=b.length;g>f;){if(d=a.get(b[f]),"function"!=typeof d)throw new Error("Addons expect a function to pass the grid instance to.");e=a.invoke(d,c,{inst:c}),f+=1}}return function(a,c){c=c instanceof Array?c:c&&c.replace(/,/g," ").replace(/\s+/g," ").split(" ")||[],a.addons&&(c=a.addons=a.addons.concat(c)),b(c,a)}}]),exports.css=function(){function a(a){return b(a)||(i[a]=c(a)),b(a)}function b(a){return i[a]}function c(a){if(document.styleSheets&&0!==document.getElementsByTagName(k.head).length){var b,c,d,e;if(document.styleSheets.length>0)for(d=0;d<document.styleSheets.length&&(document.styleSheets[d].disabled||(e=document.styleSheets[d].media,c=typeof e,c===k.string?(""===e||-1!==e.indexOf(k.screen))&&(b=document.styleSheets[d]):c===k.object&&(""===e.mediaText||-1!==e.mediaText.indexOf(k.screen))&&(b=document.styleSheets[d]),"undefined"==typeof b));d++);var f=document.createElement("style");for(f.type="text/css",f.title=a,document.getElementsByTagName(k.head)[0].appendChild(f),d=0;d<document.styleSheets.length;d++)document.styleSheets[d].disabled||(b=document.styleSheets[d]);return{name:a,styleSheet:b}}}function d(c,d,e){var f,g=b(c)||a(c),h=g.styleSheet;if(h.addRule){for(f=0;f<h.rules.length;f++)if(h.rules[f].selectorText&&h.rules[f].selectorText.toLowerCase()===d.toLowerCase())return h.rules[f].style.cssText=e,void 0;h.addRule(d,e)}else if(h.insertRule){for(f=0;f<h.cssRules.length;f++)if(h.cssRules[f].selectorText&&h.cssRules[f].selectorText.toLowerCase()===d.toLowerCase())return h.cssRules[f].style.cssText=e,void 0;h.insertRule(d+"{"+e+"}",0)}}function e(a){var b,c,d,e,g;if(-1!==a.indexOf("{")||-1!==a.indexOf("}"))return null;if(j[a])return j[a];for(b=0,c=document.styleSheets.length;c>b;b+=1)if(d=document.styleSheets[b],e=d.rules||d.cssRules,g=f(e,a))return g;return null}function f(a,b){var c,d,e,g;if(a)for(c=0,d=a.length;d>c;c+=1){if(e=a[c],e.cssRules&&(g=f(e.cssRules,b)))return g;if(e.selectorText){var h="(\b)*"+b.replace(".","\\.")+"([^-a-zA-Z0-9]|,|$)",i=e.selectorText.match(h);if(i&&-1!==i.indexOf(b))return j[b]=e.style,e.style}}return null}function g(a,b){var c=e(a);return c&&void 0!==c[b]?c[b]:null}function h(a,b,c){var d=e(a);d[b]=c}var i={},j={},k={head:"head",screen:"screen",string:"string",object:"object"};return{createdStyleSheets:[],createStyleSheet:c,createClass:d,getCSSValue:g,setCSSValue:h}}(),exports.each=each,exports.filter=filter,exports.extend=function(a){for(var b,c,d=exports.util.array.toArray(arguments),e=1,f=d.length;f>e;){b=d[e];for(c in b)a[c]=a[c]&&"object"==typeof a[c]?exports.extend(a[c],b[c]):b[c];e+=1}return a},exports.util=exports.util||{},exports.util.array=exports.util.array||{},exports.util.array.toArray=toArray,exports.util.array.sort=sort,exports.logWrapper=function(a,b,c,d){return c=c||"black",d=d||b.dispatch||function(){},b.$logName=a,b.log=b.info=b.warn=b.error=function(){},b.log=function(){var e=[exports.datagrid.events.LOG,a,c].concat(exports.util.array.toArray(arguments));d.apply(b,e)},b.info=function(){var e=[exports.datagrid.events.INFO,a,c].concat(exports.util.array.toArray(arguments));d.apply(b,e)},b.warn=function(){var e=[exports.datagrid.events.WARN,a,c].concat(exports.util.array.toArray(arguments));d.apply(b,e)},b.error=function(){var e=[exports.datagrid.events.ERROR,a,c].concat(exports.util.array.toArray(arguments));d.apply(b,e)},b.destroyLogger=function(){b.logger&&(b.log("destroy"),b.logger.destroy(),b.logger=null)},b},exports.datagrid.Flow=Flow,module.directive("uxDatagrid",["$compile","gridAddons",function(a,b){return{restrict:"AE",scope:!0,link:{pre:function(c,d,e){var f=new Datagrid(c,d,e,a);each(exports.datagrid.coreAddons,function(a){a.apply(f,[f])}),b(f,e.addons)},post:function(a){a.datagrid.start()}}}}]),exports.datagrid.coreAddons.chunkModel=function(a){function b(){return s}function c(b,d,e,f){for(var g,h,i=0,j=b.length,k=new ChunkArray(a.options.chunks.detachDom);j>i;)h=b[i],i%d===0&&(g&&g.updateHeight(a.templateModel,t),g=new ChunkArray(a.options.chunks.detachDom),g.min=h.min||i,g.templateModel=a.templateModel,g.templateStart=e,g.templateEnd=f,g.parent=k,g.index=k.length,k.push(g)),h instanceof ChunkArray&&(h.parent=g),h instanceof ChunkArray&&(h.index=g.length),g.push(h),g.max=h.max||i,i+=1;return g&&g.updateHeight(a.templateModel,t),k.min||(k.min=k[0]?k[0].min:0,k.max=k[k.length-1]?k[k.length-1].max:0,k.templateStart=e,k.templateEnd=f,k.updateHeight(a.templateModel,t),k.dirtyHeight=!1),k.length>d?c(k,d,e,f):k}function d(b){var c,d;void 0===b?s&&(s.forceHeightReCalc(a.templateModel,t),s.updateHeight(a.templateModel,t,1,!0)):(c=g(b,s),d=e(c,s),d.updateHeight(a.templateModel,t,-1,!0))}function e(a,b){for(var c;a.length;)c=a.shift(),b[c]instanceof ChunkArray&&(b=b[c]);return b}function f(a,b,d,e,f){return y.log("chunkDom"),v=f,u=b,t=a,w=d,x=e,s=c(a,b,d,e),o(s),s.updateDomHeight(1),f}function g(a,b,c){var d,e=0,f=b.length;for(c=c||[];f>e;){if(d=b[e],!(d instanceof ChunkArray)){c.push(a%u);break}if(a>=d.min&&a<=d.max){c.push(e),g(a,d,c);break}e+=1}return c}function h(a){var b=g(a,s),c=k(b);return c&&c.length&&void 0===c.attr("row-id")&&c.attr("row-id",a),c}function i(a,b){for(var c,d=0,e=a.slice(0),f=s,g=v;d<e.length;)c=e.shift(),!f.rendered&&b&&(b(g,f),f.rendered=g,o(f)),e.length||m(f),f=f[c],g=f.rendered||angular.element(g.children()[c]);return g}function j(b,c){var d;b.html(c.getChildrenStr()),d=b.children(),exports.each(d,l),-1!==d[0].className.indexOf(a.options.chunks.chunkClass)&&d.addClass(a.options.chunks.chunkReadyClass)}function k(a){return i(a,j)}function l(a){window.getComputedStyle(a).getPropertyValue("top")}function m(b){return b.compiled||(b.compiled=n(b),b.compiled&&(b.parent&&m(b.parent),a.flow.add(q))),b.compiled}function n(b){var c,d;if(b[0]instanceof ChunkArray){for(c=0,d=b.length;d>c;){if(!b[c].compiled)return!1;c+=1}return!0}for(c=b.min,d=b.max;d>c;){if(!a.isCompiled(c))return!1;c+=1}return!0}function o(b){b.updateDom(a.options.chunks.chunkDisabledClass)}function p(a,b){y.log("reset"),z.length=0,a=a||[],s&&(s.destroy(),s=null,v=null,t=null),f(a,u,w,x,b)}function q(){var b=a.values.activeRange,c=a.options.chunks;s.enableRange(b.min,b.max,c.chunkDisabledClass),c.detachDom&&o(s)}function r(){p(),s=null,t=null,u=null,v=null,w=null,x=null,z.length=0,z=null,a.chunkModel=null,y.destroyLogger(),y=null,a=null}var s,t,u,v,w,x,y=exports.logWrapper("chunkModel",{},"purple",a.dispatch),z=[];return a.flow.unique(o),y.chunkDom=f,y.getChunkList=b,y.getRowIndexes=function(a){return g(a,s)},y.getRow=h,y.reset=p,y.updateAllChunkHeights=d,y.destroy=r,a.scope.$on(exports.datagrid.events.ON_AFTER_UPDATE_WATCHERS,q),dispatcher(y),a.chunkModel=y,y},exports.datagrid.coreAddons.push(exports.datagrid.coreAddons.chunkModel),ChunkArray.uid=0,ChunkArray.DETACHED="chunkArray:detached",ChunkArray.ATTACHED="chunkArray:attached",ChunkArray.prototype=[],ChunkArray.prototype.getStub=function(a){return this.templateStart+a+this.templateEnd},ChunkArray.prototype.inRange=function(a){return a>=this.min&&a<=this.max},ChunkArray.prototype.rangeOverlap=function(a,b,c){var d=!1;for(c=c>0?c:0,a-=c,b+=c;b>a;){if(this.inRange(a)){d=!0;break}a+=1}return d},ChunkArray.prototype.each=function(a,b){for(var c=0,d=this.length;d>c;)a.apply(this[c],b),c+=1},ChunkArray.prototype.getChildrenStr=function(a){for(var b=0,c=this.length,d="",e=this;c>b;)d+=e[b]instanceof ChunkArray?e[b].getStub(a?e[b].getChildrenStr(a):""):this.templateModel.getTemplate(e[b]).template,b+=1;return d},ChunkArray.prototype.updateHeight=function(a,b,c,d){var e,f=0,g=0;if(this[0]instanceof ChunkArray)for(e=this.length;e>f;)1===c&&this[f].updateHeight(a,b,c,d),g+=this[f].height,f+=1;else g=a.getHeight(b,this.min,this.max);this.height!==g&&(this.dirtyHeight=!0,this.height=g),-1==c&&this.dirtyHeight&&this.parent&&this.parent.updateHeight(a,b,c,d),d&&this.dirtyHeight&&this.updateDomHeight()},ChunkArray.prototype.getPreviousSibling=function(){var a,b;return this.parent&&(b=this.index-1,a=this.parent[b],a&&a.index===this.index-1||this.parent.parent&&(a=this.parent.getPreviousSibling(),a&&(a=a.last()))),a},ChunkArray.prototype.getNextSibling=function(){var a,b;return this.parent&&(b=this.index+1,a=this.parent[b],a&&a.index===this.index+1||this.parent.parent&&(a=this.parent.getNextSibling(),a&&(a=a.first()))),a},ChunkArray.prototype.first=function(){return this[0]},ChunkArray.prototype.last=function(){return this[this.length-1]},ChunkArray.prototype.calculateTop=function(){var a,b=0;return this.index&&this.parent&&(a=this.getPreviousSibling(),a&&(b=a.top+a.height)),this.top=b,this.top},ChunkArray.prototype.forceHeightReCalc=function(a,b){var c,d=0,e=0;if(this[0]instanceof ChunkArray)for(c=this.length;c>d;)e+=this[d].forceHeightReCalc(a,b),d+=1;else e=a.getHeight(b,this.min,this.max);return this.height!==e&&(this.height=e,this.setDirtyHeight()),this.height},ChunkArray.prototype.setDirtyHeight=function(){for(var a=this;a;)a.dirtyHeight=!0,a=a.parent},ChunkArray.prototype.getId=function(){if(this._index!==this.index||!this._id){var a=this,b="";for(this._index=this.index;a;)b="."+a.index+b,a=a.parent;this._id=b.substr(1,b.length)}return this._id},ChunkArray.prototype.hasChildChunks=function(){return this._hasChildChunks||(this._hasChildChunks=this.first()instanceof ChunkArray),this._hasChildChunks},ChunkArray.prototype.enableRange=function(a,b,c){this.rangeOverlap(a,b,this.detachDom)?this.enable(c):this.disable(c),this.hasChildChunks()&&this.each(this.enableRange,[a,b,c])},ChunkArray.prototype.enable=function(a){this.enabled||(this.enabled=!0,this.updateDom(a),this.parent&&this.parent.enable(a))},ChunkArray.prototype.disable=function(a){var b,c=0;if(this.compiled){if(this.hasChildChunks())for(b=this.length;b>c;)this[c].disable(a),c+=1;this.enabled&&(this.enabled=!1,this.updateDom(a))}},ChunkArray.prototype.updateDom=function(a){this.rendered&&(!this.rendered.attr("chunk-id"),this.compiled&&!this.rendered.attr("compiled")&&this.rendered.attr("compiled",!0),this.detachDom?this.enabled?this.detached&&(this.detached=!1,this.parent.rendered.append(this.rendered)):this.enabled||this.detached||this.parent&&this.parent.compiled&&this.rendered.parent().length&&(this.detached=!0,this.rendered.remove()):(this.rendered.attr("enabled",this.enabled),this.enabled?(this.rendered.removeAttr("disabled"),this.rendered.removeAttr("read-only"),this.rendered.removeClass(a)):(this.rendered.attr("disabled","disabled"),this.rendered.attr("read-only",!0),this.rendered.addClass(a))),this.each(this.updateDom,[a]))},ChunkArray.prototype.updateDomHeight=function(a){this.mode===ChunkArray.DETACHED&&this.calculateTop(),this.rendered?(this.dirtyHeight=!1,this.mode===ChunkArray.DETACHED&&(this.rendered[0].style.top=this.top+"px"),this.rendered[0].style.height=this.height+"px"):this.createDomTemplates(),-1===a&&this.parent?this.parent.updateDomHeight(a):a&&this.hasChildChunks()&&this.each(this.updateDomHeight,[a])},ChunkArray.prototype.createDomTemplates=function(){if(!this.templateReady){var a=this.templateStart.substr(0,this.templateStart.length-1)+' style="';this.mode===ChunkArray.DETACHED&&(a+="position:absolute;top:"+this.top+"px;left:0px;"),this.templateStart=a+"width:100%;height:"+this.height+'px;">',this.templateReady=!0}},ChunkArray.prototype.children=function(){var a=[];this.each(function(){a.push(this.rendered)},[])},ChunkArray.prototype.destroy=function(){for(this.hasChildChunks()&&this.each(this.destroy),this.templateStart="",this.templateEnd="",this.templateModel=null,this.rendered=null,this.parent=null;this.length;)this.pop();this.length=0},exports.datagrid.events.ON_RENDER_PROGRESS="datagrid:onRenderProgress",exports.datagrid.coreAddons.creepRenderModel=function(a){function b(b){var c=a.getScope(b);c&&c.$digested||a.forceRenderScope(b)}function c(){var b={count:0};return each(a.scopes,d,b),b.count>=a.rowsLength&&w.disable(),{count:b.count,len:a.rowsLength}}function d(a,b,c,d){d.count+=a?1:0}function e(b,c,d){a.values.touchDown||(r=!1,s=Date.now()+a.options.renderThreshold,x=b,y=c,h(i,d))}function f(b,c){var d=exports.util.array.toArray(arguments);return d.splice(0,2),a.options.async?(clearTimeout(q),q=setTimeout(function(){b.apply(null,d)},c)):b.apply(this,d),q}function g(b,c){for(;b>=0&&b<a.rowsLength&&a.isCompiled(b);)b+=c;return b>=0&&b<a.rowsLength?b:c>0?a.rowsLength:-1}function h(c,d){var e=Date.now();s>e&&j()?(x=d?x:g(x,-1),x>=0&&(b(x),d&&(x-=1)),y=d?y:g(y,1),y!==a.rowsLength&&(b(y),d&&(y+=1)),h(c,d)):c()}function i(){if(k(),j()){v+=1,a.values.touchDown||a.values.speed||!j()||l(x,y);var b=c();b!==t&&a.dispatch(exports.datagrid.events.ON_RENDER_PROGRESS,b)}else v=0,w.disable(),t=1,a.dispatch(exports.datagrid.events.ON_RENDER_PROGRESS,1)}function j(){return!!(x>-1||y<a.rowsLength)}function k(){s=0,clearTimeout(u),clearTimeout(q),u=0}function l(b,c,d,g){k(),v<a.options.creepLimit&&(u=f(e,d||a.options.renderThresholdWait,b,c,g))}function m(b,c){l(x,y,a.options.creepStartDelay,c)}function n(){k()}function o(a,b,c){v=0,x=b.started||0,y=b.ended||0,m(a,c)}function p(b){n(b),a.options.creepRender&&a.options.creepRender.enable!==!1&&w.enable()}var q,r,s,t,u=0,v=0,w=exports.logWrapper("creepModel",{},"blue",a.dispatch),x=0,y=0,z=[];w.stop=k,w.destroy=function(){w.disable(),k(),a=null,w=null},w.enable=function(){z.length||(z.push(a.scope.$on(exports.datagrid.events.BEFORE_VIRTUAL_SCROLL_START,n)),z.push(a.scope.$on(exports.datagrid.events.ON_VIRTUAL_SCROLL_UPDATE,n)),z.push(a.scope.$on(exports.datagrid.events.ON_TOUCH_DOWN,n)),z.push(a.scope.$on(exports.datagrid.events.ON_SCROLL_START,n)),z.push(a.scope.$on(exports.datagrid.events.ON_AFTER_UPDATE_WATCHERS,o)))},w.disable=function(){for(w.info("creep Disabled");z.length;)z.pop()()},a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_RESET,p)),a.creepRenderModel=w,a.options.creepRender&&a.options.creepRender.enable?w.enable():w.disable()},exports.datagrid.coreAddons.push(exports.datagrid.coreAddons.creepRenderModel),exports.datagrid.coreAddons.normalizeModel=function(a){function b(c,d,e,f,g){var h;return g=g.slice(0),g.push(d),c===f?g:c[a.grouped]&&c[a.grouped].length&&(h=ux.each(c[a.grouped],b,f,g),h&&h!==c[a.grouped])?h:void 0}var c,d,e=exports.logWrapper("normalizeModel",{},"grey",a.dispatch);return a.normalize=function(b,c,d){b=b||[];var e=0,f=b.length;for(d=d||[];f>e;)d.push(b[e]),b[e]&&b[e][c]&&a.normalize(b[e][c],c,d),e+=1;return d},a.setData=function(b,f){return e.log("setData"),c=b,d=f?a.normalize(b,f):b&&b.slice(0)||[]},a.getData=function(){return d},a.getOriginalData=function(){return c},a.getOriginalIndexOfItem=function(a){var d=ux.each(c,b,a,[]);return d&&d!==c?d:[]},a.getNormalizedIndex=function(b,c){for(var d=c||0;d<a.rowsLength;){if(a.data[d]===b)return d;d+=1}if(c)for(d=c;d>=0;){if(a.data[d]===b)return d;d-=1}return-1},e.destroy=function(){e.destroyLogger(),c=null,d=null,a.normalizeModel=null,a=null,e=null},a.normalizeModel=e,a
},exports.datagrid.coreAddons.push(exports.datagrid.coreAddons.normalizeModel),exports.datagrid.events.ON_SCROLL_START="datagrid:scrollStart",exports.datagrid.events.ON_SCROLL_STOP="datagrid:scrollStop",exports.datagrid.events.ON_TOUCH_DOWN="datagrid:touchDown",exports.datagrid.events.ON_TOUCH_UP="datagrid:touchUp",exports.datagrid.coreAddons.scrollModel=function(a){function b(){k(),a.element.css("overflow")||a.element.css({overflow:"auto"}),o.log("addScrollListener"),c(),a.unwatchers.push(a.scope.$on(exports.datagrid.events.SCROLL_TO_INDEX,function(b,c){a.scrollModel.scrollToIndex(c,!0)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.SCROLL_TO_ITEM,function(b,c){a.scrollModel.scrollToItem(c,!0)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.SCROLL_INTO_VIEW,function(b,c){a.scrollModel.scrollIntoView(c,!0)})),f(),p=!0}function c(){q=!0,a.element[0].addEventListener("scroll",g)}function d(){q&&(o.removeScrollListener(),q=!0),o.removeTouchEvents()}function e(){q&&c(),f()}function f(){o.log("addTouchEvents");var b=a.getContent();b.bind("touchstart",o.onTouchStart),b.bind("touchend",o.onTouchEnd),b.bind("touchcancel",o.onTouchEnd)}function g(b){a.scrollModel.onUpdateScroll(b)}function h(){n=Date.now(),a.scrollModel.onScrollingStop()}function i(b){a.data[b-1]&&!a.isCompiled(b-1)&&a.forceRenderScope(b-1),a.data[b+1]&&!a.isCompiled(b+1)&&a.forceRenderScope(b+1)}function j(){clearTimeout(l),o.destroyLogger(),k(),p&&(o.removeScrollListener(),o.removeTouchEvents()),o=null,a=null}var k,l,m,n,o=exports.logWrapper("scrollModel",{},"orange",a.dispatch),p=!1,q=!1;return o.fireOnScroll=function(){a.values.scroll!==m&&(m=a.values.scroll,a.dispatch(exports.datagrid.events.ON_SCROLL,a.values))},o.removeScrollListener=function(){o.log("removeScrollListener"),a.element[0].removeEventListener("scroll",g)},o.removeTouchEvents=function(){p&&(o.log("removeTouchEvents"),a.getContent().unbind("touchstart",o.onTouchStart),a.getContent().unbind("touchend",o.onTouchEnd),a.getContent().unbind("touchcancel",o.onTouchEnd))},o.onTouchStart=function(b){a.values.touchDown=!0,a.dispatch(exports.datagrid.events.ON_TOUCH_DOWN,b)},o.onTouchEnd=function(b){a.values.touchDown=!1,a.dispatch(exports.datagrid.events.ON_TOUCH_UP,b)},o.getScroll=function(b){return(b||a.element[0]).scrollTop},o.setScroll=function(b){a.element[0].scrollTop=b,a.values.scroll=b},o.onUpdateScroll=function(b){var c=a.scrollModel.getScroll(b.target||b.srcElement);a.values.scroll!==c&&(a.dispatch(exports.datagrid.events.ON_SCROLL_START,c),a.values.speed=c-a.values.scroll,a.values.absSpeed=Math.abs(a.values.speed),a.values.scroll=c,a.values.scrollPercent=(a.values.scroll/a.getContentHeight()*100).toFixed(2)),a.scrollModel.waitForStop(),o.fireOnScroll()},o.scrollTo=function(b,c){a.scrollModel.setScroll(b),c?a.scrollModel.onScrollingStop():a.scrollModel.waitForStop()},o.clearOnScrollingStop=function(){o.onScrollingStop()},o.waitForStop=function(){var b=!1;clearTimeout(l),a.options.renderWhileScrolling&&Date.now()-(a.options.renderWhileScrolling>0||0)>n&&(b=!0),b||!a.flow.async&&!a.values.touchDown?h():l=setTimeout(h,a.options.updateDelay)},o.onScrollingStop=function(){a.values.speed=0,a.values.absSpeed=0,a.render(),o.fireOnScroll(),a.dispatch(exports.datagrid.events.ON_SCROLL_STOP,a.values)},o.scrollToIndex=function(b,c){o.log("scrollToIndex");var d=a.getRowOffset(b);return a.scrollModel.scrollTo(d,c),d},o.scrollToItem=function(b,c){o.log("scrollToItem");var d=a.getNormalizedIndex(b);return-1!==d?a.scrollModel.scrollToIndex(d,c):a.values.scroll},o.scrollIntoView=function(b,c){o.log("scrollIntoView");{var d,e,f="number"==typeof b?b:a.getNormalizedIndex(b),g=a.getRowOffset(f);Math.abs(a.options.cushion)}return i(f),g<a.values.scroll?(a.scrollModel.scrollTo(g,c),void 0):(a.updateViewportHeight(),e=a.getViewportHeight(),d=a.templateModel.getTemplateHeight(a.getData()[f]),g>=a.values.scroll+e-d&&a.scrollModel.scrollTo(g-e+d,c),void 0)},o.scrollToTop=function(b){o.log("scrollToTop"),a.scrollModel.scrollTo(0,b)},o.scrollToBottom=function(b){o.log("scrollToBottom");var c=a.getContentHeight()-a.getViewportHeight();a.scrollModel.scrollTo(c>=0?c:0,b)},k=a.scope.$on(exports.datagrid.events.ON_READY,b),a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_RESET,d)),a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_AFTER_RESET,e)),o.destroy=j,a.scrollModel=o,a},exports.datagrid.coreAddons.push(exports.datagrid.coreAddons.scrollModel),exports.datagrid.coreAddons.templateModel=function(a){"use strict";function b(a){return a=a.replace(/\n/g,""),a=a.replace(/[\t ]+</g,"<"),a=a.replace(/>[\t ]+</g,"><"),a=a.replace(/>[\t ]+$/g,">")}return a.templateModel=function(){function c(){u.log("createTemplates");var b,c=a.element[0].getElementsByTagName("script"),e=c.length;if(!e)throw new Error(exports.errors.E1102);for(b=0;e>b;b+=1)d(c[b]);for(;c.length;)a.element[0].removeChild(c[0])}function d(c){var d,f=b(angular.element(c).html()),g=document.createElement("div"),h=e(c,"template-name")||t;if(g.className="grid-template-wrapper",f=angular.element(f)[0],f.className+=" "+a.options.rowClass+" "+a.options.uncompiledClass+" {{$status}}",f.setAttribute("template",h),a.getContent()[0].appendChild(g),g.appendChild(f),f=b(g.innerHTML),d={name:h,item:e(c,"template-item"),template:f,height:g.offsetHeight},u.log("template: %s %o",h,d),!d.height)throw new Error(exports.errors.E1101);return s[d.name]=d,s.push(d),a.getContent()[0].removeChild(g),r=0,d}function e(a,b){var c=a.attributes["data-"+b]||a.attributes[b];return c&&c.nodeValue||""}function f(){return s}function g(a){return a.attr?a.attr("template"):a.getAttribute("template")}function h(a){return s[a]?s[a]:s[t]}function i(){var a,b;for(a in s)if(s.hasOwnProperty(a)&&(b=b||s[a].height,b!==s[a].height))return!0;return!1}function j(){var a=0,b=s.length;if(!r)for(;b>a;)r+=s[a].height,a+=1;return r/b}function k(){return s.length}function l(a){var b=u.getTemplate(a);return b?b.height:0}function m(a,b,c){var d=b,e=0;if(!a.length)return 0;for(;c>=d;)e+=u.getTemplateHeight(a[d]),d+=1;return e}function n(a,b){a._template=b}function o(b,c){u.log("setTemplate %s %s",b,c);var d="number"==typeof b?a.data[b]:b,e=u.getTemplate(d).name;u.setTemplateName(d,c),a.dispatch(exports.datagrid.events.ON_ROW_TEMPLATE_CHANGE,d,e,c)}function p(){for(var b,c,d,e=a.values.activeRange.min,f=a.values.activeRange.max-e,g=!1,h={};f>e;)c=u.getTemplate(a.getData()[e]),h[c.name]||(b=a.getRowElm(e),d=b[0].offsetHeight,d!==c.height&&(c.height=d,g=!0)),e+=1;g&&a.updateHeights()}function q(){u.destroyLogger(),u=null,s.length=0,s=null}var r,s=[],t="default",u=exports.logWrapper("templateModel",{},"teal",a.dispatch);return u.getTemplate=function(a){return u.getTemplateByName(a._template)},u.defaultName=t,u.createTemplates=c,u.getTemplates=f,u.getTemplateName=g,u.getTemplateByName=h,u.templateCount=k,u.dynamicHeights=i,u.averageTemplateHeight=j,u.getHeight=m,u.getTemplateHeight=l,u.setTemplate=o,u.setTemplateName=n,u.updateTemplateHeights=p,u.destroy=q,u}(),a.templateModel},exports.datagrid.coreAddons.push(exports.datagrid.coreAddons.templateModel);