/*
* uxDatagrid v.0.5.3
* (c) 2014, WebUX
* https://github.com/webux/ux-angularjs-datagrid
* License: MIT.
*/
!function(a){function b(b,c){var d,e,f,g=0;if(arguments.length>2&&(f=a.util.array.toArray(arguments),f.splice(0,2)),b&&b.length)for(d=b.length;d>g;){if(e=c.apply(null,[b[g],g,b].concat(f)),void 0!==e)return e;g+=1}else if(!(b instanceof Array))for(g in b)if(b.hasOwnProperty(g)&&(e=c.apply(null,[b[g],g,b].concat(f)),void 0!==e))return e;return b}function c(b,c){var d,e,f,g=0,h=[];if(arguments.length>2&&(e=a.util.array.toArray(arguments),e.splice(0,2)),b&&b.length)for(d=b.length;d>g;)f=c.apply(null,[b[g],g,b].concat(e)),f&&h.push(b[g]),g+=1;else for(g in b)b.hasOwnProperty(g)&&(f=c.apply(null,[b[g],g,b].concat(e)),f&&h.push(b[g]));return h}function d(a,b,c){function d(a,b){var c,d;d=h[a],d&&(b?(c=d.indexOf(b),-1!==c&&d.splice(c,1)):d.length=0)}function e(a,b){return h[a]=h[a]||[],h[a].push(b),function(){d(a,b)}}function f(b,c){return b&&b.apply(a,c)}function g(a){if(h[a])for(var b=0,c=h[a],d=c.length;d>b;)f(c[b],arguments),b+=1}var h={};b&&c?(a.on=b[c.on]&&b[c.on].bind(b),a.off=b[c.off]&&b[c.off].bind(b),a.dispatch=b[c.dispatch].bind(b)):(a.on=e,a.off=d,a.dispatch=g)}function e(a){var b=[],c=0,d=a.length;if(void 0!==a.length)for(;d>c;)b.push(a[c]),c+=1;else for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}function f(a,b){var c,d,e,f,g;for(b||(b=function(a,b){return a>b?1:b>a?-1:0}),d=a.length,f=d-1,c=0;d>c;c+=1)for(e=0;f>e;e+=1)b(a[e],a[e+1])>0&&(g=a[e+1],a[e+1]=a[e],a[e]=g);return a}function g(b,c){function d(a){return a.toString().split(/\b/)[2]}function e(a,b,c){return{label:d(a),method:a,args:b||[],delay:c}}function f(a){var b=d(a);E[b]=a}function g(a){for(var c=0,d=B.length;d>c;)B[c].label===a.label&&B[c]!==A&&(b.log("clear duplicate item %c%s",G,a.label),B.splice(c,1),c-=1,d-=1),c+=1}function h(a,b,c){var d=e(a,b,c);E[d.label]&&g(d),B.push(d),z&&q()}function i(a,b,c){B.splice(1,0,e(a,b,c))}function j(a){g({label:d(a)})}function k(a,c){var d,f=e(a,[],c),g=Date.now(),h=function(){b.log("exec timeout method %c%s %sms",G,f.label,Date.now()-g),a()};return b.log("wait for timeout method %c%s",G,f.label),d=setTimeout(h,c),F[d]=function(){clearTimeout(d),delete F[d]},d}function l(a){F[a]&&F[a]()}function m(a){var b=a.toString(),c=b.match(/\(.*\)/);return c[0].match(/([\$\w])+/gm)}function n(a){var b=m(a);return!(!b||-1===b.indexOf("done"))}function o(){return y=Date.now(),b.log("finish %c%s took %dms",G,A.label,y-x),A=null,p(B.shift()),B.length&&q(),y-x}function p(a){for(C.unshift(a);C.length>D;)C.pop()}function q(){!A&&B.length&&(A=B[0],b.async&&void 0!==A.delay?(b.log("	delay for %c%s %sms",G,A.label,A.delay),clearTimeout(w),w=setTimeout(r,A.delay)):r())}function r(){b.log("start method %c%s",G,A.label);var a=n(A.method);a&&A.args.push(o),x=Date.now(),A.method.apply(null,A.args),a||o()}function s(){z=!0,q()}function t(){var a,c=A?1:0;for(b.log("clear");B.length>c;)a=B.splice(c,1)[0],b.log("	remove %s from flow",a.label)}function u(){return B.length}function v(){clearTimeout(w),B.length=0,b=null}var w,x,y,z=!1,A=null,B=[],C=[],D=10,E={},F={},G="color:#666666;";return b=a.logWrapper("Flow",b||{},"grey",c),b.async=b.hasOwnProperty("async")?b.async:!0,b.debug=b.hasOwnProperty("debug")?b.debug:0,b.insert=i,b.add=h,b.unique=f,b.remove=j,b.timeout=k,b.stopTimeout=l,b.run=s,b.clear=t,b.length=u,b.destroy=v,b}function h(c,d,e,f){function h(){ub.unique(mb),ub.unique(eb),ub.unique(Y)}function i(){Lb.name=c.$eval(e.gridName)||"datagrid",Lb.scope=c,Lb.element=d,Lb.attr=e,Lb.rowsLength=0,Lb.scopes=Bb,Lb.data=Lb.data||[],Lb.unwatchers=Ab,Lb.values=Jb,Lb.start=n,Lb.update=fb,Lb.reset=mb,Lb.isReady=t,Lb.forceRenderScope=nb,Lb.dispatch=rb,Lb.render=function(){ub.add(eb)},Lb.updateHeights=pb,Lb.getOffsetIndex=V,Lb.isActive=U,Lb.isCompiled=A,Lb.swapItem=w,Lb.getScope=x,Lb.getRowItem=y,Lb.getRowElm=z,Lb.getRowIndex=Lb.getIndexOf=B,Lb.getRowOffset=D,Lb.getRowHeight=E,Lb.getViewportHeight=F,Lb.getContentHeight=G,Lb.getContent=m,Lb.safeDigest=M,Lb.getRowIndexFromElement=C,Lb.updateViewportHeight=s,Lb.calculateViewportHeight=u,Lb.options=xb=a.extend({},a.datagrid.options,c.$eval(e.options)||{}),Lb.flow=ub=new g({async:xb.hasOwnProperty("async")?!!xb.async:!0,debug:xb.hasOwnProperty("debug")?xb.debug:0},Lb.dispatch),Lb.grouped=c.$eval(e.grouped),ub.add(h),ub.run()}function j(){var b,c=d[0].getElementsByClassName(xb.contentClass),e=xb.contentClass;return c=a.filter(c,l),b=c[0],b&&(e=b.className||xb.contentClass),b||(e=k()||e,b=angular.element('<div class="'+e+'"></div>'),Lb.options.chunks.detachDom&&b.css({position:"relative"}),d.prepend(b)),b[0]||(b=angular.element(b)),b}function k(){var b,c;return wb?(b=a.util.array.toArray(wb[0].classList),c=b.indexOf("old-"+xb.contentClass),-1!==c&&b.splice(c,1),b.join(" ")):void 0}function l(a){return angular.element(a).hasClass("old-"+xb.contentClass)?!1:!0}function m(){return vb}function n(){Lb.dispatch(a.datagrid.events.ON_INIT),vb=j(),o(0)}function o(a){if(!Lb.element[0].offsetHeight){if(1>a)return ub.add(o,[a+1],0),void 0;ub.warn("Datagrid: Dom Element does not have a height.")}ub.add(Lb.templateModel.createTemplates,null,0),ub.add(function(){xb.dynamicRowHeights=Lb.templateModel.dynamicHeights()}),ub.add(p)}function p(){var b=c.$on(a.datagrid.events.ON_BEFORE_RENDER_AFTER_DATA_CHANGE,function(){b(),ub.add(rb,[a.datagrid.events.ON_STARTUP_COMPLETE])});window.addEventListener("resize",v),Ab.push(c.$on(a.datagrid.events.UPDATE,fb)),Ab.push(c.$on(a.datagrid.events.ON_ROW_TEMPLATE_CHANGE,ob)),Ab.push(c.$on("$destroy",tb)),ub.add(q,[],0),Lb.dispatch(a.datagrid.events.ON_LISTENERS_READY)}function q(){zb||(Lb.log("setupChangeWatcher"),zb=!0,Ab.push(c.$watchCollection(e.uxDatagrid,r)),ub.add(eb))}function r(a,b){ub.add(kb,[a,b])}function s(){Fb=Lb.calculateViewportHeight()}function t(){return Ib===Gb.READY}function u(){return d[0].offsetHeight}function v(){setTimeout(function(){pb()},100)}function w(a,b){var c,d,e=B(a);Lb.data.hasOwnProperty(e)&&(c=Lb.templateModel.getTemplate(a),d=Lb.templateModel.getTemplate(b),Lb.data[e]=b,c!==d?Lb.templateModel.setTemplate(e,d):(Bb[e][d.item]=b,M(Bb[e])))}function x(a){return Bb[a]}function y(a){return this.getData()[a]}function z(a){return angular.element(Lb.chunkModel.getRow(a))}function A(a){return!!Bb[a]}function B(a){return Lb.getNormalizedIndex(a,0)}function C(a){if(d[0].contains(a[0]||a)){for(var b=a.scope?a.scope():angular.element(a).scope();b&&b.$parent&&b.$parent!==Lb.scope;)b=b.$parent;return b.$index}return-1}function D(a){return void 0===Eb[a]&&(xb.dynamicRowHeights?X():Eb[a]=a*xb.rowHeight),Eb[a]}function E(a){return Lb.templateModel.getTemplateHeight(Lb.data[a])}function F(){return Fb}function G(){var a=Lb.chunkModel.getChunkList();return a&&a.height||0}function H(a){Lb.log("OVERWRITE DOM!!!");var b=a.length;ub.insert(Lb.chunkModel.chunkDom,[a,xb.chunks.size,'<div class="'+xb.chunks.chunkClass+'">',"</div>",vb]),Lb.rowsLength=b,Lb.log("created %s dom elements",b)}function I(a){var b,d,e,g=Bb[a];return g||(g=c.$new(),b=x(a-1),d=Lb.templateModel.getTemplate(Lb.data[a]),b&&(b.$$nextSibling=g,g.$$prevSibling=b),g.$status=xb.compiledClass,g[d.item]=Lb.data[a],g.$index=a,Bb[a]=g,e=z(a),e.removeClass(xb.uncompiledClass),f(e)(g),S(g)),g}function J(a){Lb.log("	buildRows %s",a.length),Ib=Gb.BUILDING,ub.insert(H,[a])}function K(){Lb.log("	ready"),Ib=Gb.READY,ub.add(eb),ub.add(L),ub.add(M,[c])}function L(){c.$emit(a.datagrid.events.ON_READY)}function M(a){a.$$phase||a.$digest()}function N(a,b,c){for(;a;){for(var d in b)b.hasOwnProperty(d)&&c(a,b,d);a=a.$parent}}function O(a,b){N(a,b,P)}function P(a,b,c){a.$$listenerCount[c]+=b[c]}function Q(a,b){N(a,b,R)}function R(a,b,c){a.$$listenerCount[c]-=b[c]}function S(b,c){var d;if(c=c||0,b&&!U(b)){if(c||b.$emit(a.datagrid.events.ON_BEFORE_ROW_DEACTIVATE),b.$$$watchers=b.$$watchers,b.$$watchers=[],c||(b.$$$listenerCount=b.$$listenerCount,b.$$listenerCount=angular.copy(b.$$$listenerCount),Q(b,b.$$$listenerCount)),b.$$childHead)for(d=b.$$childHead;d;)S(d,c+1),d=d.$$nextSibling;return!0}return!1}function T(b,c){var d;if(c=c||0,b&&b.$$$watchers){if(b.$$watchers=b.$$$watchers,b.$$$watchers=null,c||(O(b,b.$$$listenerCount),b.$$$listenerCount=null),b.$$childHead)for(d=b.$$childHead;d;)T(d,c+1),d=d.$$nextSibling;return c||b.$emit(a.datagrid.events.ON_AFTER_ROW_ACTIVATE),!0}return!(!b||b.$$$watchers)}function U(a){var b=Bb[a];return!(!b||b.$$$watchers)}function V(a){var b=Math.floor(a/Lb.templateModel.averageTemplateHeight()),c=0,d=Lb.rowsLength;if(!a||Lb.rowsLength<2)return c;for(Eb[b]&&Eb[b]<=a&&(c=b);d>c;){if(Eb[c]<=a&&Eb[c+1]>a)return c;c+=1}return c}function W(){var a=Fb,b=Jb.scroll||0,c={startIndex:0,i:0,inc:1,end:Lb.rowsLength,visibleScrollStart:b+xb.cushion,visibleScrollEnd:b+a-xb.cushion};return c.startIndex=c.i=V(b),c}function X(){for(var a=0,b=0;b<Lb.rowsLength;)Eb[b]=a,a+=Lb.templateModel.getTemplateHeight(Lb.data[b]),b+=1;xb.rowHeight=Lb.rowsLength?Lb.templateModel.getTemplateHeight("default"):0,Lb.getContent().css({height:G()})}function Y(){var a,b,d,e=W(),f=40*e.i,g=[].concat(Cb);if(!(e.i<0)){for(Lb.dispatch(Hb.ON_BEFORE_UPDATE_WATCHERS,e),_(),Cb.length=0,Lb.log("	visibleScrollStart %s visibleScrollEnd %s",e.visibleScrollStart,e.visibleScrollEnd);e.i<Lb.rowsLength&&(d=c.$$childHead?Bb[e.i-1]:null,f=D(e.i),f>=e.visibleScrollStart&&f<=e.visibleScrollEnd&&(b=I(e.i),void 0===e.started&&(e.started=e.i),ab(e.i),T(b)&&(a=g.indexOf(e.i),-1!==a&&g.splice(a,1),Cb.push(e.i),M(b),b.$digested=!0)),e.i+=e.inc,!(e.inc>0&&f>e.visibleScrollEnd||e.inc<0&&f<e.visibleScrollStart)););e.ended=e.i-1,Lb.log("	startIndex %s endIndex %s",e.startIndex,e.i),Z(g),Db=e.visibleScrollStart,Lb.log("	activated %s",Cb.join(", ")),$(),Lb.dispatch(Hb.ON_AFTER_UPDATE_WATCHERS,e)}}function Z(a){for(var b,c=[];a.length;)b=a.pop(),c.push(b),S(Bb[b]);Lb.log("	deactivated %s",c.join(", "))}function $(){if(Cb.length){var a,b=Cb[Cb.length-1],d=0,e=Cb.length;for(c.$$childHead=Bb[Cb[0]],c.$$childTail=Bb[b];e>d;)a=Bb[Cb[d]],a.$$prevSibling=Bb[Cb[d-1]],a.$$nextSibling=Bb[Cb[d+1]],a.$parent=c,d+=1}}function _(){Jb.activeRange.min=Jb.activeRange.max=-1}function ab(a){Jb.activeRange.min=Jb.activeRange.min<a&&Jb.activeRange.min>=0?Jb.activeRange.min:a,Jb.activeRange.max=Jb.activeRange.max>a&&Jb.activeRange.max>=0?Jb.activeRange.max:a}function bb(){Jb.dirty&&rb(a.datagrid.events.ON_BEFORE_RENDER_AFTER_DATA_CHANGE)}function cb(){var b;Jb.dirty&&Jb.activeRange.max>=0&&(Jb.dirty=!1,b=z(Jb.activeRange.min)[0].offsetHeight,Lb.getData().length&&b!==Lb.templateModel.getTemplateHeight(Lb.getData()[Jb.activeRange.min])&&Lb.templateModel.updateTemplateHeights(),rb(a.datagrid.events.ON_RENDER_AFTER_DATA_CHANGE))}function db(){return Fb?(yb&&Lb.info("datagrid has height of %s.",Fb),!0):(yb+=1,2>yb?(Lb.info("datagrid is waiting for element to have a height."),ub.add(Lb.updateViewportHeight,null,0),ub.add(eb)):ub.warn("Datagrid: Unable to determine a height for the datagrid. Cannot render. Exiting."),!1)}function eb(){if(Lb.log("render"),db())if(yb=0,Lb.log("	render %s",Ib),Ib===Gb.BUILDING)ub.length()?(ub.insert(K),ub.insert(X,null,0),ub.insert(J,[Lb.data])):(ub.add(J,[Lb.data],0),ub.add(X),ub.add(K));else{if(Ib!==Gb.READY)throw new Error("RENDER STATE INVALID");Lb.dispatch(a.datagrid.events.ON_BEFORE_RENDER),ub.add(bb),ub.add(Y),ub.add(cb,null,0),ub.add(Lb.dispatch,[a.datagrid.events.ON_AFTER_RENDER])}else Lb.log("	not ready to render.")}function fb(){Lb.warn("force update"),kb(c.$eval(e.uxDatagrid),Lb.data)}function gb(a,b){if(a&&b&&a.length===b.length){for(var c=0,d=a.length;d>c;){if(hb(a[c],b[c]))return!0;c+=1}return Lb.data.length!==Lb.normalize(a,Lb.grouped).length?(Lb.log("	dirtyCheckData length is different"),!0):!1}return!0}function hb(a,b){return Lb.templateModel.getTemplate(a)!==Lb.templateModel.getTemplate(b)?(Lb.log("	dirtyCheckData row template changed"),!0):!1}function ib(b){Lb.log("	mapData()"),Lb.data=Lb.setData(b,Lb.grouped)||[],a.each(Lb.getData(),jb)}function jb(a,b){var c;Bb[b]&&(c=Lb.templateModel.getTemplate(a),Bb[b][c.item]=a)}function kb(b,d){if(Lb.log("onDataChanged"),Lb.grouped=c.$eval(e.grouped),d!==Lb.getOriginalData()&&(d=Lb.getOriginalData()),Lb.options.smartUpdate&&Lb.data.length&&!gb(b,d))Jb.dirty=!0,ib(b),eb();else{var f=rb(a.datagrid.events.ON_BEFORE_DATA_CHANGE,b,d);f.defaultPrevented&&f.newValue&&(b=f.newValue),Jb.dirty=!0,ub.add(lb,[b,d])}}function lb(b,c){Lb.log("	changeData"),rb(a.datagrid.events.ON_BEFORE_RESET),Lb.data=Lb.setData(b,Lb.grouped)||[],rb(a.datagrid.events.ON_AFTER_DATA_CHANGE,Lb.data,c),mb()}function mb(){Lb.info("reset start"),ub.clear(),sb(),Eb={},Cb.length=0,Bb.length=0,vb.children().unbind(),vb.children().remove(),Lb.chunkModel.reset(Lb.data,vb,Bb),Lb.rowsLength=Lb.data.length,X(),s(),eb(),ub.add(Lb.info,["reset complete"]),ub.add(rb,[a.datagrid.events.ON_AFTER_RESET],0),ub.add(rb,[a.datagrid.events.ON_AFTER_HEIGHTS_UPDATED_RENDER])}function nb(a){var b=Bb[a];!b&&a>=0&&a<Lb.rowsLength&&(b=I(a)),b&&!c.$$phase&&(T(b),b.$digest(),S(b),b.$digested=!0)}function ob(a,b){var d=Lb.getNormalizedIndex(b),e=z(d),f=e.hasClass(xb.uncompiledClass)?I(d):e.scope();f!==c&&(f.$destroy(),Bb[d]=null,e.replaceWith(Lb.templateModel.getTemplate(b).template),Bb[d]=I(d),pb(d))}function pb(b){ub.add(s),ub.add(Lb.chunkModel.updateAllChunkHeights,[b]),ub.add(X),ub.add(eb),ub.add(Lb.dispatch,[a.datagrid.events.ON_AFTER_HEIGHTS_UPDATED_RENDER])}function qb(a){return-1!==Kb.indexOf(a)}function rb(a){return!qb(a)&&xb.debug&&1===xb.debug.all&&Lb.log("$emit %s",a),c.$emit.apply(c,arguments)}function sb(){var a,d,e=0;b(Bb,function(b,c){if(b){for(b.$$prevSibling=a||void 0,e=c;!d&&e<Lb.rowsLength;)e+=1,d=Bb[e]||void 0;T(b),a=b,b.$destroy()}}),c.$$childHead=void 0,c.$$childTail=void 0,Bb.length=0}function tb(){for(c.datagrid=null,Lb.log("destroying grid"),window.removeEventListener("resize",v),clearTimeout(Jb.scrollingStopIntv),ub.destroy(),Lb.flow=void 0,ub=null;Ab.length;)Ab.pop()();Lb.destroyLogger();for(var a in Lb)Lb[a]&&Lb[a].hasOwnProperty("destroy")&&(Lb[a].destroy(),Lb[a]=null);sb(),d.remove(),delete c.$parent[Lb.name],Eb=null,Lb=null,c=null,d=null,e=null,Ab=null,vb=null,Cb.length=0,Cb=null,Bb.length=0,Bb=null,Jb=null,Gb=null,Hb=null,xb=null,Jb=null,Kb=null,f=null}var ub,vb,wb,xb,yb=0,zb=!1,Ab=[],Bb=[],Cb=[],Db=0,Eb={},Fb=0,Gb=a.datagrid.states,Hb=a.datagrid.events,Ib=Gb.BUILDING,Jb={dirty:!1,scroll:0,speed:0,absSpeed:0,scrollPercent:0,touchDown:!1,scrollingStopIntv:null,activeRange:{min:0,max:0}},Kb=[a.datagrid.events.LOG,a.datagrid.events.INFO,a.datagrid.events.WARN,a.datagrid.events.ERROR],Lb={};return a.logWrapper("datagrid event",Lb,"grey",rb),a.logWrapper("datagrid",Lb,"green",rb),c.datagrid=Lb,i(),Lb}function i(a){this.uid=i.uid++,this.enabled=!0,this.min=0,this.max=0,this.templateStart="",this.templateEnd="",this.parent=null,this.mode=a?i.DETACHED:i.ATTACHED,this.detachDom=a,this.index=0}var j;try{j=angular.module("ux",["ng"])}catch(k){j=angular.module("ux")}a.datagrid={isIOS:!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),states:{BUILDING:"datagrid:building",READY:"datagrid:ready"},events:{ON_INIT:"datagrid:onInit",ON_LISTENERS_READY:"datagrid:onListenersReady",ON_READY:"datagrid:onReady",ON_STARTUP_COMPLETE:"datagrid:onStartupComplete",ON_BEFORE_RENDER:"datagrid:onBeforeRender",ON_AFTER_RENDER:"datagrid:onAfterRender",ON_BEFORE_UPDATE_WATCHERS:"datagrid:onBeforeUpdateWatchers",ON_AFTER_UPDATE_WATCHERS:"datagrid:onAfterUpdateWatchers",ON_BEFORE_DATA_CHANGE:"datagrid:onBeforeDataChange",ON_AFTER_DATA_CHANGE:"datagrid:onAfterDataChange",ON_BEFORE_RENDER_AFTER_DATA_CHANGE:"datagrid:onBeforeRenderAfterDataChange",ON_RENDER_AFTER_DATA_CHANGE:"datagrid:onRenderAfterDataChange",ON_ROW_TEMPLATE_CHANGE:"datagrid:onRowTemplateChange",ON_SCROLL:"datagrid:onScroll",ON_BEFORE_RESET:"datagrid:onBeforeReset",ON_AFTER_RESET:"datagrid:onAfterReset",ON_AFTER_HEIGHTS_UPDATED_RENDER:"datagrid:onAfterHeightsUpdatedRender",ON_BEFORE_ROW_DEACTIVATE:"datagrid:onBeforeRowDeactivate",ON_AFTER_ROW_ACTIVATE:"datagrid:onAFterRowActivate",RESIZE:"datagrid:resize",UPDATE:"datagrid:update",SCROLL_TO_INDEX:"datagrid:scrollToIndex",SCROLL_TO_ITEM:"datagrid:scrollToItem",SCROLL_INTO_VIEW:"datagrid:scrollIntoView",LOG:"datagrid:log",INFO:"datagrid:info",WARN:"datagrid:warn",ERROR:"datagrid:error"},options:{async:!0,updateDelay:100,creepRender:{enable:!0},creepStartDelay:1e3,cushion:-100,chunks:{detachDom:null,size:50,chunkClass:"datagrid-chunk",chunkDisabledClass:"datagrid-chunk-disabled",chunkReadyClass:"datagrid-chunk-ready"},chunkSize:50,compiledClass:"compiled",uncompiledClass:"uncompiled",contentClass:"datagrid-content",rowClass:"datagrid-row",renderThreshold:1,renderThresholdWait:50,renderWhileScrolling:!1,creepLimit:500,smartUpdate:!0},coreAddons:[]},j.factory("gridAddons",["$injector",function(a){function b(b,c){for(var d,e,f=0,g=b.length;g>f;){if(d=a.get(b[f]),"function"!=typeof d)throw new Error("Addons expect a function to pass the grid instance to.");e=a.invoke(d,c,{inst:c}),f+=1}}return function(a,c){c=c instanceof Array?c:c&&c.replace(/,/g," ").replace(/\s+/g," ").split(" ")||[],a.addons&&(c=a.addons=a.addons.concat(c)),b(c,a)}}]),a.css=function(){function a(a){return b(a)||(i[a]=c(a)),b(a)}function b(a){return i[a]}function c(a){if(document.styleSheets&&0!==document.getElementsByTagName(k.head).length){var b,c,d,e;if(document.styleSheets.length>0)for(d=0;d<document.styleSheets.length&&(document.styleSheets[d].disabled||(e=document.styleSheets[d].media,c=typeof e,c===k.string?(""===e||-1!==e.indexOf(k.screen))&&(b=document.styleSheets[d]):c===k.object&&(""===e.mediaText||-1!==e.mediaText.indexOf(k.screen))&&(b=document.styleSheets[d]),"undefined"==typeof b));d++);var f=document.createElement("style");for(f.type="text/css",f.title=a,document.getElementsByTagName(k.head)[0].appendChild(f),d=0;d<document.styleSheets.length;d++)document.styleSheets[d].disabled||(b=document.styleSheets[d]);return{name:a,styleSheet:b}}}function d(c,d,e){var f,g=b(c)||a(c),h=g.styleSheet;if(h.addRule){for(f=0;f<h.rules.length;f++)if(h.rules[f].selectorText&&h.rules[f].selectorText.toLowerCase()===d.toLowerCase())return h.rules[f].style.cssText=e,void 0;h.addRule(d,e)}else if(h.insertRule){for(f=0;f<h.cssRules.length;f++)if(h.cssRules[f].selectorText&&h.cssRules[f].selectorText.toLowerCase()===d.toLowerCase())return h.cssRules[f].style.cssText=e,void 0;h.insertRule(d+"{"+e+"}",0)}}function e(a){var b,c,d,e,g;if(-1!==a.indexOf("{")||-1!==a.indexOf("}"))return null;if(j[a])return j[a];for(b=0,c=document.styleSheets.length;c>b;b+=1)if(d=document.styleSheets[b],e=d.rules||d.cssRules,g=f(e,a))return g;return null}function f(a,b){var c,d,e,g;if(a)for(c=0,d=a.length;d>c;c+=1){if(e=a[c],e.cssRules&&(g=f(e.cssRules,b)))return g;if(e.selectorText){var h="(\b)*"+b.replace(".","\\.")+"([^-a-zA-Z0-9]|,|$)",i=e.selectorText.match(h);if(i&&-1!==i.indexOf(b))return j[b]=e.style,e.style}}return null}function g(a,b){var c=e(a);return c&&void 0!==c[b]?c[b]:null}function h(a,b,c){var d=e(a);d[b]=c}var i={},j={},k={head:"head",screen:"screen",string:"string",object:"object"};return{createdStyleSheets:[],createStyleSheet:c,createClass:d,getCSSValue:g,setCSSValue:h}}(),a.each=b,a.filter=c,a.extend=function(b){for(var c,d,e=a.util.array.toArray(arguments),f=1,g=e.length;g>f;){c=e[f];for(d in c)b[d]=b[d]&&"object"==typeof b[d]?a.extend(b[d],c[d]):c[d];f+=1}return b},a.util=a.util||{},a.util.array=a.util.array||{},a.util.array.toArray=e,a.util.array.sort=f,a.logWrapper=function(b,c,d,e){return d=d||"black",e=e||c.dispatch||function(){},c.$logName=b,c.log=c.info=c.warn=c.error=function(){},c.log=function(){var f=[a.datagrid.events.LOG,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.info=function(){var f=[a.datagrid.events.INFO,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.warn=function(){var f=[a.datagrid.events.WARN,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.error=function(){var f=[a.datagrid.events.ERROR,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.destroyLogger=function(){c.logger&&(c.log("destroy"),c.logger.destroy(),c.logger=null)},c},a.datagrid.Flow=g,j.directive("uxDatagrid",["$compile","gridAddons",function(c,d){return{restrict:"AE",scope:!0,link:{pre:function(e,f,g){var i=new h(e,f,g,c);b(a.datagrid.coreAddons,function(a){a.apply(i,[i])}),d(i,g.addons)},post:function(a){a.datagrid.start()}}}}]),a.datagrid.coreAddons.chunkModel=function(b){function c(){return v}function e(a,c,d,f){for(var g,h,j=0,k=a.length,l=new i(b.options.chunks.detachDom);k>j;)h=a[j],j%c===0&&(g&&g.updateHeight(b.templateModel,w),g=new i(b.options.chunks.detachDom),g.min=h.min||j,g.templateModel=b.templateModel,g.templateStart=d,g.templateEnd=f,g.parent=l,g.index=l.length,l.push(g)),h instanceof i&&(h.parent=g),h instanceof i&&(h.index=g.length),g.push(h),g.max=h.max||j,j+=1;return g&&g.updateHeight(b.templateModel,w),l.min||(l.min=l[0]?l[0].min:0,l.max=l[l.length-1]?l[l.length-1].max:0,l.templateStart=d,l.templateEnd=f,l.updateHeight(b.templateModel,w),l.dirtyHeight=!1),l.length>c?e(l,c,d,f):l}function f(a){var c,d;void 0===a?v&&(v.forceHeightReCalc(b.templateModel,w),v.updateHeight(b.templateModel,w,1,!0)):(c=j(a,v),d=g(c,v),d.updateHeight(b.templateModel,w,-1,!0))}function g(a,b){for(var c;a.length;)c=a.shift(),b[c]instanceof i&&(b=b[c]);return b}function h(a,b,c,d,f){return B.log("chunkDom"),y=f,x=b,w=a,z=c,A=d,v=e(a,b,c,d),r(v),v.updateDomHeight(1),f}function j(a,b,c){var d,e=0,f=b.length;for(c=c||[];f>e;){if(d=b[e],!(d instanceof i)){c.push(a%x);break}if(a>=d.min&&a<=d.max){c.push(e),j(a,d,c);break}e+=1}return c}function k(a){var b=j(a,v),c=n(b);return c&&c.length&&void 0===c.attr("row-id")&&c.attr("row-id",a),c}function l(a,b){for(var c,d=0,e=a.slice(0),f=v,g=y;d<e.length;)c=e.shift(),!f.rendered&&b&&(b(g,f),f.rendered=g,r(f)),e.length||p(f),f=f[c],g=f.rendered||angular.element(g.children()[c]);return g}function m(c,d){var e;c.html(d.getChildrenStr()),e=c.children(),a.each(e,o),-1!==e[0].className.indexOf(b.options.chunks.chunkClass)&&e.addClass(b.options.chunks.chunkReadyClass)}function n(a){return l(a,m)}function o(a){window.getComputedStyle(a).getPropertyValue("top")}function p(a){return a.compiled||(a.compiled=q(a),a.compiled&&(a.parent&&p(a.parent),b.flow.add(t))),a.compiled}function q(a){var c,d;if(a[0]instanceof i){for(c=0,d=a.length;d>c;){if(!a[c].compiled)return!1;c+=1}return!0}for(c=a.min,d=a.max;d>c;){if(!b.isCompiled(c))return!1;c+=1}return!0}function r(a){a.updateDom(b.options.chunks.chunkDisabledClass)}function s(a,b){B.log("reset"),C.length=0,a=a||[],v&&(v.destroy(),v=null,y=null,w=null),h(a,x,z,A,b)}function t(){var a=b.values.activeRange,c=b.options.chunks;v.enableRange(a.min,a.max,c.chunkDisabledClass),c.detachDom&&r(v)}function u(){s(),v=null,w=null,x=null,y=null,z=null,A=null,C.length=0,C=null,b.chunkModel=null,B.destroyLogger(),B=null,b=null}var v,w,x,y,z,A,B=a.logWrapper("chunkModel",{},"purple",b.dispatch),C=[];return b.flow.unique(r),B.chunkDom=h,B.getChunkList=c,B.getRowIndexes=function(a){return j(a,v)},B.getRow=k,B.reset=s,B.updateAllChunkHeights=f,B.destroy=u,b.scope.$on(a.datagrid.events.ON_AFTER_UPDATE_WATCHERS,t),d(B),b.chunkModel=B,B},a.datagrid.coreAddons.push(a.datagrid.coreAddons.chunkModel),i.uid=0,i.DETACHED="chunkArray:detached",i.ATTACHED="chunkArray:attached",i.prototype=[],i.prototype.getStub=function(a){return this.templateStart+a+this.templateEnd},i.prototype.inRange=function(a){return a>=this.min&&a<=this.max},i.prototype.rangeOverlap=function(a,b,c){var d=!1;for(c=c>0?c:0,a-=c,b+=c;b>a;){if(this.inRange(a)){d=!0;break}a+=1}return d},i.prototype.each=function(a,b){for(var c=0,d=this.length;d>c;)a.apply(this[c],b),c+=1},i.prototype.getChildrenStr=function(a){for(var b=0,c=this.length,d="",e=this;c>b;)d+=e[b]instanceof i?e[b].getStub(a?e[b].getChildrenStr(a):""):this.templateModel.getTemplate(e[b]).template,b+=1;return d},i.prototype.updateHeight=function(a,b,c,d){var e,f=0,g=0;if(this[0]instanceof i)for(e=this.length;e>f;)1===c&&this[f].updateHeight(a,b,c,d),g+=this[f].height,f+=1;else g=a.getHeight(b,this.min,this.max);this.height!==g&&(this.dirtyHeight=!0,this.height=g),-1==c&&this.dirtyHeight&&this.parent&&this.parent.updateHeight(a,b,c,d),d&&this.dirtyHeight&&this.updateDomHeight()},i.prototype.getPreviousSibling=function(){var a,b;return this.parent&&(b=this.index-1,a=this.parent[b],a&&a.index===this.index-1||this.parent.parent&&(a=this.parent.getPreviousSibling(),a&&(a=a.last()))),a},i.prototype.getNextSibling=function(){var a,b;return this.parent&&(b=this.index+1,a=this.parent[b],a&&a.index===this.index+1||this.parent.parent&&(a=this.parent.getNextSibling(),a&&(a=a.first()))),a},i.prototype.first=function(){return this[0]},i.prototype.last=function(){return this[this.length-1]},i.prototype.calculateTop=function(){var a,b=0;return this.index&&this.parent&&(a=this.getPreviousSibling(),a&&(b=a.top+a.height)),this.top=b,this.top},i.prototype.forceHeightReCalc=function(a,b){var c,d=0,e=0;if(this[0]instanceof i)for(c=this.length;c>d;)e+=this[d].forceHeightReCalc(a,b),d+=1;else e=a.getHeight(b,this.min,this.max);return this.height!==e&&(this.height=e,this.setDirtyHeight()),this.height},i.prototype.setDirtyHeight=function(){for(var a=this;a;)a.dirtyHeight=!0,a=a.parent},i.prototype.getId=function(){if(this._index!==this.index||!this._id){var a=this,b="";for(this._index=this.index;a;)b="."+a.index+b,a=a.parent;this._id=b.substr(1,b.length)}return this._id},i.prototype.hasChildChunks=function(){return this._hasChildChunks||(this._hasChildChunks=this.first()instanceof i),this._hasChildChunks},i.prototype.enableRange=function(a,b,c){this.rangeOverlap(a,b,this.detachDom)?this.enable(c):this.disable(c),this.hasChildChunks()&&this.each(this.enableRange,[a,b,c])},i.prototype.enable=function(a){this.enabled||(this.enabled=!0,this.updateDom(a),this.parent&&this.parent.enable(a))},i.prototype.disable=function(a){var b,c=0;if(this.compiled){if(this.hasChildChunks())for(b=this.length;b>c;)this[c].disable(a),c+=1;this.enabled&&(this.enabled=!1,this.updateDom(a))}},i.prototype.updateDom=function(a){this.rendered&&(!this.rendered.attr("chunk-id"),this.compiled&&!this.rendered.attr("compiled")&&this.rendered.attr("compiled",!0),this.detachDom?this.enabled?this.detached&&(this.detached=!1,this.parent.rendered.append(this.rendered)):this.enabled||this.detached||this.parent&&this.parent.compiled&&this.rendered.parent().length&&(this.detached=!0,this.rendered.remove()):(this.rendered.attr("enabled",this.enabled),this.enabled?(this.rendered.removeAttr("disabled"),this.rendered.removeAttr("read-only"),this.rendered.removeClass(a)):(this.rendered.attr("disabled","disabled"),this.rendered.attr("read-only",!0),this.rendered.addClass(a))),this.each(this.updateDom,[a]))},i.prototype.updateDomHeight=function(a){this.mode===i.DETACHED&&this.calculateTop(),this.rendered?(this.dirtyHeight=!1,this.mode===i.DETACHED&&(this.rendered[0].style.top=this.top+"px"),this.rendered[0].style.height=this.height+"px"):this.createDomTemplates(),-1===a&&this.parent?this.parent.updateDomHeight(a):a&&this.hasChildChunks()&&this.each(this.updateDomHeight,[a])},i.prototype.createDomTemplates=function(){if(!this.templateReady){var a=this.templateStart.substr(0,this.templateStart.length-1)+' style="';this.mode===i.DETACHED&&(a+="position:absolute;top:"+this.top+"px;left:0px;"),this.templateStart=a+"width:100%;height:"+this.height+'px;">',this.templateReady=!0}},i.prototype.children=function(){var a=[];this.each(function(){a.push(this.rendered)},[])},i.prototype.destroy=function(){for(this.hasChildChunks()&&this.each(this.destroy),this.templateStart="",this.templateEnd="",this.templateModel=null,this.rendered=null,this.parent=null;this.length;)this.pop();this.length=0},a.datagrid.events.ON_RENDER_PROGRESS="datagrid:onRenderProgress",a.datagrid.coreAddons.creepRenderModel=function(c){function d(a){var b=c.getScope(a);b&&b.$digested||c.forceRenderScope(a)}function e(){var a={count:0};return b(c.scopes,f,a),a.count>=c.rowsLength&&y.disable(),{count:a.count,len:c.rowsLength}}function f(a,b,c,d){d.count+=a?1:0}function g(a,b,d){c.values.touchDown||(t=!1,u=Date.now()+c.options.renderThreshold,z=a,A=b,j(k,d))}function h(b,d){var e=a.util.array.toArray(arguments);return e.splice(0,2),c.options.async?(clearTimeout(s),s=setTimeout(function(){b.apply(null,e)},d)):b.apply(this,e),s}function i(a,b){for(;a>=0&&a<c.rowsLength&&c.isCompiled(a);)a+=b;return a>=0&&a<c.rowsLength?a:b>0?c.rowsLength:-1}function j(a,b){var e=Date.now();u>e&&l()?(z=b?z:i(z,-1),z>=0&&(d(z),b&&(z-=1)),A=b?A:i(A,1),A!==c.rowsLength&&(d(A),b&&(A+=1)),j(a,b)):a()}function k(){if(m(),l()){x+=1,c.values.touchDown||c.values.speed||!l()||n(z,A);var b=e();b!==v&&c.dispatch(a.datagrid.events.ON_RENDER_PROGRESS,b)}else x=0,y.disable(),v=1,c.dispatch(a.datagrid.events.ON_RENDER_PROGRESS,1)}function l(){return!!(z>-1||A<c.rowsLength)}function m(){u=0,clearTimeout(w),clearTimeout(s),w=0}function n(a,b,d,e){m(),x<c.options.creepLimit&&(w=h(g,d||c.options.renderThresholdWait,a,b,e))}function o(a,b){n(z,A,c.options.creepStartDelay,b)}function p(){m()}function q(a,b,c){x=0,z=b.started||0,A=b.ended||0,o(a,c)}function r(a){p(a),c.options.creepRender&&c.options.creepRender.enable!==!1&&y.enable()}var s,t,u,v,w=0,x=0,y=a.logWrapper("creepModel",{},"blue",c.dispatch),z=0,A=0,B=[];y.stop=m,y.destroy=function(){y.disable(),m(),c=null,y=null},y.enable=function(){B.length||(B.push(c.scope.$on(a.datagrid.events.BEFORE_VIRTUAL_SCROLL_START,p)),B.push(c.scope.$on(a.datagrid.events.ON_VIRTUAL_SCROLL_UPDATE,p)),B.push(c.scope.$on(a.datagrid.events.ON_TOUCH_DOWN,p)),B.push(c.scope.$on(a.datagrid.events.ON_SCROLL_START,p)),B.push(c.scope.$on(a.datagrid.events.ON_AFTER_UPDATE_WATCHERS,q)))},y.disable=function(){for(y.info("creep Disabled");B.length;)B.pop()()},c.unwatchers.push(c.scope.$on(a.datagrid.events.ON_BEFORE_RESET,r)),c.creepRenderModel=y,c.options.creepRender&&c.options.creepRender.enable?y.enable():y.disable()},a.datagrid.coreAddons.push(a.datagrid.coreAddons.creepRenderModel),a.datagrid.coreAddons.normalizeModel=function(b){function c(a,d,e,f,g){var h;return g=g.slice(0),g.push(d),a===f?g:a[b.grouped]&&a[b.grouped].length&&(h=ux.each(a[b.grouped],c,f,g),h&&h!==a[b.grouped])?h:void 0}var d,e,f=a.logWrapper("normalizeModel",{},"grey",b.dispatch);return b.normalize=function(a,c,d){a=a||[];var e=0,f=a.length;for(d=d||[];f>e;)d.push(a[e]),a[e]&&a[e][c]&&b.normalize(a[e][c],c,d),e+=1;return d},b.setData=function(a,c){return f.log("setData"),d=a,e=c?b.normalize(a,c):a&&a.slice(0)||[]},b.getData=function(){return e},b.getOriginalData=function(){return d},b.getOriginalIndexOfItem=function(a){var b=ux.each(d,c,a,[]);return b&&b!==d?b:[]},b.getNormalizedIndex=function(a,c){for(var d=c||0;d<b.rowsLength;){if(b.data[d]===a)return d;d+=1}if(c)for(d=c;d>=0;){if(b.data[d]===a)return d;d-=1}return-1},f.destroy=function(){f.destroyLogger(),d=null,e=null,b.normalizeModel=null,b=null,f=null},b.normalizeModel=f,b},a.datagrid.coreAddons.push(a.datagrid.coreAddons.normalizeModel),a.datagrid.events.ON_SCROLL_START="datagrid:scrollStart",a.datagrid.events.ON_SCROLL_STOP="datagrid:scrollStop",a.datagrid.events.ON_TOUCH_DOWN="datagrid:touchDown",a.datagrid.events.ON_TOUCH_UP="datagrid:touchUp",a.datagrid.coreAddons.scrollModel=function(b){function c(){l(),b.element.css("overflow")||b.element.css({overflow:"auto"}),p.log("addScrollListener"),d(),b.unwatchers.push(b.scope.$on(a.datagrid.events.SCROLL_TO_INDEX,function(a,c){b.scrollModel.scrollToIndex(c,!0)})),b.unwatchers.push(b.scope.$on(a.datagrid.events.SCROLL_TO_ITEM,function(a,c){b.scrollModel.scrollToItem(c,!0)})),b.unwatchers.push(b.scope.$on(a.datagrid.events.SCROLL_INTO_VIEW,function(a,c){b.scrollModel.scrollIntoView(c,!0)})),g(),q=!0}function d(){r=!0,b.element[0].addEventListener("scroll",h)}function e(){r&&(p.removeScrollListener(),r=!0),p.removeTouchEvents()}function f(){r&&d(),g()}function g(){p.log("addTouchEvents");var a=b.getContent();a.bind("touchstart",p.onTouchStart),a.bind("touchend",p.onTouchEnd),a.bind("touchcancel",p.onTouchEnd)}function h(a){b.scrollModel.onUpdateScroll(a)
}function i(){o=Date.now(),b.scrollModel.onScrollingStop()}function j(a){b.data[a-1]&&!b.isCompiled(a-1)&&b.forceRenderScope(a-1),b.data[a+1]&&!b.isCompiled(a+1)&&b.forceRenderScope(a+1)}function k(){clearTimeout(m),p.destroyLogger(),l(),q&&(p.removeScrollListener(),p.removeTouchEvents()),p=null,b=null}var l,m,n,o,p=a.logWrapper("scrollModel",{},"orange",b.dispatch),q=!1,r=!1;return p.fireOnScroll=function(){b.values.scroll!==n&&(n=b.values.scroll,b.dispatch(a.datagrid.events.ON_SCROLL,b.values))},p.removeScrollListener=function(){p.log("removeScrollListener"),b.element[0].removeEventListener("scroll",h)},p.removeTouchEvents=function(){q&&(p.log("removeTouchEvents"),b.getContent().unbind("touchstart",p.onTouchStart),b.getContent().unbind("touchend",p.onTouchEnd),b.getContent().unbind("touchcancel",p.onTouchEnd))},p.onTouchStart=function(c){b.values.touchDown=!0,b.dispatch(a.datagrid.events.ON_TOUCH_DOWN,c)},p.onTouchEnd=function(c){b.values.touchDown=!1,b.dispatch(a.datagrid.events.ON_TOUCH_UP,c)},p.getScroll=function(a){return(a||b.element[0]).scrollTop},p.setScroll=function(a){b.element[0].scrollTop=a,b.values.scroll=a},p.onUpdateScroll=function(c){var d=b.scrollModel.getScroll(c.target||c.srcElement);b.values.scroll!==d&&(b.dispatch(a.datagrid.events.ON_SCROLL_START,d),b.values.speed=d-b.values.scroll,b.values.absSpeed=Math.abs(b.values.speed),b.values.scroll=d,b.values.scrollPercent=(b.values.scroll/b.getContentHeight()*100).toFixed(2)),b.scrollModel.waitForStop(),p.fireOnScroll()},p.scrollTo=function(a,c){b.scrollModel.setScroll(a),c?b.scrollModel.onScrollingStop():b.scrollModel.waitForStop()},p.clearOnScrollingStop=function(){p.onScrollingStop()},p.waitForStop=function(){var a=!1;clearTimeout(m),b.options.renderWhileScrolling&&Date.now()-(b.options.renderWhileScrolling>0||0)>o&&(a=!0),a||!b.flow.async&&!b.values.touchDown?i():m=setTimeout(i,b.options.updateDelay)},p.onScrollingStop=function(){b.values.speed=0,b.values.absSpeed=0,b.render(),p.fireOnScroll(),b.dispatch(a.datagrid.events.ON_SCROLL_STOP,b.values)},p.scrollToIndex=function(a,c){p.log("scrollToIndex");var d=b.getRowOffset(a);return b.scrollModel.scrollTo(d,c),d},p.scrollToItem=function(a,c){p.log("scrollToItem");var d=b.getNormalizedIndex(a);return-1!==d?b.scrollModel.scrollToIndex(d,c):b.values.scroll},p.scrollIntoView=function(a,c){p.log("scrollIntoView");{var d,e,f="number"==typeof a?a:b.getNormalizedIndex(a),g=b.getRowOffset(f);Math.abs(b.options.cushion)}return j(f),g<b.values.scroll?(b.scrollModel.scrollTo(g,c),void 0):(b.updateViewportHeight(),e=b.getViewportHeight(),d=b.templateModel.getTemplateHeight(b.getData()[f]),g>=b.values.scroll+e-d&&b.scrollModel.scrollTo(g-e+d,c),void 0)},p.scrollToTop=function(a){p.log("scrollToTop"),b.scrollModel.scrollTo(0,a)},p.scrollToBottom=function(a){p.log("scrollToBottom");var c=b.getContentHeight()-b.getViewportHeight();b.scrollModel.scrollTo(c>=0?c:0,a)},l=b.scope.$on(a.datagrid.events.ON_READY,c),b.unwatchers.push(b.scope.$on(a.datagrid.events.ON_BEFORE_RESET,e)),b.unwatchers.push(b.scope.$on(a.datagrid.events.ON_AFTER_RESET,f)),p.destroy=k,b.scrollModel=p,b},a.datagrid.coreAddons.push(a.datagrid.coreAddons.scrollModel),a.datagrid.coreAddons.templateModel=function(b){"use strict";function c(a){return a=a.replace(/\n/g,""),a=a.replace(/[\t ]+</g,"<"),a=a.replace(/>[\t ]+</g,"><"),a=a.replace(/>[\t ]+$/g,">")}return b.templateModel=function(){function d(){v.log("createTemplates");var a,c=b.element[0].getElementsByTagName("script"),d=c.length;if(!d)throw new Error("at least one template is required.");for(a=0;d>a;a+=1)e(c[a]);for(;c.length;)b.element[0].removeChild(c[0])}function e(a){var d,e=c(angular.element(a).html()),g=document.createElement("div"),h=f(a,"template-name")||u;if(g.className="grid-template-wrapper",e=angular.element(e)[0],e.className+=" "+b.options.rowClass+" "+b.options.uncompiledClass+" {{$status}}",e.setAttribute("template",h),b.getContent()[0].appendChild(g),g.appendChild(e),e=c(g.innerHTML),d={name:h,item:f(a,"template-item"),template:e,height:g.offsetHeight},v.log("template: %s %o",h,d),!d.height)throw new Error("Template height cannot be 0.");return t[d.name]=d,t.push(d),b.getContent()[0].removeChild(g),s=0,d}function f(a,b){var c=a.attributes["data-"+b]||a.attributes[b];return c&&c.nodeValue||""}function g(){return t}function h(a){return a.attr?a.attr("template"):a.getAttribute("template")}function i(a){return t[a]?t[a]:t[u]}function j(){var a,b;for(a in t)if(t.hasOwnProperty(a)&&(b=b||t[a].height,b!==t[a].height))return!0;return!1}function k(){var a=0,b=t.length;if(!s)for(;b>a;)s+=t[a].height,a+=1;return s/b}function l(){return t.length}function m(a){var b=v.getTemplate(a);return b?b.height:0}function n(a,b,c){var d=b,e=0;if(!a.length)return 0;for(;c>=d;)e+=v.getTemplateHeight(a[d]),d+=1;return e}function o(a,b){a._template=b}function p(c,d){v.log("setTemplate %s %s",c,d);var e="number"==typeof c?b.data[c]:c,f=v.getTemplate(e).name;v.setTemplateName(e,d),b.dispatch(a.datagrid.events.ON_ROW_TEMPLATE_CHANGE,e,f,d)}function q(){for(var a,c,d,e=b.values.activeRange.min,f=b.values.activeRange.max-e,g=!1,h={};f>e;)c=v.getTemplate(b.getData()[e]),h[c.name]||(a=b.getRowElm(e),d=a[0].offsetHeight,d!==c.height&&(c.height=d,g=!0)),e+=1;g&&b.updateHeights()}function r(){v.destroyLogger(),v=null,t.length=0,t=null}var s,t=[],u="default",v=a.logWrapper("templateModel",{},"teal",b.dispatch);return v.getTemplate=function(a){return v.getTemplateByName(a._template)},v.defaultName=u,v.createTemplates=d,v.getTemplates=g,v.getTemplateName=h,v.getTemplateByName=i,v.templateCount=l,v.dynamicHeights=j,v.averageTemplateHeight=k,v.getHeight=n,v.getTemplateHeight=m,v.setTemplate=p,v.setTemplateName=o,v.updateTemplateHeights=q,v.destroy=r,v}(),b.templateModel},a.datagrid.coreAddons.push(a.datagrid.coreAddons.templateModel)}(this.ux=this.ux||{},function(){return this}());