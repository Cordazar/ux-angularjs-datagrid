/*!
* ux-angularjs-datagrid v.1.3.0
* (c) 2015, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


exports.datagrid.events.DOUBLE_SCROLL_SCROLL_TO_TOP="datagrid:doubleScrollScrollToTop",exports.datagrid.events.DOUBLE_SCROLL_SCROLL_TO_BOTTOM="datagrid:doubleScrollScrollToBottom",angular.module("ux").directive("uxDoubleScroll",["$window",function(a){return{link:function(b,c,d){function e(){var a=c[0].querySelectorAll(".datagrid")[0].attributes.getNamedItem("data-addons");return a&&a.value.match(/iScrollAddon/)?!0:!1}function f(){c[0].style.overflowY="auto",c[0].style.overflowX="hidden",m(),l(),b.doubleScroll=B,b.$on(exports.datagrid.events.RESIZE,o),K?i():h(),x=b.$watch(g)}function g(){clearTimeout(z),z=setTimeout(function(){o()&&g()},100)}function h(){c[0].addEventListener("scroll",n,!0),r&&s.isReady()?(o(),n(null)):w=b.$on(exports.datagrid.events.ON_LISTENERS_READY,function(){w(),l(),o(),n(null),j(),s.scrollHistory&&s.scrollHistory.getCurrentScroll()&&k(),b.$on(exports.datagrid.events.ON_RENDER_AFTER_DATA_CHANGE,function(){v&&s.getContentHeight()&&s.getContentHeight()<s.getViewportHeight()&&s.scrollModel.removeTouchEvents()})}),b.$on(exports.datagrid.events.ON_SCROLL_STOP,function(){m(),clearInterval(A),s.values.scroll<=0?A=setInterval(function(){c[0].scrollTop>.1?c[0].scrollTop*=.1:(c[0].scrollTop=0,clearInterval(A))},10):c[0].scrollTop=c[0].scrollHeight-c[0].offsetHeight})}function i(){function a(a,b){I=a.y,J=0,clearInterval(A),A=setInterval(function(){var d,e=window.getComputedStyle(c[0].children[0]);e?(d=parseInt(e.webkitTransform.match(/(\-?\d+)\)$/)[1],10),d!==I&&(J=d-I,I=d,d===b.maxScrollY&&(clearInterval(A),A=setTimeout(function(){clearTimeout(A),k(),a.scrollBy(0,5*J,500)},0)))):clearInterval(A)},10)}t=new IScroll(c[0],{bounce:!1,mouseWheel:!0,bindToWrapper:!0,click:!0}),t.on("scrollStart",function(){v&&(o(),a(u.iScroll,t))}),t.on("scrollEnd",function(){u||m();t.y<=t.maxScrollY&&k()}),b.$on(exports.datagrid.events.ON_SCROLL_START,function(){var a=u||m();a.iScroll&&(a.iScroll.options.bounce=!1),!v&&a.iScroll.y>=0?j():v&&a.iScroll.enabled&&a.iScroll.disable()}),b.$on(exports.datagrid.events.ON_SCROLL_STOP,function(){!v&&u.iScroll.y>=0&&j()}),b.$on(exports.datagrid.events.AFTER_SCROLL_HISTORY_INIT_SCROLL,function(){u.scrollHistory&&u.scrollHistory.getCurrentScroll()&&(t.enable(),t.scrollTo(0,t.maxScrollY))}),w=b.$on(exports.datagrid.events.ON_LISTENERS_READY,function(){w(),m(),l(),o(),w=b.$on(exports.datagrid.events.ON_AFTER_RENDER,function(){u||m();w(),o(),j(),s.scrollHistory&&s.scrollHistory.getCurrentScroll()&&k()})})}function j(){B.log("enable doubleScroll disable scroll"),K&&!v?(!u||!u.iScroll||s.scrollHistory&&s.scrollHistory.getCurrentScroll()||(B.log("	scroll grid to 0"),u.iScroll.scrollTo(0,0),u.iScroll.disable()),t.enable(),s.getContentHeight()>s.getViewportHeight()&&t.scrollTo(0,0)):v||(c[0].scrollTop=0,r.scrollTop=0),v=!0}function k(){B.log("disable doubleScroll enable scroll"),K&&v?(t.scrollTo(0,t.maxScrollY),t.disable(),u.iScroll.enable(),u.iScroll.scrollBy(0,-1)):K||(c[0].scrollTop=c[0].scrollHeight-c[0].offsetHeight),v=!1}function l(){r||(r=c[0].querySelector(D))}function m(){for(var a=b.$$childHead;a;){if(a.datagrid)return s=a.datagrid,u=a.datagrid&&a.datagrid.scrollModel;a=a.$$nextSibling}return u}function n(a){if(B.log("onScroll"),l(),!r)throw new Error(D?'selector "'+D+'" did not select any objects':"double scroll requires a selector.");C.scrollTop+C.offsetHeight<C.scrollHeight?"hidden"!==r.style.overflowY&&(B.log("	target.overflowY = hidden"),r.style.overflowY="hidden"):"auto"!==r.style.overflowY&&(B.log("	target.overflowY = auto"),r.style.overflowY="auto")}function o(){var a=p(),b=c[0].offsetHeight;if(H!==a||y!==b){if(q(a))return H=a,y=b,!0}else!v&&r&&r.children[0]&&r.children[0].offsetHeight+E<b&&j();return!1}function p(){for(var b,d,e,f=c.children(),g=f.children(),h=0,i=g.length,j=0;i>h&&g[h]!==r&&!g[h].contains(r);)b=a.getComputedStyle(g[h]),G!==!1?(d=parseInt(b.paddingTop,10),e=parseInt(b.paddingBottom,10)):(d=0,e=0),j+=g[h].offsetHeight+d+e,h+=1;return F&&(E=j),j}function q(a){if(B.log("onSizeChange"),r){var b,d=angular.element(r).scope(),e=c.children(),f=c[0].offsetHeight;return b=a+f-E,r.style.height=f-E+"px",e[0].style.height=b+"px",d.datagrid.updateHeights(),K&&(t.refresh(),d.datagrid.scrollHistory&&!d.datagrid.scrollHistory.isComplete()&&t.scrollTo(0,t.maxScrollY)),!0}return l(),!1}var r,s,t,u,v,w,x,y,z,A,B=exports.logWrapper("doubleScroll",{},"red",function(){b.$emit.apply(b,arguments)}),C=c[0],D=b.$eval(d.uxDoubleScroll),E=b.$eval(d.targetOffset)||0,F=b.$eval(d.dynamicOffset),G=b.$eval(d.targetPadding),H=0,I=0,J=0,K=e();B.resize=function(a){B.log("resize"),void 0!==a&&(c[0].style.height=a+"px"),o()},B.scrollToTop=function(){j()},B.scrollToBottom=function(){k()},b.$on("$destroy",function(){x(),clearTimeout(z),clearInterval(A),B.destroyLogger(),B=null,K?(t.destroy(),t=null):c[0].removeEventListener("scroll",n)}),f()}}}]);
//# sourceMappingURL=ux-doubleScroll.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
