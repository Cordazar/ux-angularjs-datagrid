/*!
* ux-angularjs-datagrid v.1.4.6
* (c) 2015, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


exports.datagrid.events.COLLAPSE_ROW="datagrid:collapseRow",exports.datagrid.events.EXPAND_ROW="datagrid:expandRow",exports.datagrid.events.TOGGLE_ROW="datagrid:toggleRow",exports.datagrid.events.ROW_TRANSITION_COMPLETE="datagrid:rowTransitionComplete",exports.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS="datagrid:collapseAllExpandedRows",exports.datagrid.options.expandRows=[],exports.datagrid.options.expandRows.autoClose=!0,exports.datagrid.options.expandRows.scrollOnExpand=!0,angular.module("ux").factory("expandRows",function(){return["inst",function(a){function b(b){return r="number"==typeof b?b:a.getNormalizedIndex(b,r)}function c(b){b.template=b.template||a.templateModel.defaultName,b.cls||b.style||b.swap||a.throwError("expandRows will not work without an cls|style|swap property"),t[b.template]=b}function d(){ux.each(a.options.expandRows,c)}function e(a){var c=b(a);return u[c]?w.opened:w.closed}function f(a){e(a)===w.closed?g(a):h(a)}function g(c){var d=b(c);if(e(d)===w.closed){if(s.log("expand %s",c),a.options.expandRows.autoClose&&v)return;v=!0,i([d],!0),k(d,w.opened)}}function h(a,c){var d=b(a);e(d)===w.opened&&(s.log("collapse %s",a),k(d,w.closed,c))}function i(b,c){a.options.expandRows.autoClose&&j(b,!1,c)}function j(b,c,d){exports.each(u,function(e,f){var g=parseInt(f,10);(!b||a.rowsLength>g&&-1===b.indexOf(g))&&(c?delete u[f]:h(g,d))})}function k(b,c,d){var e,f,g,h=a.templateModel.getTemplate(a.data[b]);if(t[h.name]){if(e=a.getExistingRow(b),!e||!e.scope())return void delete u[b];e.scope().$state=c,f=t[h.name],f.transition!==!1&&e[0].addEventListener(A,n),f.style&&(f.reverse||(f.reverse=l(e,f.style)),e.css(c===w.opened?f.style:f.reverse)),f.swap&&f.state!==c?(g=t[f.swap],g.cls=g.cls||"",a.templateModel.setTemplate(b,f.swap,[g.cls]),e=a.getRowElm(b)):f.cls&&(e[c===w.opened?"addClass":"removeClass"](f.cls),e.addClass("animating"));var i={target:e[0],index:b,state:c};d?n(i,d):a.flow.add(n,[i],0)}else a.throwError("unable to toggle template. cls for template '"+h.name+"' was not set.")}function l(a,b){var c={elm:a,style:b,reverse:{}};return ux.each(b,m,c),c.reverse}function m(a,b,c,d){d.reverse[b]=d.elm.css(b)}function n(b,c){var d,e,f,g;exports.util.apply(Object.prototype.hasOwnProperty,b,["index"])?(d=a.getRowElm(b.index),f=b.index,g=b.state):d=angular.element(b.target),e=d.scope(),g&&e?(e.$index=f,e.$state=g):e&&(f=e.$index,g=e.$state),d[0].removeEventListener(A,n),d.removeClass("animating"),g===w.opened?(u[f]={index:f,height:parseInt(d[0].offsetHeight||0,10)},isNaN(u[f].height)&&a.throwError("Invalid Height")):delete u[f],a.updateHeights(f),c?v=!1:a.flow.add(function(){a.options.expandRows.scrollOnExpand&&a.scrollModel.scrollIntoView(f,!0),a.dispatch(exports.datagrid.events.ROW_TRANSITION_COMPLETE),v=!1,a.options.expandRows.scrollOnExpand&&a.flow.add(function(){g===w.opened&&f===a.data.length-1&&a.getViewportHeight()<a.getContentHeight()&&a.scrollModel.scrollToBottom(!0)},[],0)},[],0)}function o(a){var c=b(a);return!!u[c]}function p(a){var c=b(a);return u[c]?(s.log("	expandRow %s to height %s",c,u[c].height),u[c].height):x(a)}function q(){s=null,t=null,u=null,w=null}var r,s=exports.logWrapper("expandRows",{},"green",a),t={},u={},v=!1,w={opened:"opened",closed:"closed"},x=a.templateModel.getTemplateHeight,y=document.createElement("div").style,z=function(){for(var a,b="t,webkitT,MozT,msT,OT".split(","),c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in y)return b[c].substr(0,b[c].length-1);return!1}(),A=function(){if(z===!1)return!1;var a={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"};return a[z]}();return y=null,a.templateModel.getTemplateHeight=p,s.states=w,s.getIndex=b,s.toggle=function(b){a.flow.add(f,[b])},s.expand=function(b){a.flow.add(g,[b])},s.collapse=function(b){a.flow.add(h,[b])},s.isExpanded=o,s.destroy=q,a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_READY,d)),a.unwatchers.push(a.scope.$on(exports.datagrid.events.EXPAND_ROW,function(a,b){s.expand(b)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.COLLAPSE_ROW,function(a,b){s.collapse(b)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.TOGGLE_ROW,function(a,b){s.toggle(b)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_ROW_COMPILE,function(b,c,d){if(u[c.$index]){var e=a.templateModel.getTemplate(a.data[c.$index]),f=t[e.name];d[0].classList.add(f.cls)}})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS,function(a,b){j(null,b)})),exports.datagrid.events.ON_BEFORE_TOGGLE_SORT&&a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_TOGGLE_SORT,function(a){j()})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_DATA_CHANGE,function(a){j(null,!0)})),a.expandRows=s,a}]});
//# sourceMappingURL=ux-datagrid-expandRows.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
