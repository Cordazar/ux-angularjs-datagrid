/*
* ux-angularjs-datagrid v.1.1.8
* (c) 2014, WebUX
* https://github.com/webux/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


exports.visibility=function(){function a(d,e,f){var g=d.parentNode;return c(d)?9===g.nodeType?!0:f||"0"!==b(d,"opacity")?"none"===b(d,"display")||"hidden"===b(d,"visibility")?!1:g&&g!==e?a(g,e,f):!0:!1:!1}function b(a,b){return window.getComputedStyle?document.defaultView.getComputedStyle(a,null)[b]:a.currentStyle?a.currentStyle[b]:void 0}function c(a){for(;a=a.parentNode;)if(a==document)return!0;return!1}return{getStyle:b,isVisible:a}}(),exports.selector=function(){function a(a,b){b=b||y.config.doc.body;var c,d,e=/:eq\((\d+)\)$/,f=a.match(e);return f&&f.length&&(a=a.replace(e,""),d=f[1]),c=b.querySelectorAll(a),c&&void 0!==d?c[d]:c}function b(b,c){if(d(b)){for(var f,h,j,k=i(c),l=y.config.doc.body,m=g(b,l,k,null,!0);m.count>m.totalCount;)m=m.parent;if(m=m.parent||m,j=m.str||p(m),m.str)for(var n=m.child;n;)j+=" "+n.str,n=n.child;return(m.count>1||m.child&&m.child.count)&&(f=exports.util.array.toArray(a(j,l)),h=f.indexOf(b),j+=":eq("+h+")"),j+=e()}return""}function c(a,b,c){if(d(a)){var f=i(c),h=g(a,b,f);return p(h)+e()}return""}function d(a){if(!a)return"";if(a&&a.length)throw new Error("selector can only build a selection to a single DOMElement. A list was passed.");return!0}function e(){return y.config.addVisible?":visible":""}function f(a,b){return"string"==typeof b&&b===a?!0:"object"==typeof b&&a.match(b)?!0:!1}function g(a,b,c,d,e){var f;return a?(b=b||y.config.doc,f={element:a,ignoreClass:c,maxParent:b,classes:j(a,c),attributes:k(a,d),type:a.nodeName&&a.nodeName.toLowerCase()||"",child:d},(!f.attributes.$unique||d)&&(e?(f.str=p(f,0,null,!0),f.count=b.querySelectorAll(f.str).length,f.count>1&&(f.parent=r(a,b,c,f,e))):f.parent=r(a,b,c,f,e)),f):""}function h(a){return"number"!=typeof a}function i(a){return a=a||[],"function"==typeof a?a:function(b){if(a instanceof Array)for(var c=0,d=a.length;d>c;){if(f(b,a[c]))return!1;c+=1}else if(f(b,a))return!1;return!0}}function j(a,b){var c=ux.filter(a.classList,h);return c=ux.filter(c,x),ux.filter(c,b)}function k(a){var b,c=0,d=a.attributes?a.attributes.length:0,e=[],f=m(a.attributes);if(f&&("id"===f.name&&y.config.allowId?e.push("#"+f.value):"id"!==f.name&&e.push(l(f)),e.length))return e.$unique=!0,e;if(y.config.allowAttributes)for(;d>c;)b=a.attributes[c],u[b.name]||v[b.name]||e.push(l(b)),c+=1;return e}function l(a){return"["+n(a.name)+"='"+o(a.value)+"']"}function m(a){for(var b,c,d=0,e=a?a.length:0;e>d;){if(b=a[d],c=n(b.name),v[c])return b;d+=1}return null}function n(a){var b,c,d=1;if(a.indexOf("-")){for(b=a.split("-"),c=b.length;c>d;)b[d]=b[d].charAt(0).toUpperCase()+b[d].substr(1),d+=1;a=b.join("")}return a}function o(a){return a.replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function p(a,b,c,d){var e,f,g;return b=b||0,f=a&&!a.attributes.$unique?p(a.parent,b+1):"",a&&(f+=(f.length?" ":"")+q(a)),b||d||(g=c||a.maxParent,e=g.querySelectorAll&&g.querySelectorAll(f)||[],e.length>1&&(f+=":eq("+s(e,a.element)+")")),f}function q(a){return a.attributes.$unique?a.attributes[0]:a.type+a.attributes.join("")+(a.classes.length?"."+a.classes.join("."):"")}function r(a,b,c,d,e){var f=a.parentNode;return f&&f!==b?g(a.parentNode,b,c,d,e):null}function s(a,b){var c,d=a.length;for(c=0;d>c;c+=1)if(b===a[c])return c;return-1}function t(a){var b,c=[];for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&c.push(a[b]);return c}var u,v,w,x,y;return y={config:{doc:window.document,allowId:!0,allowAttributes:!0,addVisible:!1},addOmitAttrs:function(){return exports.each(arguments,function(a){u[a]=!0}),this},removeOmitAttrs:function(){return exports.each(arguments,function(a){delete u[a]}),this},getOmitAttrs:function(){return t(u)},resetOmitAttrs:function(){u={"class":!0,style:!0}},addUniqueAttrs:function(){return exports.each(arguments,function(a){v[a]=!0}),this},removeUniqueAttrs:function(){return exports.each(arguments,function(a){delete v[a]}),this},getUniqueAttrs:function(){return t(v)},resetUniqueAttrs:function(){v={id:!0,uid:!0}},addClassOmitFilters:function(){return exports.each(arguments,function(a){w.push(a)}),x=i(w),this},removeClassOmitFilters:function(){return exports.each(arguments,function(a){var b=w.indexOf(a);-1!==b&&w.splice(b,1)}),x=i(w),this},getClassOmitFilters:function(){return w.slice(0)},resetClassOmitFilters:function(){w=[],x=i(w)},get:b,getCleanSelector:b,quickSelector:c,reset:function(){y.resetOmitAttrs(),y.resetUniqueAttrs(),y.resetClassOmitFilters()}},y.reset(),y}(),exports.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME="ux-datagrid:focusToPrevElementOfSame",exports.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME="ux-datagrid:focusToNextElementOfSame",exports.datagrid.events.ON_SCROLL_TO_TOP_ENTER="ux-datagrid:onScrollToTopEnter",exports.datagrid.events.ON_SCROLL_TO_BOTTOM_ENTER="ux-datagrid:onScrollToBottomEnter",angular.module("ux").factory("gridFocusManager",function(){return["inst",function(a){function b(a){return void 0===a.length&&(a=angular.element(a)),a}function c(){B.log("addListeners"),e(m)}function d(){B.log("removeListeners"),e(n)}function e(b){if(a.values.activeRange.max&&!(a.values.activeRange.max<0)){B.log("	applyTo: %s - %s",a.values.activeRange.min,a.values.activeRange.max);for(var c,d=a.values.activeRange.min;d<=a.values.activeRange.max;)c=a.getRowElm(d),b(c),d+=1}}function f(a){if(a&&a[0]){var b=[].slice.call(a[0].querySelectorAll("input,a,select"));return ux.filter(b,g)}return[]}function g(b){return ux.visibility.isVisible(b,a.getContent()[0],!0)}function h(a,b){for(var c=b.split(":"),d=c.shift(),e=[].slice.call((a[0]||a).querySelectorAll(d));c.length;)e=i(c.shift(),e);return angular.element(e)}function i(a,b){return"eq("===a.substr(0,3)?j(a,b):"visible"===a.substr(0,7)?ux.filter(b,g):b}function j(a,b){var c=a.match(/\d+/)[0];return b[c]?[b[c]]:[]}function k(a){return!(!a||"ng-"!==a.substr(0,3))}function l(b){var c=b?!1:!0;return!c&&a.options.gridFocusManager&&a.options.gridFocusManager.filterClasses&&(c=-1!==a.options.gridFocusManager.filterClasses.indexOf(b)),c||(c=k(b)),!c}function m(a){var b=f(angular.element(a));b.length?(B.log("		addListenersToRow"),b=angular.element(b),b.bind("keydown",o)):B.log("		no focusable elements found in row")}function n(a){var b=f(angular.element(a));b.length?(B.log("		removeListenersToRow"),b=angular.element(b),b.unbind("keydown",o)):B.log("		no focusable elements found in row")}function o(b){var c=angular.element(b.currentTarget),d=!1,e=!1;B.log("FM: onKeyDown"),b.keyCode===D.ENTER&&b.currentTarget.nodeName.match(/A/)||(b.shiftKey&&b.keyCode===D.ENTER||b.keyCode===D.UP?(d=!p(c),d&&a.dispatch(exports.datagrid.events.ON_SCROLL_TO_TOP_ENTER)):(b.keyCode===D.ENTER||b.keyCode===D.DOWN)&&(e=!q(c),e&&a.dispatch(exports.datagrid.events.ON_SCROLL_TO_BOTTOM_ENTER)))}function p(a){var b=u(a,-1);return r(b,a)?!1:x(b)}function q(a){var b=v(a);return r(b,a)?!1:x(b)}function r(a,b){return(a[0]||a)===(b[0]||b)}function s(a){var b=u(a);return!(!b||!b.length||b[0]===a)}function t(a){var b=v(a);return!(!b||!b.length||b[0]===a)}function u(a){return w(a,-1)}function v(a){return B.log("	FM: getNextRowFocusElement"),w(a,1)}function w(c,d){if(B.log("	focusToRowElement"),c=b(c),a.element[0].contains(c[0])){var e,f,g=a.getRowIndexFromElement(c),h=a.getRowElm(g),i=g+d;return 0>i||i>=a.rowsLength?c:(f=ux.selector.quickSelector(c[0],h[0],l),B.log("	selector: %s",f),e=y(i,d,f),e&&e.length?e:c)}}function x(b){B.log("	performFocus %o",b[0]);var c=!1;return a.scrollModel.scrollIntoView(a.getRowIndexFromElement(b),!0),b[0].select&&b[0].select(),b[0]&&(b[0].focus(),c=!0),c}function y(b,c,d){B.log("	findNextRowWithSelection");for(var e=a.getRowElm(b),f=h(e[0],d),g=a.getContent();!f[0]&&(c>0&&b<a.rowsLength-1||0>c&&b>0);){if(b+=c,e=a.getRowElm(b),e[0]===g)return;f=h(e[0],d)}return f}function z(){var b;document.activeElement!==a.element[0]&&a.element[0].contains(document.activeElement)&&(b=a.getRowIndexFromElement(document.activeElement),a.scrollModel.scrollIntoView(b))}function A(b){if(a.options.gridFocusManager&&a.options.gridFocusManager.throttleNextPrev){if(E)return;E=setTimeout(function(){clearTimeout(),E=0},a.options.gridFocusManager.throttleNextPrev)}a.creepRenderModel.stop(),a.flow.add(b,[document.activeElement],0)}var B=exports.logWrapper("gridFocusManager",{},"redOrange",a.dispatch),C=[],D={ENTER:13,UP:38,DOWN:40},E=0;return ux.selector.config.allowId=!1,ux.selector.config.allowAttributes=!1,ux.selector.config.addVisible=!0,B.hasPrevRowFocusElement=s,B.hasNextRowFocusElement=t,B.focusToPrevRowElement=p,B.focusToNextRowElement=q,B.query=h,B.destroy=function(){for(;C.length;)C.pop()();C=null,B=null},C.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_RESET,d)),C.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_RENDER,d)),C.push(a.scope.$on(exports.datagrid.events.ON_AFTER_RENDER,c)),C.push(a.scope.$on(exports.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME,function(){a.element[0].contains(document.activeElement)&&A(p)})),C.push(a.scope.$on(exports.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME,function(){a.element[0].contains(document.activeElement)&&A(q)})),C.push(a.scope.$on(exports.datagrid.events.ON_AFTER_HEIGHTS_UPDATED_RENDER,z)),a.gridFocusManager=B,a}]});
//# sourceMappingURL=ux-datagrid-focusManager.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
