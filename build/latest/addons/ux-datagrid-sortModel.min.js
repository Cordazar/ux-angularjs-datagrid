/*
* ux-angularjs-datagrid v.1.1.7
* (c) 2014, WebUX
* https://github.com/webux/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


exports.datagrid.events.ON_BEFORE_SORT="datagrid:onBeforeSort",exports.datagrid.events.ON_AFTER_SORT="datagrid:onAfterSort",exports.datagrid.events.ON_BEFORE_TOGGLE_SORT="datagrid:onBeforeToggleSort",exports.datagrid.events.ON_AFTER_TOGGLE_SORT="datagrid:onAfterToggleSort",exports.datagrid.events.CLEAR_SORTS="datagrid:clearSorts",exports.datagrid.events.CLEAR_ALL_SORTS="datagrid:clearAllSorts",angular.module("ux").service("sortStatesModel",["$location","$rootScope",function(a,b){return exports.datagrid.sortStatesModel=function(){function c(a){return"$"===a.charAt(0)}function d(){return a.path()}function e(){return E.getCurrentPath().split("?").shift()}function f(){var a;return a=E.getIgnoreParamsInPath()?E.getCurrentPathWithoutParams():E.getCurrentPath(),a!==G&&(E.log("getPath changed from %s to %s",G,a),G=a),a}function g(){var a=I[E.getPath()];return a===!0||a===!1?a:K}function h(a,b){return b=b||E.getPath(),void 0!==a&&(E.log("setAllowMultipleStates %s",a),I[b]=a===!0),!!I[b]}function i(){return J[E.getCurrentPathWithoutParams()]===!0}function j(a){E.log("setIgnoreParamsInPath %s",a),J[E.getCurrentPathWithoutParams()]=a}function k(a){return a=a||E.getPath(),!!H[a]}function l(a){return a=a||E.getPath(),H[a]||(H[a]={$dirty:!1,$path:a,$order:[]}),H[a]}function m(a){var b,d=E.getPathState();E.log("setPathState %s to %s",d,a),E.setIgnoreParamsInPath(!0);for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&a[b]!==d[b]&&!c(b)&&E.setState(b,a[b],d)}function n(a){var b=E.getPathState(E.getPath());return void 0===b[a]&&(b[a]=F.NONE),b[a]}function o(a,b,c){var d,e;if(c=c||E.getPathState(E.getPath()),!E.isPrivate(a)&&c[a]!==b){if(e=c[a],E.getAllowMultipleStates(c.$path)&&(d=c.$order.indexOf(a),-1!==d&&c.$order.splice(d,1)),b!==F.NONE&&(E.getAllowMultipleStates()||E.clear(c),c.$order.push(a)),c[a]=b,!e&&b===F.NONE)return;E.dirtyState(c)}}function p(a){a=a||E.getPathState(E.getPath());var b={text:"",pathState:a};return exports.each(a.$order,E.createKeyFromState,b),b.text}function q(a,b,c,d){E.isPrivate(a)||(d.text+=(d.text.length?"|":"")+a+":"+d.pathState[a])}function r(a){var b=E.getState(a),c=E.getNextState(b);E.info("toggle %s from %s to %s",a,b,c),E.setState(a,c),E.dirtyState()}function s(a){a=a||E.getPathState(E.getPath()),E.log("dirtyState %s",a),a.$dirty=!0}function t(a){a=a||E.getPathState(E.getPath()),E.log("clearDirty %s",a),a.$dirty=!1}function u(a){var b=F.ASC;switch(a){case F.NONE:b=F.ASC;break;case F.ASC:b=F.DESC;break;case F.DESC:b=F.NONE}return b}function v(a){return a=a||E.getPathState(E.getPath()),a.$dirty}function w(a){var b=void 0===a||null===a?"":a;return"string"==typeof b?b.toLowerCase():b}function x(){return"en"}function y(a,b){return a=E.cleanSortValue(a),b=E.cleanSortValue(b),a>b?1:b>a?-1:0}function z(){return 0}function A(a){return function(b,c){var d=b[a],e=c[a];return E.sortValueCompare(d,e)}}function B(a){return function(b,c){var d=b[a],e=c[a];return-E.sortValueCompare(d,e)}}function C(a){var b;a=a||E.getPathState(E.getPath()),a.$order.length=0;for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&!E.isPrivate(b)&&a[b]!==F.NONE&&(a[b]=F.NONE)}function D(){H={},I={}}var E=exports.logWrapper("columnSortStatesModel",{},"blue",function(){b.$emit.apply(b,arguments)}),F={ASC:"asc",DESC:"desc",NONE:"none"},G="",H={},I={},J={},K=!1;return E.getPath=f,E.getCurrentPath=d,E.getCurrentPathWithoutParams=e,E.sortValueCompare=y,E.cleanSortValue=w,E.getNextState=u,E.createKeyFromState=q,E.getAllowMultipleStates=g,E.setAllowMultipleStates=h,E.getIgnoreParamsInPath=i,E.setIgnoreParamsInPath=j,E.hasPathState=k,E.getPathState=l,E.setPathState=m,E.getState=n,E.setState=o,E.toggle=r,E.dirtyState=s,E.clearDirty=t,E.sortNone=z,E.createAscSort=A,E.createDescSort=B,E.hasDirtySortState=v,E.createKeyFromStates=p,E.isPrivate=c,E.getLocale=x,E.clear=C,E.clearAll=D,E.sortOptions=F,E}(),exports.datagrid.sortStatesModel}]),angular.module("ux").factory("sortModel",["sortStatesModel",function(a){return["inst",function(b){function c(a,b,c){var d=c[b];return d&&i[b]&&ux.util.array.sort(a,i[b][d]),a}function d(a,b,d,e){var f,g;if(!k.groupSort&&e.grouped&&e.ary.length&&e.ary[0].hasOwnProperty(e.grouped))for(g=e.ary.length,f=0;g>f;f+=1)e.ary[f]=angular.extend({},e.ary[f]),e.ary[f][e.grouped]=c(e.ary[f][e.grouped].slice(0),a,e.pathState);else c(e.ary,a,e.pathState)}function e(){var c,d,e=a.hasPathState(),f=a.getPathState();if(k.sorts=k.sorts||b.options.sorts,k.sorts)for(c in k.sorts)"object"==typeof k.sorts[c]?(a.setState(c,k.sorts[c].value,f),d=k.sorts[c]):(e||a.setState(c,k.sorts[c],f),d={asc:a.createAscSort(c),desc:a.createDescSort(c),none:a.sortNone}),h.addSortColumn(c,d)}var f,g,h=exports.logWrapper("sortModel",{},"blue",b.dispatch),i={},j={},k=b.options.sortModel||{};return h.addSortColumn=function(b,c){i[b]=c;var d=a.getPathState();d[b]=d[b]||a.sortOptions.NONE},h.getCache=function(a){return j[a]},h.setCache=function(a,b){j[a]=b},h.applySorts=function(c,e,i){var j=a.getPathState(),l=angular.copy(j);if(e&&(h.log("apply sortOptions"),a.setPathState(e)),f!==c||a.hasDirtySortState(j)){if(f=c,!f)return g=f;if(i&&h.clear(),h.setCache("",f),!h.$processing){h.$processing=!0;var m,n=a.createKeyFromStates(j),o=angular.copy(j);h.info("applySorts %s",n),m=b.dispatch(exports.datagrid.events.ON_BEFORE_SORT,n,l,o),m.defaultPrevented?g=f:(h.getCache(n)&&h.getCache(n).length===f.length?h.log("	pull sort from cache"):(h.log("	store sort %s",n),h.setCache(n,f&&f.slice(0)||[]),ux.each(o.$order,d,{grouped:b.grouped,pathState:o,ary:h.getCache(n)})),g=h.getCache(n),a.clearDirty(j),k.enableCache===!1&&h.clear()),h.$processing=!1,b.dispatch(exports.datagrid.events.ON_AFTER_SORT,n,o,l)}}return g},h.isApplied=function(b,c){return a.getPathState()[b]===c},h.getSortStateOf=function(b){return a.getPathState()[b]},h.multipleSort=a.setAllowMultipleStates,h.getSortKey=a.createKeyFromStates,h.toggleSort=function(c){h.log("toggleSort %s",c),b.dispatch(exports.datagrid.events.ON_BEFORE_TOGGLE_SORT,c),b.creepRenderModel&&b.creepRenderModel.stop(),a.toggle(c),h.applySorts(f),b.dispatch(exports.datagrid.events.ON_AFTER_TOGGLE_SORT,c)},h.setSortStateOf=function(b,c){("none"===c||"asc"===c||"desc"===c)&&a.setState(b,c)},h.clear=function(){j={}},h.destroy=function(){h=null,g=null,i=null,j=null,f=null,b.sortModel=null,b=null},b.unwatchers.push(b.scope.$on(exports.datagrid.events.CLEAR_SORTS,exports.datagrid.sortStatesModel.clear)),b.unwatchers.push(b.scope.$on(exports.datagrid.events.CLEAR_ALL_SORTS,exports.datagrid.sortStatesModel.clearAll)),b.sortModel=h,e(),b}]}]);
//# sourceMappingURL=ux-datagrid-sortModel.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
