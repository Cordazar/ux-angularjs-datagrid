/*
* uxDatagrid v.0.2.0
* (c) 2014, WebUX
* https://github.com/webux/ux-angularjs-datagrid
* License: MIT.
*/
!function(a){function b(b,c){var d,e,f,g=0;if(arguments.length>2&&(f=a.util.array.toArray(arguments),f.splice(0,2)),b&&b.length)for(d=b.length;d>g;){if(e=c.apply(null,[b[g],g,b].concat(f)),void 0!==e)return e;g+=1}else for(g in b)if(b.hasOwnProperty(g)&&(e=c.apply(null,[b[g],g,b].concat(f)),void 0!==e))return e;return b}function c(a,b,c){var d,e=0,f=[];if(a&&a.length)for(d=a.length;d>e;)b(a[e],e,a,c)&&f.push(a[e]),e+=1;else for(e in a)a.hasOwnProperty(e)&&b(a[e],e,a,c)&&f.push(a[e]);return f}function d(a,b,c){function d(a,b){var c,d;d=h[a],d&&(b?(c=d.indexOf(b),-1!==c&&d.splice(c,1)):d.length=0)}function e(a,b){return h[a]=h[a]||[],h[a].push(b),function(){d(a,b)}}function f(b,c){return b&&b.apply(a,c)}function g(a){if(h[a])for(var b=0,c=h[a],d=c.length;d>b;)f(c[b],arguments),b+=1}var h={};b&&c?(a.on=b[c.on]&&b[c.on].bind(b),a.off=b[c.off]&&b[c.off].bind(b),a.dispatch=b[c.dispatch].bind(b)):(a.on=e,a.off=d,a.dispatch=g)}function e(a){for(var b=[],c=0,d=a.length;d>c;)b.push(a[c]),c+=1;return b}function f(a,b){var c,d,e,f,g;for(b||(b=function(a,b){return a>b?1:b>a?-1:0}),d=a.length,f=d-1,c=0;d>c;c+=1)for(e=0;f>e;e+=1)b(a[e],a[e+1])>0&&(g=a[e+1],a[e+1]=a[e],a[e]=g);return a}function g(b,c){function d(a){return a.toString().split(/\b/)[2]}function e(a,b,c){return{label:d(a),method:a,args:b||[],delay:c}}function f(a){var b=d(a);C[b]=a}function g(a){for(var c=0,d=z.length;d>c;)z[c].label===a.label&&z[c]!==y&&(b.log("clear duplicate item %c%s",E,a.label),z.splice(c,1),c-=1,d-=1),c+=1}function h(a,b,c){var d=e(a,b,c);C[d.label]&&g(d),z.push(d),x&&q()}function i(a,b,c){z.splice(1,0,e(a,b,c))}function j(a){g({label:d(a)})}function k(a,c){var d,f=e(a,[],c),g=Date.now(),h=function(){b.log("exec timeout method %c%s %sms",E,f.label,Date.now()-g),a()};return b.log("wait for timeout method %c%s",E,f.label),d=setTimeout(h,c),D[d]=function(){clearTimeout(d),delete D[d]},d}function l(a){D[a]&&D[a]()}function m(a){var b=a.toString(),c=b.match(/\(.*\)/);return c[0].match(/([\$\w])+/gm)}function n(a){var b=m(a);return!(!b||-1===b.indexOf("done"))}function o(){return w=Date.now(),b.log("finish %c%s took %dms",E,y.label,w-v),y=null,p(z.shift()),z.length&&q(),w-v}function p(a){for(A.unshift(a);A.length>B;)A.pop()}function q(){!y&&z.length&&(y=z[0],b.async&&void 0!==y.delay?(b.log("	delay for %c%s %sms",E,y.label,y.delay),clearTimeout(u),u=setTimeout(r,y.delay)):r())}function r(){b.log("start method %c%s",E,y.label);var a=n(y.method);a&&y.args.push(o),v=Date.now(),y.method.apply(null,y.args),a||o()}function s(){x=!0,q()}function t(){clearTimeout(u),z.length=0,b=null}var u,v,w,x=!1,y=null,z=[],A=[],B=10,C={},D={},E="color:#666666;";return b=a.logWrapper("Flow",b||{},"grey",c),b.async=b.hasOwnProperty("async")?b.async:!0,b.debug=b.hasOwnProperty("debug")?b.debug:0,b.insert=i,b.add=h,b.unique=f,b.remove=j,b.timeout=k,b.stopTimeout=l,b.run=s,b.destroy=t,b}function h(c,d,e,f){function h(){fb.unique($),fb.unique(X),fb.unique(P)}function i(){ub.scope=c,ub.element=d,ub.attr=e,ub.rowsLength=0,ub.scopes=lb,ub.data=ub.data||[],ub.unwatchers=kb,ub.values=tb,ub.start=l,ub.update=Y,ub.reset=$,ub.isReady=r,ub.forceRenderScope=_,ub.dispatch=cb,ub.render=function(){fb.add(X)},ub.updateHeights=bb,ub.getOffsetIndex=M,ub.isActive=L,ub.isCompiled=w,ub.getScope=u,ub.getRowElm=v,ub.getRowIndex=ub.getIndexOf=x,ub.getRowOffset=z,ub.getRowHeight=A,ub.getViewportHeight=B,ub.getContentHeight=C,ub.getContent=k,ub.safeDigest=I,ub.getRowIndexFromElement=y,ub.upateViewportHeight=q,ub.calculateViewportHeight=s,ub.options=hb=angular.extend({},a.datagrid.options,c.$eval(e.options)||{}),ub.flow=fb=new g({async:hb.hasOwnProperty("async")?!!hb.async:!0,debug:hb.hasOwnProperty("debug")?hb.debug:0},ub.dispatch),fb.add(h),fb.run()}function j(){var a=d[0].getElementsByClassName("content")[0],b="content";return a&&(b=a.className||"content"),a||(a=angular.element('<div class="'+b+'"></div>'),d.append(a)),a[0]||(a=angular.element(a)),a}function k(){return gb}function l(){ub.dispatch(a.datagrid.events.ON_INIT),gb=j(),m(0)}function m(a){if(!ub.element[0].offsetHeight){if(1>a)return fb.add(m,[a+1],0),void 0;fb.warn("Datagrid: Dom Element does not have a height.")}fb.add(ub.templateModel.createTemplates,null,0),fb.add(function(){hb.dynamicRowHeights=ub.templateModel.dynamicHeights()}),fb.add(n)}function n(){window.addEventListener("resize",t),kb.push(c.$on(a.datagrid.events.UPDATE,Y)),kb.push(c.$on(a.datagrid.events.ON_ROW_TEMPLATE_CHANGE,ab)),kb.push(c.$on("$destroy",eb)),fb.add(o,[],0),ub.dispatch(a.datagrid.events.ON_LISTENERS_READY)}function o(){jb||(ub.log("setupChangeWatcher"),jb=!0,kb.push(c.$watch(e.uxDatagrid,p)))}function p(a,b){fb.add(Z,[a,b])}function q(){pb=ub.calculateViewportHeight()}function r(){return sb===qb.READY}function s(){return d[0].offsetHeight}function t(b){cb(a.datagrid.events.RESIZE,{event:b})}function u(a){return lb[a]}function v(a){return angular.element(ub.chunkModel.getRow(a))}function w(a){return!!lb[a]}function x(a){return this.getData().indexOf(a)}function y(a){if(d[0].contains(a[0]||a)){for(var b=a.scope?a.scope():angular.element(a).scope();b&&b.$parent!==ub.scope;)b=b.$parent;return b.$index}return-1}function z(a){return void 0===ob[a]&&(hb.dynamicRowHeights?O():ob[a]=a*hb.rowHeight),ob[a]}function A(a){return ub.templateModel.getTemplateHeight(ub.data[a])}function B(){return pb}function C(){return ub.chunkModel.getChunkList().height}function D(a){ub.log("OVERWRITE DOM!!!");var b=a.length;fb.insert(ub.chunkModel.chunkDom,[a,hb.chunkSize,'<div class="'+hb.chunkClass+'">',"</div>",gb],0),ub.rowsLength=b,ub.log("created %s dom elements",b)}function E(a){var b,d,e,g=lb[a];return g||(g=c.$new(),b=u(a-1),d=ub.templateModel.getTemplate(ub.data[a]),b&&(b.$$nextSibling=g,g.$$prevSibling=b),g.$status="compiled",g[d.item]=ub.data[a],g.$index=a,lb[a]=g,e=v(a),e.removeClass(hb.uncompiledClass),f(e)(g),J(g)),g}function F(a){ub.log("	buildRows %s",a.length),sb=qb.BUILDING,fb.insert(D,[a],0)}function G(){ub.log("	ready"),sb=qb.ON_READY,fb.add(X),fb.add(H),fb.add(I,[c])}function H(){c.$emit(a.datagrid.events.ON_READY)}function I(a){a.$$phase||a.$digest()}function J(a){var b;if(a&&!L(a)){if(a.$$$watchers=a.$$watchers,a.$$watchers=[],a.$$childHead)for(b=a.$$childHead;b;)J(b),b=b.$$nextSibling;return!0}return!1}function K(a){var b;if(a&&a.$$$watchers){if(a.$$watchers=a.$$$watchers,a.$$$watchers=null,a.$$childHead)for(b=a.$$childHead;b;)K(b),b=b.$$nextSibling;return!0}return!(!a||a.$$$watchers)}function L(a){var b=lb[a];return!(!b||b.$$$watchers)}function M(a){var b=Math.floor(a/ub.templateModel.averageTemplateHeight()),c=0;for(ob[b]&&ob[b]<=a&&(c=b);c<ub.rowsLength;){if(ob[c]>a)return c-1;c+=1}return c}function N(){var a=pb,b={startIndex:0,i:0,inc:1,end:ub.rowsLength,visibleScrollStart:tb.scroll+hb.cushion,visibleScrollEnd:tb.scroll+a-hb.cushion};return b.startIndex=b.i=M(tb.scroll),b}function O(){for(var a=0,b=0;b<ub.rowsLength;)ob[b]=a,a+=ub.templateModel.getTemplateHeight(ub.data[b]),b+=1;hb.rowHeight=ub.rowsLength?ub.templateModel.getTemplateHeight("default"):0}function P(){var a,b,d,e=N(),f=40*e.i,g=[].concat(mb);if(!(e.i<0)){for(ub.dispatch(rb.ON_BEFORE_UPDATE_WATCHERS,e),S(),mb.length=0,ub.log("	visibleScrollStart %s visibleScrollEnd %s",e.visibleScrollStart,e.visibleScrollEnd);e.i<ub.rowsLength&&(d=c.$$childHead?lb[e.i-1]:null,f=z(e.i),f>=e.visibleScrollStart&&f<=e.visibleScrollEnd&&(b=E(e.i),void 0===e.started&&(e.started=e.i),T(e.i),K(b)&&(a=g.indexOf(e.i),-1!==a&&g.splice(a,1),mb.push(e.i),I(b))),e.i+=e.inc,!(e.inc>0&&f>e.visibleScrollEnd||e.inc<0&&f<e.visibleScrollStart)););e.ended=e.i-1,ub.log("	startIndex %s endIndex %s",e.startIndex,e.i),Q(g),nb=e.visibleScrollStart,ub.log("	activated %s",mb.join(", ")),R(),fb.add(I,[c]),ub.dispatch(rb.ON_AFTER_UPDATE_WATCHERS,e)}}function Q(a){for(var b,c=[];a.length;)b=a.pop(),c.push(b),J(lb[b]);ub.log("	deactivated %s",c.join(", "))}function R(){if(mb.length){var a=mb[mb.length-1],b=0,d=mb.length;for(c.$$childHead=lb[mb[0]],c.$$childTail=lb[a];d>b;)lb[mb[b]].$$prevSibling=lb[mb[b-1]],lb[mb[b]].$$nextSibling=lb[mb[b+1]],b+=1}}function S(){tb.activeRange.min=tb.activeRange.max=-1}function T(a){tb.activeRange.min=tb.activeRange.min<a&&tb.activeRange.min>=0?tb.activeRange.min:a,tb.activeRange.max=tb.activeRange.max>a&&tb.activeRange.max>=0?tb.activeRange.max:a}function U(){tb.dirty&&cb(a.datagrid.events.ON_BEFORE_RENDER_AFTER_DATA_CHANGE)}function V(){tb.dirty&&(tb.dirty=!1,cb(a.datagrid.events.ON_RENDER_AFTER_DATA_CHANGE))}function W(){return pb?!0:(ub.upateViewportHeight(),ib+=1,2>ib?(ub.info(a+".datagrid is waiting for element to have a height."),fb.add(X,null,0)):fb.warn("Datagrid: Unable to determine a height for the datagrid. Cannot render. Exiting."),!1)}function X(){if(ub.log("render"),W())if(ib=0,ub.log("	render %s",sb),sb===qb.BUILDING)fb.add(F,[ub.data],0),fb.add(O),fb.add(G);else{if(sb!==qb.ON_READY)throw new Error("RENDER STATE INVALID");ub.dispatch(a.datagrid.events.ON_BEFORE_RENDER),fb.add(U),fb.add(P),fb.add(V),fb.add(ub.dispatch,[a.datagrid.events.ON_AFTER_RENDER])}else ub.log("	not ready to render.")}function Y(){ub.warn("force update"),Z(c.$eval(e.uxDatagrid),ub.data)}function Z(b){cb(a.datagrid.events.ON_BEFORE_DATA_CHANGE),tb.dirty=!0,ub.log("dataChanged"),ub.grouped=c.$eval(e.grouped),ub.data=ub.setData(b||e.list,ub.grouped)||[],cb(a.datagrid.events.ON_AFTER_DATA_CHANGE),fb.add($)}function $(){cb(a.datagrid.events.ON_RESET),sb=qb.BUILDING,db(),ob={},mb.length=0,lb.length=0,gb.children().unbind(),gb.children().remove(),ub.chunkModel.reset(),fb.add(q),fb.add(X)}function _(a){var b=lb[a];!b&&a>0&&a<ub.rowsLength&&(b=E(a)),b&&!c.$$phase&&(K(b),b.$digest(),J(b))}function ab(a,b){var d=ub.getNormalizedIndex(b),e=v(d),f=e.hasClass(hb.uncompiledClass)?E(d):e.scope();f!==c&&(f.$destroy(),lb[d]=null,e.replaceWith(ub.templateModel.getTemplate(b).template),lb[d]=E(d),bb(d))}function bb(a){fb.add(ub.chunkModel.updateAllChunkHeights,[a]),fb.add(O),fb.add(X)}function cb(){c.$root.$broadcast.apply(c,arguments)}function db(){var a,d,e=0;b(lb,function(b,c){if(b){for(b.$$prevSibling=a||void 0,e=c;!d&&e<ub.rowsLength;)e+=1,d=lb[e]||void 0;K(b),a=b,b.$destroy()}}),c.$$childHead=void 0,c.$$childTail=void 0,lb.length=0}function eb(){for(c.datagrid=null,ub.log("destroying grid"),clearTimeout(tb.scrollingStopIntv),fb.destroy(),ub.flow=void 0,fb=null;kb.length;)kb.pop()();ub.destroyLogger();for(var a in ub)ub[a]&&ub[a].hasOwnProperty("destroy")&&(ub[a].destroy(),ub[a]=null);db(),d.remove(),ub=null,c=null,d=null,e=null,kb=null,gb=null,mb.length=0,mb=null,lb.length=0,lb=null,tb=null,qb=null,rb=null,f=null}var fb,gb,hb,ib=0,jb=!1,kb=[],lb=[],mb=[],nb=0,ob={},pb=0,qb=a.datagrid.states,rb=a.datagrid.events,sb=qb.BUILDING,tb={dirty:!1,scroll:0,speed:0,absSpeed:0,scrollPercent:0,touchDown:!1,scrollingStopIntv:null,activeRange:{min:0,max:0}},ub={};return a.logWrapper("datagrid",ub,"green",cb),i(),ub}var i;try{i=angular.module("ux",["ng"])}catch(j){i=angular.module("ux")}a.datagrid={isIOS:navigator.userAgent.match(/(iPad|iPhone|iPod)/g),states:{BUILDING:"datagrid:building",ON_READY:"datagrid:ready"},events:{ON_INIT:"datagrid:init",ON_LISTENERS_READY:"datagrid:listenersReady",ON_READY:"datagrid:ready",ON_BEFORE_RENDER:"datagrid:beforeRender",ON_AFTER_RENDER:"datagrid:afterRender",ON_BEFORE_UPDATE_WATCHERS:"datagrid:beforeUpdateWatchers",ON_AFTER_UPDATE_WATCHERS:"datagrid:afterUpdateWatchers",ON_BEFORE_DATA_CHANGE:"datagrid:beforeDataChange",ON_AFTER_DATA_CHANGE:"datagrid:afterDataChange",ON_BEFORE_RENDER_AFTER_DATA_CHANGE:"datagrid:beforeRenderAfterDataChange",ON_RENDER_AFTER_DATA_CHANGE:"datagrid:renderAfterDataChange",ON_ROW_TEMPLATE_CHANGE:"datagrid:onRowTemplateChange",ON_SCROLL:"datagrid:onScroll",ON_RESET:"datagrid:onReset",RESIZE:"datagrid:resize",UPDATE:"datagrid:update",SCROLL_TO_INDEX:"datagrid:scrollToIndex",SCROLL_TO_ITEM:"datagrid:scrollToItem",SCROLL_INTO_VIEW:"datagrid:scrollIntoView",LOG:"datagrid:log",INFO:"datagrid:info",WARN:"datagrid:warn",ERROR:"datagrid:error"},options:{async:!0,updateDelay:500,cushion:-50,chunkSize:50,uncompiledClass:"uncompiled",renderThreshold:10,renderThresholdWait:50,creepLimit:100,chunkClass:"ux-datagrid-chunk"},coreAddons:[]},i.factory("addons",["$injector",function(a){function b(b,c){for(var d,e=0,f=b.length;f>e;){if(d=a.get(b[e]),"function"!=typeof d)throw new Error("Addons expect a function to pass the grid instance to.");d(c),e+=1}}return function(a,c){c=c instanceof Array?c:c&&c.replace(/,/g," ").replace(/\s+/g," ").split(" ")||[],a.addons&&(c=a.addons=a.addons.concat(c)),b(c,a)}}]),a.css=function(){function a(a){return b(a)||(i[a]=c(a)),b(a)}function b(a){return i[a]}function c(a){if(document.styleSheets&&0!==document.getElementsByTagName(k.head).length){var b,c,d,e;if(document.styleSheets.length>0)for(d=0;d<document.styleSheets.length&&(document.styleSheets[d].disabled||(e=document.styleSheets[d].media,c=typeof e,c===k.string?(""===e||-1!==e.indexOf(k.screen))&&(b=document.styleSheets[d]):c===k.object&&(""===e.mediaText||-1!==e.mediaText.indexOf(k.screen))&&(b=document.styleSheets[d]),"undefined"==typeof b));d++);var f=document.createElement("style");for(f.type="text/css",f.title=a,document.getElementsByTagName(k.head)[0].appendChild(f),d=0;d<document.styleSheets.length;d++)document.styleSheets[d].disabled||(b=document.styleSheets[d]);return{name:a,styleSheet:b}}}function d(c,d,e){var f,g=b(c)||a(c),h=g.styleSheet;if(h.addRule){for(f=0;f<h.rules.length;f++)if(h.rules[f].selectorText&&h.rules[f].selectorText.toLowerCase()===d.toLowerCase())return h.rules[f].style.cssText=e,void 0;h.addRule(d,e)}else if(h.insertRule){for(f=0;f<h.cssRules.length;f++)if(h.cssRules[f].selectorText&&h.cssRules[f].selectorText.toLowerCase()===d.toLowerCase())return h.cssRules[f].style.cssText=e,void 0;h.insertRule(d+"{"+e+"}",0)}}function e(a){var b,c,d,e,g;if(-1!==a.indexOf("{")||-1!==a.indexOf("}"))return null;if(j[a])return j[a];for(b=0,c=document.styleSheets.length;c>b;b+=1)if(d=document.styleSheets[b],e=d.rules||d.cssRules,g=f(e,a))return g;return null}function f(a,b){var c,d,e,g;if(a)for(c=0,d=a.length;d>c;c+=1){if(e=a[c],e.cssRules&&(g=f(e.cssRules,b)))return g;if(e.selectorText){var h="(\b)*"+b.replace(".","\\.")+"([^-a-zA-Z0-9]|,|$)",i=e.selectorText.match(h);if(i&&-1!==i.indexOf(b))return j[b]=e.style,e.style}}return null}function g(a,b){var c=e(a);return c&&void 0!==c[b]?c[b]:null}function h(a,b,c){var d=e(a);d[b]=c}var i={},j={},k={head:"head",screen:"screen",string:"string",object:"object"};return{createdStyleSheets:[],createStyleSheet:c,createClass:d,getCSSValue:g,setCSSValue:h}}(),a.each=b,a.filter=c,a.util=a.util||{},a.util.array=a.util.array||{},a.util.array.toArray=e,a.util.array.sort=f,a.logWrapper=function(b,c,d,e){return d=d||"black",e=e||c.dispatch||function(){},c.$logName=b,c.log=function(){var f=[a.datagrid.events.LOG,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.info=function(){var f=[a.datagrid.events.INFO,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.warn=function(){var f=[a.datagrid.events.WARN,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.error=function(){var f=[a.datagrid.events.ERROR,b,d].concat(a.util.array.toArray(arguments));e.apply(c,f)},c.destroyLogger=function(){c.logger&&(c.log("destroy"),c.logger.destroy(),c.logger=null)},c},a.datagrid.Flow=g,i.directive("uxDatagrid",["$compile","addons",function(c,d){return{restrict:"AE",link:function(e,f,g){var i=new h(e,f,g,c);e.datagrid=i,b(a.datagrid.coreAddons,function(a){a.apply(i,[i])}),d(i,g.addons),i.start()}}}]);var k=function(){};k.prototype=Array.prototype,k.prototype.min=0,k.prototype.max=0,k.prototype.templateStart="",k.prototype.templateEnd="",k.prototype.getStub=function(a){return this.templateStart+a+this.templateEnd},k.prototype.getChildrenStr=function(a){for(var b=0,c=this.length,d="",e=this;c>b;)d+=e[b]instanceof k?e[b].getStub(a?e[b].getChildrenStr(a):""):this.templateModel.getTemplate(e[b]).template,b+=1;return this.rendered=!0,d},k.prototype.updateHeight=function(a,b){var c,d=0,e=0;if(this[0]instanceof k)for(c=this.length;c>d;)e+=this[d].height,d+=1;else e=a.getHeight(b,this.min,this.max);this.height!==e&&(this.dirtyHeight=!0),this.height=e,this.dirtyHeight&&this.parent&&this.parent.updateHeight(a,b)},k.prototype.destroy=function(){this.templateStart="",this.templateEnd="",this.templateModel=null,this.rendered=!1,this.parent=null,this.length=0},a.datagrid.coreAddons.chunkModel=function(b){function c(){return p}function e(a,c,d,g){for(var h,i,j=0,l=a.length,m=new k;l>j;)i=a[j],j%c===0&&(h&&f(h),h=new k,h.min=i.min||j,h.templateModel=b.templateModel,h.templateStart=d,h.templateEnd=g,h.parent=m,h.index=m.length,m.push(h)),i instanceof k&&(i.parent=h),h.push(i),h.max=i.max||j,j+=1;return h&&f(h),m.min||(m.min=m[0]?m[0].min:0,m.max=m[m.length-1]?m[m.length-1].max:0,m.templateStart=d,m.templateEnd=g,f(m),m.dirtyHeight=!1),m.length>c?e(m,c,d,g):m}function f(a){a.updateHeight(b.templateModel,q),a.rendered||(a.templateStart=a.templateStart.substr(0,a.templateStart.length-1)+' style="width:100%;height:'+a.height+'px;">')}function g(a){for(var c,d=j(a,p),e=p;d.length;)c=d.shift(),e[c]instanceof k&&(e=e[c]);e.updateHeight(b.templateModel,q),h(s,p,d)}function h(a,b){for(var c=0,d=b.length;d>c;)b.dirtyHeight&&(b.dirtyHeight=!1,a.css({height:b.height+"px"}),h(angular.element(a.children()[c]),b[c])),c+=1}function i(a,b,c,d,f){return t.log("chunkDom"),s=f,r=b,q=a,p=e(a,b,c,d),f}function j(a,b,c){var d,e=0,f=b.length;for(c=c||[];f>e;){if(d=b[e],!(d instanceof k)){c.push(a%r);break}if(a>=d.min&&a<=d.max){c.push(e),j(a,d,c);break}e+=1}return c}function l(a){var b=j(a,p);return m(b)}function m(a){for(var b,c=0,d=a.slice(0),e=p,f=s;c<d.length;)b=d.shift(),e.rendered||f.html(e.getChildrenStr()),e=e[b],f=angular.element(f.children()[b]);return f}function n(){t.log("reset"),p&&p.destroy(),q=null,p=null,r=null,s=null}function o(){n(),t.destroyLogger()}var p,q,r,s,t=a.logWrapper("chunkModel",{},"purple",b.dispatch);return t.chunkDom=i,t.getChunkList=c,t.getRowIndexes=function(a){return j(a,p)},t.getRow=l,t.reset=n,t.updateAllChunkHeights=g,t.destroy=o,d(t),b.chunkModel=t,t},a.datagrid.coreAddons.push(a.datagrid.coreAddons.chunkModel),a.datagrid.events.RENDER_PROGRESS="datagrid:renderProgress",a.datagrid.coreAddons.creepRenderModel=function(c){function d(a){var b=c.getScope(a);b&&b.digested||c.forceRenderScope(a)}function e(){var a={count:0};return b(c.scopes,f,a),{count:a.count,len:c.rowsLength}}function f(a,b,c,d){d.count+=a?1:0}function g(a,b,d){c.values.touchDown||(p=Date.now()+c.options.renderThreshold,t=a,u=b,i(j,d))}function h(b,d){var e,f=a.util.array.toArray(arguments);return f.splice(0,2),c.options.async?(c.flow.remove(b),e=c.flow.add(b,f,d)):b.apply(this,f),e}function i(a,b){var e=!1,f=Date.now();p>f&&(t>=0||u<c.rowsLength)?(t>=0&&(e=b||!c.isCompiled(t),e&&d(t),t-=1),u<c.rowsLength&&(e=b||e||!c.isCompiled(u),e&&d(u),u+=1),i(a,b)):a()}function j(){k(),r+=1,!c.values.speed&&c.scopes.length<c.rowsLength&&l(t,u),c.dispatch(a.datagrid.events.RENDER_PROGRESS,e())}function k(){p=0,clearTimeout(q),q=0}function l(a,b,d,e){k(),r<c.options.creepLimit&&(q=h(g,d||c.options.renderThresholdWait,a,b,e))}function m(a,b){l(t,u,500,b)}function n(){r=c.options.creepLimit,k()}function o(a,b,c){r=0,t=b.started||0,u=b.ended||0,m(a,c)}var p,q=0,r=0,s={},t=0,u=0;s.stop=k,s.destroy=function(){k(),c=null,s=null},c.creepRenderModel=s,c.unwatchers.push(c.scope.$on(a.datagrid.events.BEFORE_VIRTUAL_SCROLL_START,n)),c.unwatchers.push(c.scope.$on(a.datagrid.events.ON_VIRTUAL_SCROLL_UPDATE,n)),c.unwatchers.push(c.scope.$on(a.datagrid.events.TOUCH_DOWN,n)),c.unwatchers.push(c.scope.$on(a.datagrid.events.SCROLL_START,n)),c.unwatchers.push(c.scope.$on(a.datagrid.events.ON_RESET,n)),c.unwatchers.push(c.scope.$on(a.datagrid.events.ON_AFTER_UPDATE_WATCHERS,o))},a.datagrid.coreAddons.push(a.datagrid.coreAddons.creepRenderModel),a.datagrid.coreAddons.normalizeModel=function(b){function c(a,b,d){a=a||[];var e=0,f=a.length;for(d=d||[];f>e;)d.push(a[e]),a[e]&&a[e][b]&&c(a[e][b],b,d),e+=1;return d}var d,e,f=a.logWrapper("normalizeModel",{},"grey",b.dispatch);return b.setData=function(a,b){return f.log("setData"),d=a,e=b?c(a,b):a&&a.slice(0)||[]},b.getData=function(){return e},b.getOriginalData=function(){return d},b.getNormalizedIndex=function(a,c){for(var d=c||0;d<b.rowsLength;){if(b.data[d]===a)return d;d+=1}if(c)for(d=c;d>=0;){if(b.data[d]===a)return d;d-=1}return-1},f.destroy=function(){f.destroyLogger(),f=null},b.normalizeModel=f,b},a.datagrid.coreAddons.push(a.datagrid.coreAddons.normalizeModel),a.datagrid.events.SCROLL_START="datagrid:scrollStart",a.datagrid.events.SCROLL_STOP="datagrid:scrollStop",a.datagrid.events.TOUCH_DOWN="datagrid:touchDown",a.datagrid.events.TOUCH_UP="datagrid:touchUp",a.datagrid.coreAddons.scrollModel=function(b){function c(){b.element.css("overflow")||b.element.css({overflow:"auto"}),h.log("addScrollListener"),b.element[0].addEventListener("scroll",e),b.unwatchers.push(b.scope.$on(a.datagrid.events.SCROLL_TO_INDEX,function(a,b){h.scrollToIndex(b)})),b.unwatchers.push(b.scope.$on(a.datagrid.events.SCROLL_TO_ITEM,function(a,b){h.scrollToItem(b)})),b.unwatchers.push(b.scope.$on(a.datagrid.events.SCROLL_INTO_VIEW,function(a,b){h.scrollIntoView(b)})),d(),i=!0,b.flow.unique(h.onScrollingStop)}function d(){h.log("addTouchEvents");var a=b.getContent();a.bind("touchstart",h.onTouchStart),a.bind("touchend",h.onTouchEnd),a.bind("touchcancel",h.onTouchEnd)}function e(a){b.flow.add(h.onUpdateScroll,[a])}function f(){h.destroyLogger(),g(),i&&(h.removeScrollListener(),h.removeTouchEvents()),h=null,b=null}var g,h=a.logWrapper("scrollModel",{},"orange",b.dispatch),i=!1;return h.removeScrollListener=function(){h.log("removeScrollListener"),b.element[0].removeEventListener("scroll",e)},h.removeTouchEvents=function(){i&&(h.log("removeTouchEvents"),b.getContent().unbind("touchstart",h.onTouchStart),b.getContent().unbind("touchend",h.onTouchEnd),b.getContent().unbind("touchcancel",h.onTouchEnd))},h.onTouchStart=function(c){b.values.touchDown=!0,b.dispatch(a.datagrid.events.TOUCH_DOWN,c)},h.onTouchEnd=function(c){b.values.touchDown=!1,b.dispatch(a.datagrid.events.TOUCH_UP,c)},h.getScroll=function(a){return(a||b.element[0]).scrollTop},h.setScroll=function(a){b.element[0].scrollTop=a,b.values.scroll=a},h.onUpdateScroll=function(c){var d=h.getScroll(c.target||c.srcElement);b.values.scroll!==d&&(b.dispatch(a.datagrid.events.SCROLL_START,d),b.values.speed=d-b.values.scroll,b.values.absSpeed=Math.abs(b.values.speed),b.values.scroll=d,b.values.scrollPercent=(b.values.scroll/b.getContentHeight()*100).toFixed(2)),h.waitForStop(),b.dispatch(a.datagrid.events.ON_SCROLL,b.values)},h.scrollTo=function(a,b){h.setScroll(a),b?h.onScrollingStop():h.waitForStop()},h.clearOnScrollingStop=function(){b.flow.remove(h.onScrollingStop)},h.waitForStop=function(){b.flow.async||b.values.touchDown?b.flow.add(h.onScrollingStop,null,b.options.updateDelay):b.flow.add(h.onScrollingStop)},h.onScrollingStop=function(){b.values.speed=0,b.values.absSpeed=0,b.flow.add(b.render),b.dispatch(a.datagrid.events.SCROLL_STOP,b.values.scroll)},h.scrollToIndex=function(a,c){h.log("scrollToIndex");var d=b.getRowOffset(a);return h.scrollTo(d,c),d},h.scrollToItem=function(a,c){h.log("scrollToItem");var d=b.getNormalizedIndex(a);return-1!==d?h.scrollToIndex(d,c):b.values.scroll},h.scrollIntoView=function(a,c){h.log("scrollIntoView");var d,e,f="number"==typeof a?a:b.getNormalizedIndex(a),g=b.getRowOffset(f);return g<b.values.scroll?(h.scrollTo(g,c),void 0):(e=b.getViewportHeight(),d=b.templateModel.getTemplateHeight(b.getData()[f]),g>=b.values.scroll+e-d&&h.scrollTo(g-e+d),void 0)},h.scrollToTop=function(a){h.log("scrollToTop"),h.scrollTo(0,a)},h.scrollToBottom=function(a){h.log("scrollToBottom");var c=b.getContentHeight()-b.getViewportHeight();h.scrollTo(c>=0?c:0,a)},g=b.scope.$on(a.datagrid.events.ON_READY,c),h.destroy=f,b.scrollModel=h,b},a.datagrid.coreAddons.push(a.datagrid.coreAddons.scrollModel),a.datagrid.coreAddons.templateModel=function(b){"use strict";function c(a){return a=a.replace(/\n/g,""),a=a.replace(/[\t ]+</g,"<"),a=a.replace(/>[\t ]+</g,"><"),a=a.replace(/>[\t ]+$/g,">")}return b.templateModel=function(){function d(){u.log("createTemplates");var a,c=b.element[0].getElementsByTagName("script"),d=c.length;if(!d)throw new Error("at least one template is required.");for(a=0;d>a;a+=1)e(c[a]);for(;c.length;)b.element[0].removeChild(c[0])}function e(a){var d,e=c(angular.element(a).html()),g=document.createElement("div"),h=f(a,"template-name")||t;if(e=angular.element(e)[0],e.className+=" "+b.options.uncompiledClass+" {{$status}}",e.setAttribute("template",h),b.getContent()[0].appendChild(g),g.appendChild(e),e=c(g.innerHTML),g.childNodes[0].style.lineHeight="0px",d={name:h,item:f(a,"template-item"),template:e,height:g.offsetHeight},u.log("template: %s %o",h,d),!d.height)throw new Error("Template height cannot be 0.");return s[d.name]=d,s.push(d),b.getContent()[0].removeChild(g),r=0,d}function f(a,b){var c=a.attributes["data-"+b]||a.attributes[b];return c&&c.nodeValue||""}function g(){return s}function h(a){return a.attr?a.attr("template"):a.getAttribute("template")}function i(a){return s[a]?s[a]:s[t]}function j(){var a,b;for(a in s)if(s.hasOwnProperty(a)&&(b=b||s[a].height,b!==s[a].height))return!0;return!1}function k(){var a=0,b=s.length;if(!r)for(;b>a;)r+=s[a].height,a+=1;return r/b}function l(){return s.length}function m(a){return u.getTemplate(a).height}function n(a,b,c){var d=b,e=0;if(!a.length)return 0;for(;c>=d;)e+=u.getTemplateHeight(a[d]),d+=1;return e}function o(a,b){a._template=b}function p(c,d){u.log("setTemplate %s %s",c,d);var e="number"==typeof c?b.data[c]:c,f=u.getTemplate(e).name;u.setTemplateName(e,d),b.dispatch(a.datagrid.events.ON_ROW_TEMPLATE_CHANGE,e,f,d)}function q(){u.destroyLogger(),u=null,s.length=0,s=null}var r,s=[],t="default",u=a.logWrapper("templateModel",{},"teal",b.dispatch);return u.getTemplate=function(a){return u.getTemplateByName(a._template)},u.defaultName=t,u.createTemplates=d,u.getTemplates=g,u.getTemplateName=h,u.getTemplateByName=i,u.templateCount=l,u.dynamicHeights=j,u.averageTemplateHeight=k,u.getHeight=n,u.getTemplateHeight=m,u.setTemplate=p,u.setTemplateName=o,u.destroy=q,u}(),b.templateModel},a.datagrid.coreAddons.push(a.datagrid.coreAddons.templateModel)}(this.ux=this.ux||{},function(){return this}());