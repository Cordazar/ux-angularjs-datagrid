/*
* uxDatagrid v.0.1.0
* (c) 2014, WebUX
* License: MIT.
*/
!function(a){function b(a,b,c){var d,e,f=0;if(a&&a.length)for(d=a.length;d>f;){if(e=b(a[f],f,a,c),void 0!==e)return e;f+=1}else for(f in a)if(a.hasOwnProperty(f)&&(e=b(a[f],f,a,c),void 0!==e))return e;return a}function c(a,b,c){var d,e=0,f=[];if(a&&a.length)for(d=a.length;d>e;)b(a[e],e,a,c)&&f.push(a[e]),e+=1;else for(e in a)a.hasOwnProperty(e)&&b(a[e],e,a,c)&&f.push(a[e]);return f}function d(a,b,c){function d(a,b){var c,d;d=h[a],d&&(b?(c=d.indexOf(b),-1!==c&&d.splice(c,1)):d.length=0)}function e(a,b){return h[a]=h[a]||[],h[a].push(b),function(){d(a,b)}}function f(b,c){return b&&b.apply(a,c)}function g(a){if(h[a])for(var b=0,c=h[a],d=c.length;d>b;)f(c[b],arguments),b+=1}var h={};b&&c?(a.on=b[c.on]&&b[c.on].bind(b),a.off=b[c.off]&&b[c.off].bind(b),a.dispatch=b[c.dispatch].bind(b)):(a.on=e,a.off=d,a.dispatch=g)}function e(a){for(var b=[],c=0,d=a.length;d>c;)b.push(a[c]),c+=1;return b}function f(a){function b(a){return a.toString().split(/\b/)[2]}function c(a,c,d){return{label:b(a),method:a,args:c||[],delay:d}}function d(a){var c=b(a);x[c]=a}function e(b){for(var c=0,d=w.length;d>c;)w[c].label===b.label&&w[c]!==v&&(a.info("flow:clear duplicate item %c%s",z,b.label),w.splice(c,1),c-=1,d-=1),c+=1}function f(a,b,d){var f=c(a,b,d);x[f.label]&&e(f),w.push(f),u&&n()}function g(a,b,d){w.splice(1,0,c(a,b,d))}function h(a){e({label:b(a)})}function i(b,d){var e,f=c(b,[],d),g=Date.now(),h=function(){a.log("flow:exec timeout method %c%s %sms",z,f.label,Date.now()-g),b()};return a.log("flow:wait for timeout method %c%s",z,f.label),e=setTimeout(h,d),y[e]=function(){clearTimeout(e),delete y[e]},e}function j(a){y[a]&&y[a]()}function k(a){var b=a.toString(),c=b.match(/\(.*\)/);return c[0].match(/([\$\w])+/gm)}function l(a){var b=k(a);return!(!b||-1===b.indexOf("done"))}function m(){return t=Date.now(),a.log("flow:finish %c%s took %dms",z,v.label,t-s),v=null,w.shift(),w.length&&n(),t-s}function n(){!v&&w.length&&(v=w[0],a.async&&void 0!==v.delay?(a.log("	flow:delay for %c%s %sms",z,v.label,v.delay),clearTimeout(r),r=setTimeout(o,v.delay)):o())}function o(){a.log("flow:start method %c%s",z,v.label);var b=l(v.method);b&&v.args.push(m),s=Date.now(),v.method.apply(null,v.args),b||m()}function p(){u=!0,n()}function q(){clearTimeout(r),w.length=0,a=null}var r,s,t,u=!1,v=null,w=[],x={},y={},z="font-weight: bold;color:#3399FF;";return a=a||{},a.async=a.hasOwnProperty("async")?a.async:!0,a.debug=a.hasOwnProperty("debug")?a.debug:!1,a.insert=g,a.add=f,a.unique=d,a.remove=h,a.timeout=i,a.stopTimeout=j,a.run=p,a.destroy=q,a.log=function(){a.debug&&a.debug<1&&console.log.apply(console,arguments)},a.info=function(){a.debug&&console.log.apply(console,arguments)},a}function g(c,d,e,g){function h(){k(),X.unique(O),X.unique(H)}function i(){var a=angular.element('<div class="content"></div>');return d.append(a),a}function j(){return Y}function k(){lb.__name="ux-datagrid",lb.scope=c,lb.element=d,lb.attr=e,lb.rowsLength=0,lb.scopes=bb,lb.data=lb.data||[],lb.unwatchers=ab,lb.values=kb}function l(){lb.dispatch(a.datagrid.events.INIT),X.add(lb.templateModel.createTemplates),X.add(function(){$.dynamicRowHeights=lb.templateModel.dynamicHeights()}),X.add(m)}function m(){window.addEventListener("resize",o),ab.push(c.$on(a.datagrid.events.ON_ROW_TEMPLATE_CHANGE,S)),ab.push(c.$on("$destroy",W)),X.add(n,[],0)}function n(){if(!_){_=!0;var a,b=0,d=null;ab.push(c.$watch(function(){var f=c.$eval(e.uxDatagrid);return a=f&&f.length||0,d===f&&b!==a&&X.add(P),d=f,b=a,f},function(){X.add(P)})),A(c)}}function o(b){U(a.datagrid.events.RESIZE,{event:b})}function p(a){return bb[a]}function q(a){return angular.element(lb.chunkModel.getRow(a))}function r(a){return void 0===fb[a]&&($.dynamicRowHeights?G():fb[a]=a*$.rowHeight),fb[a]}function s(a){return lb.templateModel.getTemplateHeight(lb.data[a])}function t(){return gb}function u(){return lb.chunkModel.getChunkList().height}function v(a){X.log("OVERWRITE DOM!!!");var b=a.length;X.add(lb.chunkModel.chunkDom,[a,$.chunkSize,'<div class="'+$.chunkClass+'">',"</div>",Y],0),lb.rowsLength=b,eb={},X.log("created %s dom elements",b)}function w(a){var b,d,e,f,h=bb[a];return h||(h=c.$new(),b=p(a-1),d=lb.templateModel.getTemplate(lb.data[a]),b&&(b.$$nextSibling=h,h.$$prevSibling=b),h.$status="compiled",h[d.item]=lb.data[a],h.$index=a,f=h.$watch(function(){h.digested=!0,f()}),bb[a]=h,e=q(a),e.removeClass($.uncompiledClass),g(e)(h),B(h)),h}function x(a){jb=hb.BUILDING,X.insert(v,[a],0)}function y(){jb=hb.READY,X.add(O),X.add(z),X.add(A,[c])}function z(){c.$emit(a.datagrid.events.READY)}function A(a){a.$$phase||a.$digest()}function B(a){var b;if(a&&!D(a)){if(a.$$$watchers=a.$$watchers,a.$$watchers=[],a.$$childHead)for(b=a.$$childHead;b;)B(b),b=b.$$nextSibling;return!0}return!1}function C(a){var b;if(a&&a.$$$watchers){if(a.$$watchers=a.$$$watchers,a.$$$watchers=null,a.$$childHead)for(b=a.$$childHead;b;)C(b),b=b.$$nextSibling;return!0}return!(!a||a.$$$watchers)}function D(a){var b=bb[a];return!(!b||b.$$$watchers)}function E(a){var b=Math.floor(a/lb.templateModel.averageTemplateHeight()),c=0;for(fb[b]&&fb[b]<=a&&(c=b);c<lb.rowsLength;){if(fb[c]>a)return c-1;c+=1}return c}function F(){var a=gb,b={startIndex:0,i:0,inc:1,end:lb.rowsLength,visibleScrollStart:kb.scroll+$.cushion,visibleScrollEnd:kb.scroll+a-$.cushion};return b.startIndex=b.i=E(kb.scroll),b}function G(){for(var a=0,b=0;b<lb.rowsLength;)fb[b]=a,a+=lb.templateModel.getTemplateHeight(lb.data[b]),b+=1;$.rowHeight=lb.rowsLength?lb.templateModel.getTemplateHeight("default"):0}function H(){var a,b,d,e=F(),f=40*e.i,g=[].concat(cb);if(!(e.i<0)){for(lb.dispatch(ib.BEFORE_UPDATE_WATCHERS,e),K(),cb.length=0,X.log("	visibleScrollStart %s visibleScrollEnd %s",e.visibleScrollStart,e.visibleScrollEnd);e.i<lb.rowsLength&&(d=c.$$childHead?bb[e.i-1]:null,b=w(e.i),f=r(e.i),f>=e.visibleScrollStart&&f<=e.visibleScrollEnd&&(void 0===e.started&&(e.started=e.i),L(e.i),C(b)&&(a=g.indexOf(e.i),-1!==a&&g.splice(a,1),cb.push(e.i),A(b))),e.i+=e.inc,!(e.inc>0&&f>e.visibleScrollEnd||e.inc<0&&f<e.visibleScrollStart)););e.ended=e.i-1,X.log("	startIndex %s endIndex %s",e.startIndex,e.i),I(g),db=e.visibleScrollStart,X.log("	activated %s",cb.join(", ")),J(),X.add(A,[c]),lb.dispatch(ib.AFTER_UPDATE_WATCHERS,e)}}function I(a){for(var b,c=[];a.length;)b=a.pop(),c.push(b),B(bb[b]);X.log("	deactivated %s",c.join(", "))}function J(){if(cb.length){var a=cb[cb.length-1],b=0,d=cb.length;for(c.$$childHead=bb[cb[0]],c.$$childTail=bb[a];d>b;)bb[cb[b]].$$prevSibling=bb[cb[b-1]],bb[cb[b]].$$nextSibling=bb[cb[b+1]],b+=1}}function K(){kb.activeRange.min=kb.activeRange.max=-1}function L(a){kb.activeRange.min=kb.activeRange.min<a&&kb.activeRange.min>=0?kb.activeRange.min:a,kb.activeRange.max=kb.activeRange.max>a&&kb.activeRange.max>=0?kb.activeRange.max:a}function M(){kb.dirty&&U(a.datagrid.events.BEFORE_RENDER_AFTER_DATA_CHANGE)}function N(){kb.dirty&&(Z&&(Z.remove(),Z=null),kb.dirty=!1,U(a.datagrid.events.RENDER_AFTER_DATA_CHANGE))}function O(){if(gb||lb.upateViewportHeight(),jb===hb.BUILDING)X.add(x,[lb.data],0),X.add(G),X.add(y);else{if(jb!==hb.READY)throw new Error("RENDER STATE INVALID");X.add(M),X.add(H),X.add(N)}}function P(){U(a.datagrid.events.BEFORE_DATA_CHANGE),kb.dirty=!0,X.log("dataChanged"),lb.data=lb.setData(c.$eval(e.uxDatagrid||e.list),c.$eval(e.grouped))||[],U(a.datagrid.events.AFTER_DATA_CHANGE),X.add(Q)}function Q(){V(),fb={},eb={},cb.length=0,bb.length=0,Y&&(Z=Y,Z.css({position:"absolute",top:0,left:0,zIndex:1})),Y=i(),gb=0,k(),lb.chunkModel.reset(),jb=hb.BUILDING,X.add(O)}function R(a){var b=bb[a];!b&&a>0&&a<lb.rowsLength&&(b=w(a)),b&&!c.$$phase&&(C(b),b.$digest(),B(b))}function S(a,b){var c=lb.getNormalizedIndex(b),d=q(c),e=d.scope();e.$destroy(),bb[c]=null,d.replaceWith(lb.templateModel.getTemplate(b).template),bb[c]=w(c),T(c)}function T(a){X.add(lb.chunkModel.updateAllChunkHeights,[a]),X.add(G),X.add(O)}function U(){c.$emit.apply(c,arguments)}function V(){var a,d,e=0;b(bb,function(b,c){if(b){for(b.$$prevSibling=a||void 0,e=c;!d&&e<lb.rowsLength;)e+=1,d=bb[e]||void 0;C(b),a=b,b.$destroy()}}),c.$$childHead=void 0,c.$$childTail=void 0,bb.length=0}function W(){for(c.datagrid=null,X.log("destroying grid"),clearTimeout(kb.scrollingStopIntv),X.destroy(),lb.flow=void 0,X=null;ab.length;)ab.pop()();for(var a in lb)lb[a]&&lb[a].hasOwnProperty("destroy")&&(lb[a].destroy(),lb[a]=null);V(),d.remove(),lb=null,c=null,d=null,e=null,ab=null,Y=null,cb.length=0,cb=null,bb.length=0,bb=null,kb=null,hb=null,ib=null,g=null}var X,Y,Z,$,_=!1,ab=[],bb=[],cb=[],db=0,eb={},fb={},gb=0,hb=a.datagrid.states,ib=a.datagrid.events,jb=hb.BUILDING,kb={dirty:!1,scroll:0,speed:0,absSpeed:0,scrollPercent:0,touchDown:!1,scrollingStopIntv:null,activeRange:{min:0,max:0}},lb={};return lb.upateViewportHeight=function(){gb=lb.calculateViewportHeight()},lb.calculateViewportHeight=function(){return d[0].offsetHeight},lb.start=l,lb.reset=Q,lb.forceRenderScope=R,lb.dispatch=U,lb.render=function(){X.add(O)},lb.updateHeights=T,lb.getOffsetIndex=E,lb.isActive=D,lb.getScope=p,lb.getRowElm=q,lb.getRowOffset=r,lb.getRowHeight=s,lb.getViewportHeight=t,lb.getContentHeight=u,lb.getContent=j,lb.options=$=angular.extend({},a.datagrid.options,c.$eval(e.options)||{}),lb.flow=X=new f({async:$.hasOwnProperty("async")?!!$.async:!0,debug:$.hasOwnProperty("debug")?!!$.debug:!1}),X.add(h),X.run(),lb}var h;try{h=angular.module("ux",["ng"])}catch(i){h=angular.module("ux")}a.datagrid={isIOS:navigator.userAgent.match(/(iPad|iPhone|iPod)/g),states:{BUILDING:"datagrid:building",APPENDING:"datagrid:appending",READY:"datagrid:ready",DEACTIVATED:"datagrid:deactivated",ACTIVATED:"datagrid:activated"},events:{INIT:"datagrid:init",RESIZE:"datagrid:resize",READY:"datagrid:ready",BEFORE_UPDATE_WATCHERS:"datagrid:beforeUpdateWatchers",AFTER_UPDATE_WATCHERS:"datagrid:afterUpdateWatchers",BEFORE_DATA_CHANGE:"datagrid:beforeDataChange",AFTER_DATA_CHANGE:"datagrid:afterDataChange",BEFORE_RENDER_AFTER_DATA_CHANGE:"datagrid:beforeRenderAfterDataChange",RENDER_AFTER_DATA_CHANGE:"datagrid:renderAfterDataChange",ON_ROW_TEMPLATE_CHANGE:"datagrid:onRowTemplateChange",ON_SCROLL:"datagrid:onScroll"},options:{compileAllRowsOnInit:!1,updateDelay:100,cushion:-50,chunkSize:50,uncompiledClass:"uncompiled",dynamicRowHeights:!1,renderThreshold:25,creepLimit:10,chunkClass:"ux-datagrid-chunk"},coreAddons:[]},h.factory("addons",["$injector",function(a){function b(b,c){for(var d,e=0,f=b.length;f>e;){if(d=a.get(b[e]),"function"!=typeof d)throw new Error("Addons expect a function to pass the grid instance to.");d(c),e+=1}}return function(a,c){c=c instanceof Array?c:c&&c.replace(/,/," ").replace(/\s+/g," ").split(" ")||[],a.addons&&(c=a.addons=a.addons.concat(c)),b(c,a)}}]),a.css=function(){function a(a){return b(a)||(i[a]=c(a)),b(a)}function b(a){return i[a]}function c(a){if(document.styleSheets&&0!==document.getElementsByTagName(k.head).length){var b,c,d,e;if(document.styleSheets.length>0)for(d=0;d<document.styleSheets.length&&(document.styleSheets[d].disabled||(e=document.styleSheets[d].media,c=typeof e,c===k.string?(""===e||-1!==e.indexOf(k.screen))&&(b=document.styleSheets[d]):c===k.object&&(""===e.mediaText||-1!==e.mediaText.indexOf(k.screen))&&(b=document.styleSheets[d]),"undefined"==typeof b));d++);var f=document.createElement("style");for(f.type="text/css",f.title=a,document.getElementsByTagName(k.head)[0].appendChild(f),d=0;d<document.styleSheets.length;d++)document.styleSheets[d].disabled||(b=document.styleSheets[d]);return{name:a,styleSheet:b}}}function d(c,d,e){var f,g=b(c)||a(c),h=g.styleSheet;if(h.addRule){for(f=0;f<h.rules.length;f++)if(h.rules[f].selectorText&&h.rules[f].selectorText.toLowerCase()===d.toLowerCase())return h.rules[f].style.cssText=e,void 0;h.addRule(d,e)}else if(h.insertRule){for(f=0;f<h.cssRules.length;f++)if(h.cssRules[f].selectorText&&h.cssRules[f].selectorText.toLowerCase()===d.toLowerCase())return h.cssRules[f].style.cssText=e,void 0;h.insertRule(d+"{"+e+"}",0)}}function e(a){var b,c,d,e,g;if(-1!==a.indexOf("{")||-1!==a.indexOf("}"))return null;if(j[a])return j[a];for(b=0,c=document.styleSheets.length;c>b;b+=1)if(d=document.styleSheets[b],e=d.rules||d.cssRules,g=f(e,a))return g;return null}function f(a,b){var c,d,e,g;if(a)for(c=0,d=a.length;d>c;c+=1){if(e=a[c],e.cssRules&&(g=f(e.cssRules,b)))return g;if(e.selectorText){var h="(\b)*"+b.replace(".","\\.")+"([^-a-zA-Z0-9]|,|$)",i=e.selectorText.match(h);if(i&&-1!==i.indexOf(b))return j[b]=e.style,e.style}}return null}function g(a,b){var c=e(a);return c&&void 0!==c[b]?c[b]:null}function h(a,b,c){var d=e(a);d[b]=c}var i={},j={},k={head:"head",screen:"screen",string:"string",object:"object"};return{createdStyleSheets:[],createStyleSheet:c,createClass:d,getCSSValue:g,setCSSValue:h}}(),a.each=b,a.filter=c,a.util=a.util||{},a.util.array=a.util.array||{},a.util.array.toArray=e,a.datagrid.Flow=f,h.directive("uxDatagrid",["$compile","addons",function(c,d){return{restrict:"AE",link:function(e,f,h){var i=new g(e,f,h,c);e.datagrid=i,b(a.datagrid.coreAddons,function(a){a.apply(i,[i])}),d(i,h.addons),i.start()}}}]);var j=function(){};j.prototype=Array.prototype,j.prototype.min=0,j.prototype.max=0,j.prototype.templateStart="",j.prototype.templateEnd="",j.prototype.getStub=function(a){return this.templateStart+a+this.templateEnd},j.prototype.getChildrenStr=function(a){for(var b=0,c=this.length,d="",e=this;c>b;)d+=e[b]instanceof j?e[b].getStub(a?e[b].getChildrenStr(a):""):this.templateModel.getTemplate(e[b]).template,b+=1;return this.rendered=!0,d},j.prototype.updateHeight=function(a,b){var c,d=0,e=0;if(this[0]instanceof j)for(c=this.length;c>d;)e+=this[d].height,d+=1;else e=a.getHeight(b,this.min,this.max);this.height!==e&&(this.dirtyHeight=!0),this.height=e,this.dirtyHeight&&this.parent&&this.parent.updateHeight(a,b)},j.prototype.destroy=function(){this.templateStart="",this.templateEnd="",this.templateModel=null,this.rendered=!1,this.parent=null,this.length=0},a.datagrid.coreAddons.chunkModel=function(a){function b(){return o}function c(b,d,f,g){for(var h,i,k=0,l=b.length,m=new j;l>k;)i=b[k],k%d===0&&(h&&e(h),h=new j,h.min=i.min||k,h.templateModel=a.templateModel,h.templateStart=f,h.templateEnd=g,h.parent=m,h.index=m.length,m.push(h)),i instanceof j&&(i.parent=h),h.push(i),h.max=i.max||k,k+=1;return h&&e(h),m.min||(m.min=m[0]?m[0].min:0,m.max=m[m.length-1]?m[m.length-1].max:0,m.templateStart=f,m.templateEnd=g,e(m),m.dirtyHeight=!1),m.length>d?c(m,d,f,g):m}function e(b){b.updateHeight(a.templateModel,p),b.rendered||(b.templateStart=b.templateStart.substr(0,b.templateStart.length-1)+' style="width:100%;height:'+b.height+'px;">')}function f(b){for(var c,d=i(b,o),e=o;d.length;)c=d.shift(),e[c]instanceof j&&(e=e[c]);e.updateHeight(a.templateModel,p),g(r,o,d)}function g(a,b){for(var c=0,d=b.length;d>c;)b.dirtyHeight&&(b.dirtyHeight=!1,a.css({height:b.height+"px"}),g(angular.element(a.children()[c]),b[c])),c+=1}function h(a,b,d,e,f){return r=f,q=b,p=a,o=c(a,b,d,e),f}function i(a,b,c){var d,e=0,f=b.length;for(c=c||[];f>e;){if(d=b[e],!(d instanceof j)){c.push(a%q);break}if(a>=d.min&&a<=d.max){c.push(e),i(a,d,c);break}e+=1}return c}function k(a){var b=i(a,o);return l(b)}function l(a){for(var b,c=0,d=a.slice(0),e=o,f=r;c<d.length;)b=d.shift(),e.rendered||f.html(e.getChildrenStr()),e=e[b],f=angular.element(f.children()[b]);return f}function m(){o&&o.destroy(),p=null,o=null,q=null,r=null}function n(){m()}var o,p,q,r,s={};return s.chunkDom=h,s.getChunkList=b,s.getRowIndexes=function(a){return i(a,o)},s.getRow=k,s.reset=m,s.updateAllChunkHeights=f,s.destroy=n,d(s),a.chunkModel=s,s},a.datagrid.coreAddons.push(a.datagrid.coreAddons.chunkModel),a.datagrid.events.RENDER_PROGRESS="datagrid:renderProgress",a.datagrid.coreAddons.creepRenderModel=function(c){function d(a){var b=c.getScope(a);b&&b.digested||c.forceRenderScope(a)}function e(){var a={count:0};return b(c.scopes,f,a),{count:a.count,len:c.rowsLength}}function f(a,b,c,d){d.count+=a?1:0}function g(b,f){for(var g=b,j=f,k=Date.now()+c.options.renderThreshold;k>Date.now()&&(g>=0||j<c.rowsLength);)g>=0&&(d(g),g-=1),j<c.rowsLength&&(d(j),j+=1);l=e(),h(),n+=1,!c.values.speed&&c.scopes.length<c.rowsLength&&i(g,j),c.dispatch(a.datagrid.events.RENDER_PROGRESS,l)}function h(){m=!1,c.flow.remove(g)}function i(a,b){h(),n<c.options.creepLimit&&(c.flow.add(g,[a,b],c.options.renderThreshold),m=!0)}function j(){h()}function k(a,b){m||(n=0,i(b.started,b.ended))}var l,m=0,n=0,o={};o.destroy=function(){c=null,o=null},c.unwatchers.push(c.scope.$on(a.datagrid.events.BEFORE_UPDATE_WATCHERS,h)),c.unwatchers.push(c.scope.$on(a.datagrid.events.BEFORE_UPDATE_WATCHERS,j)),c.unwatchers.push(c.scope.$on(a.datagrid.events.AFTER_UPDATE_WATCHERS,k))},a.datagrid.coreAddons.push(a.datagrid.coreAddons.creepRenderModel),a.datagrid.coreAddons.normalizeModel=function(a){function b(a,c,d){var e=0,f=a.length;for(d=d||[];f>e;)d.push(a[e]),a[e]&&a[e][c]&&b(a[e][c],c,d),e+=1;return d}var c,d;return a.setData=function(a,e){return c=a,d=e?b(a,e):a.slice(0)},a.getData=function(){return d},a.getOriginalData=function(){return c},a.getNormalizedIndex=function(b,c){for(var d=c||0;d<a.rowsLength;){if(a.data[d]===b)return d;d+=1}if(c)for(d=c;d>=0;){if(a.data[d]===b)return d;d-=1}return-1},a},a.datagrid.coreAddons.push(a.datagrid.coreAddons.normalizeModel),a.datagrid.events.SCROLL_START="datagrid:scrollStart",a.datagrid.events.SCROLL_STOP="datagrid:scrollStop",a.datagrid.coreAddons.scrollModel=function(b){function c(){b.element[0].addEventListener("scroll",g.onUpdateScroll),d(),h=!0}function d(){b.getContent().on("touchstart",g.onTouchStart),b.getContent().on("touchend",g.onTouchEnd)}function e(){f(),h&&(b.element[0].removeEventListener("scroll",g.onUpdateScroll),g.removeTouchEvents())}var f,g={},h=!1;return g.removeTouchEvents=function(){h&&(b.getContent().off("touchstart",g.onTouchStart),b.getContent().off("touchend",g.onTouchEnd))},g.onTouchStart=function(){b.values.touchDown=!0},g.onTouchEnd=function(){b.values.touchDown=!1},g.onUpdateScroll=function(c){var d=(c.target||c.srcElement||b.element[0]).scrollTop;b.values.scroll!==d&&(b.dispatch(a.datagrid.events.SCROLL_START,d),b.values.speed=d-b.values.scroll,b.values.absSpeed=Math.abs(b.values.speed),b.values.scroll=d,b.values.scrollPercent=(b.values.scroll/b.getContentHeight()*100).toFixed(2)),g.waitForStop(),b.dispatch(a.datagrid.events.ON_SCROLL,b.values)},g.scrollTo=function(a,c){b.element[0].scrollTop=a,c?(b.values.scroll=a,clearTimeout(b.values.scrollingStopIntv),g.onScrollingStop()):g.waitForStop()},g.waitForStop=function(){b.flow.async||b.values.touchDown?(clearTimeout(b.values.scrollingStopIntv),b.values.scrollingStopIntv=setTimeout(g.onScrollingStop,b.options.updateDelay)):g.onScrollingStop()},g.onScrollingStop=function(){b.values.speed=0,b.values.absSpeed=0,b.flow.add(b.render),b.dispatch(a.datagrid.events.SCROLL_STOP,b.values.scroll)},g.scrollToIndex=function(a,c){var d=b.getRowOffset(a);return g.scrollTo(d,c),d},g.scrollToItem=function(a,c){var d=b.getNormalizedIndex(a);return-1!==d?g.scrollToIndex(d,c):b.values.scroll},g.scrollToTop=function(a){g.scrollTo(0,a)},g.scrollToBottom=function(a){var c=b.getContentHeight()-b.getViewportHeight();g.scrollTo(c>=0?c:0,a)},f=b.scope.$on(a.datagrid.events.READY,c),g.destroy=e,b.scrollModel=g,b},a.datagrid.coreAddons.push(a.datagrid.coreAddons.scrollModel),a.datagrid.coreAddons.templateModel=function(b){"use strict";function c(a){return a=a.replace(/\n/g,""),a=a.replace(/[\t ]+</g,"<"),a=a.replace(/>[\t ]+</g,"><"),a=a.replace(/>[\t ]+$/g,">")}return b.templateModel=function(){function d(){var a,c=b.element[0].getElementsByTagName("script"),d=c.length;if(!d)throw new Error("at least one template is required.");for(a=0;d>a;a+=1)e(c[a]);for(;c.length;)b.element[0].removeChild(c[0])}function e(a){var d,e=c(angular.element(a).html()),f=document.createElement("div"),g=a.attributes["data-template-name"].nodeValue||s;return e=angular.element(e)[0],e.className+=" "+b.options.uncompiledClass+" {{$status}}",e.setAttribute("template",g),document.body.appendChild(f),f.appendChild(e),e=c(f.innerHTML),f.childNodes[0].style.lineHeight="0px",d={name:g,item:a.attributes["data-template-item"].nodeValue,template:e,height:f.offsetHeight},r[d.name]=d,r.push(d),document.body.removeChild(f),q=0,d}function f(){return r}function g(a){return a.attr?a.attr("template"):a.getAttribute("template")}function h(a){return r[a]?r[a]:r[s]}function i(){var a,b;for(a in r)if(r.hasOwnProperty(a)&&(b=b||r[a].height,b!==r[a].height))return!0;return!1}function j(){var a=0,b=r.length;if(!q)for(;b>a;)q+=r[a].height,a+=1;return q/b}function k(){return r.length}function l(a){return t.getTemplate(a).height}function m(a,b,c){var d=b,e=0;if(!a.length)return 0;for(;c>=d;)e+=t.getTemplateHeight(a[d]),d+=1;return e}function n(a,b){a._template=b}function o(c,d){var e="number"==typeof c?b.data[c]:c,f=t.getTemplate(e).name;t.setTemplateName(e,d),b.dispatch(a.datagrid.events.ON_ROW_TEMPLATE_CHANGE,e,f,d)}function p(){r.length=0,r=null}var q,r=[],s="default",t={};return t.getTemplate=function(a){return t.getTemplateByName(a._template)},t.defaultName=s,t.createTemplates=d,t.getTemplates=f,t.getTemplateName=g,t.getTemplateByName=h,t.templateCount=k,t.dynamicHeights=i,t.averageTemplateHeight=j,t.getHeight=m,t.getTemplateHeight=l,t.setTemplate=o,t.setTemplateName=n,t.destroy=p,t}(),b.templateModel},a.datagrid.coreAddons.push(a.datagrid.coreAddons.templateModel)}(this.ux=this.ux||{},function(){return this}());